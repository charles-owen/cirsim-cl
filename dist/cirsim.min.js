/*! For license information please see cirsim.min.js.LICENSE.txt */
(()=>{var t,e,i,n={27240:function(){!function(t){"use strict";if(t.URL=t.URL||t.webkitURL,t.Blob&&t.URL)try{return void new Blob}catch(t){}var e=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||function(t){var e=function(t){return Object.prototype.toString.call(t).match(/^\[object\s(.*)\]$/)[1]},i=function(){this.data=[]},n=function(t,e,i){this.data=t,this.size=t.length,this.type=e,this.encoding=i},o=i.prototype,r=n.prototype,s=t.FileReaderSync,a=function(t){this.code=this[this.name=t]},l="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),c=l.length,h=t.URL||t.webkitURL||t,u=h.createObjectURL,d=h.revokeObjectURL,p=h,f=t.btoa,v=t.atob,m=t.ArrayBuffer,y=t.Uint8Array,g=/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/;for(n.fake=r.fake=!0;c--;)a.prototype[l[c]]=c+1;return h.createObjectURL||(p=t.URL=function(t){var e,i=document.createElementNS("http://www.w3.org/1999/xhtml","a");return i.href=t,"origin"in i||("data:"===i.protocol.toLowerCase()?i.origin=null:(e=t.match(g),i.origin=e&&e[1])),i}),p.createObjectURL=function(t){var e,i=t.type;return null===i&&(i="application/octet-stream"),t instanceof n?(e="data:"+i,"base64"===t.encoding?e+";base64,"+t.data:"URI"===t.encoding?e+","+decodeURIComponent(t.data):f?e+";base64,"+f(t.data):e+","+encodeURIComponent(t.data)):u?u.call(h,t):void 0},p.revokeObjectURL=function(t){"data:"!==t.substring(0,5)&&d&&d.call(h,t)},o.append=function(t){var i=this.data;if(y&&(t instanceof m||t instanceof y)){for(var o="",r=new y(t),l=0,c=r.length;l<c;l++)o+=String.fromCharCode(r[l]);i.push(o)}else if("Blob"===e(t)||"File"===e(t)){if(!s)throw new a("NOT_READABLE_ERR");var h=new s;i.push(h.readAsBinaryString(t))}else t instanceof n?"base64"===t.encoding&&v?i.push(v(t.data)):"URI"===t.encoding?i.push(decodeURIComponent(t.data)):"raw"===t.encoding&&i.push(t.data):("string"!=typeof t&&(t+=""),i.push(unescape(encodeURIComponent(t))))},o.getBlob=function(t){return arguments.length||(t=null),new n(this.data.join(""),t,"raw")},o.toString=function(){return"[object BlobBuilder]"},r.slice=function(t,e,i){var o=arguments.length;return o<3&&(i=null),new n(this.data.slice(t,o>1?e:this.data.length),i,this.encoding)},r.toString=function(){return"[object Blob]"},r.close=function(){this.size=0,delete this.data},i}(t);t.Blob=function(t,i){var n=i&&i.type||"",o=new e;if(t)for(var r=0,s=t.length;r<s;r++)Uint8Array&&t[r]instanceof Uint8Array?o.append(t[r].buffer):o.append(t[r]);var a=o.getBlob(n);return!a.slice&&a.webkitSlice&&(a.slice=a.webkitSlice),a};var i=Object.getPrototypeOf||function(t){return t.__proto__};t.Blob.prototype=i(new t.Blob)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this)},20578:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o}),t=i.hmd(t);var n=n||function(t){if(!(void 0===t||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=t.document,i=function(){return t.URL||t.webkitURL||t},n=e.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in n,r=/constructor/i.test(t.HTMLElement),s=/CriOS\/[\d]+/.test(navigator.userAgent),a=function(e){(t.setImmediate||t.setTimeout)((function(){throw e}),0)},l=function(t){setTimeout((function(){"string"==typeof t?i().revokeObjectURL(t):t.remove()}),4e4)},c=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},h=function(e,h,u){u||(e=c(e));var d,p=this,f="application/octet-stream"===e.type,v=function(){!function(t,e,i){for(var n=(e=[].concat(e)).length;n--;){var o=t["on"+e[n]];if("function"==typeof o)try{o.call(t,i||t)}catch(t){a(t)}}}(p,"writestart progress write writeend".split(" "))};if(p.readyState=p.INIT,o)return d=i().createObjectURL(e),void setTimeout((function(){var t,e;n.href=d,n.download=h,t=n,e=new MouseEvent("click"),t.dispatchEvent(e),v(),l(d),p.readyState=p.DONE}));!function(){if((s||f&&r)&&t.FileReader){var n=new FileReader;return n.onloadend=function(){var e=s?n.result:n.result.replace(/^data:[^;]*;/,"data:attachment/file;");t.open(e,"_blank")||(t.location.href=e),e=void 0,p.readyState=p.DONE,v()},n.readAsDataURL(e),void(p.readyState=p.INIT)}(d||(d=i().createObjectURL(e)),f)?t.location.href=d:t.open(d,"_blank")||(t.location.href=d);p.readyState=p.DONE,v(),l(d)}()},u=h.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,i){return e=e||t.name||"download",i||(t=c(t)),navigator.msSaveOrOpenBlob(t,e)}:(u.abort=function(){},u.readyState=u.INIT=0,u.WRITING=1,u.DONE=2,u.error=u.onwritestart=u.onprogress=u.onwrite=u.onabort=u.onerror=u.onwriteend=null,function(t,e,i){return new h(t,e||t.name||"download",i)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||(void 0).content);t.exports?t.exports.saveAs=n:"undefined"!=typeof define&&null!==define&&null!==i.amdO&&define([],(function(){return n}));const o=n},13429:()=>{"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){"use strict";if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),n=1;n<arguments.length;n++){var o=arguments[n];if(null!=o)for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(i[r]=o[r])}return i},writable:!0,configurable:!0})},61290:()=>{String.prototype.endsWith||(String.prototype.endsWith=function(t,e){return(void 0===e||e>this.length)&&(e=this.length),this.substring(e-t.length,e)===t})},65913:(t,e,i)=>{i.p=function(){var t=/^(http.*\/.*\/)[^\/]+.js.*$/,e=document.currentScript.src.match(t);if(null!==e)return e[1];if(t=/^.*\/([^\/]+.js)$/,null!==(e=document.currentScript.src.match(t)))for(var i=e[1],n=document.getElementsByTagName("script"),o=0;o<n.length;o++){var r=n[o].getAttribute("src"),s=r.indexOf(i);if(s>-1)return r.substring(0,s)}return""}()},6686:(t,e,i)=>{"use strict";i(72590),i(65913),i(93412),i(61290),i(13429);var n=i(23761),o=function(){this.circuit=null,this.x=0,this.y=0,this.moveX=0,this.moveY=0,this.selectedStyle="#ff0000",this.unselectedStyle="#000000"};o.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.moveX=t.moveX,this.moveY=t.moveY},o.prototype.single=function(){return!1},o.prototype.selectStyle=function(t,e){return e.selection.isSelected(this)?(t.strokeStyle=this.selectedStyle,t.fillStyle=this.selectedStyle,!0):(t.strokeStyle=this.unselectedStyle,t.fillStyle=this.unselectedStyle,!1)},o.prototype.grab=function(){this.moveX=this.x,this.moveY=this.y},o.prototype.move=function(t,e){this.moveX+=t,this.moveY+=e,this.x=this.moveX,this.y=this.moveY,null!==this.circuit&&this.circuit.snapIt(this)},o.prototype.place=function(t,e){this.moveX=t,this.moveY=e,this.x=this.moveX,this.y=this.moveY,null!==this.circuit&&this.circuit.snapIt(this)},o.prototype.delete=function(){},o.prototype.drop=function(){},o.prototype.spawn=function(t,e){return null};var r=function(){};r.toHex=function(t,e){for(var i=Number(t).toString(16);i.length<e;)i="0"+i;return i},r.toBinary=function(t,e){for(var i=Number(t).toString(2);i.length<e;)i="0"+i;return i},r.inArray=function(t,e){for(var i=0;i<e.length;i++)if(e[i].toLowerCase()===t.toLowerCase())return!0;return!1};var s=function(t,e){this.x=t,this.y=e};s.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);this.x/=t,this.y/=t},s.normalize=function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y);return new s(t.x/e,t.y/e)},s.rotate=function(t,e){var i=Math.sin(e),n=Math.cos(e);return new s(n*t.x-i*t.y,i*t.x+n*t.y)},s.distanceToLine=function(t,e,i,n){return 0==e?Math.abs((i*t.y+n)/i):0==i?Math.abs((e*t.x+n)/e):Math.abs(e*t.x+i*t.y+n)/Math.sqrt(e*e+i*i)},s.distanceToLineP2=function(t,e,i){return s.distanceToLine(t,e.y-i.y,i.x-e.x,e.x*i.y-i.x*e.y)},s.nearestOnLine=function(t,e,i,n){return 0==e?{x:t.x,y:-n/i}:0==i?{x:-n/e,y:t.y}:{x:(i*(i*t.x-e*t.y)-e*n)/(e*e+i*i),y:(e*(-i*t.x+e*t.y)-i*n)/(e*e+i*i)}},s.nearestOnLineP2=function(t,e,i){return s.nearestOnLine(t,e.y-i.y,i.x-e.x,e.x*i.y-i.x*e.y)},s.computeT=function(t,e,i){var n=i.x-e.x,o=i.y-e.y;return Math.abs(n)>Math.abs(o)?(t.x-e.x)/n:(t.y-e.y)/o},s.distance=function(t,e){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},s.distanceToLineSegment=function(t,e,i){var n=s.nearestOnLineP2(t,e,i),o=s.computeT(n,e,i);if(o>=0&&o<=1)return{d:s.distance(t,n),p:n};var r=s.distance(t,e),a=s.distance(t,i);return r<a?{d:r,p:e}:{d:a,p:i}};var a=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.left=t,this.top=e,this.right=i,this.bottom=n};a.prototype.setRightBottom=function(t,e){this.right=t,this.bottom=e},a.prototype.normalize=function(){if(this.left>this.right){var t=this.left;this.left=this.right,this.right=t}if(this.top>this.bottom){var e=this.top;this.top=this.bottom,this.bottom=e}},a.prototype.isEmpty=function(){return this.left>=this.right||this.top>=this.bottom},a.prototype.contains=function(t,e){return t>=this.left&&t<=this.right&&e>=this.top&&e<=this.bottom},a.prototype.expand=function(t){t.left<this.left&&(this.left=t.left),t.right>this.right&&(this.right=t.right),t.top<this.top&&(this.top=t.top),t.bottom>this.bottom&&(this.bottom=t.bottom)},a.prototype.expandXY=function(t,e){t<this.left&&(this.left=t),t>this.right&&(this.right=t),e<this.top&&(this.top=e),e>this.bottom&&(this.bottom=e)};var l=function(t,e,i,n,o,r){this.component=t,this.x=e,this.y=i,this.len=void 0!==n?n:16,this.index=void 0,this.name=o,this.inv=r,this.value=void 0,this.touchRange=8,this.bus=!1,this.reference=null,this.clock=!1};function c(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return h(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw r}}}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}l.prototype.orientation="w",l.prototype.single=function(){return!0},l.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.len=t.len,this.index=t.index,this.name=t.name,this.inv=t.inv,this.value=t.value,this.touchRange=t.touchRange,this.bus=t.bus,this.reference=t.reference},l.prototype.get=function(){return this.value},l.prototype.getAsString=function(){return function t(e){if(Array.isArray(e)){var i="";return e.forEach((function(e){i=t(e)+i})),i}return void 0===e?"?":e?"1":"0"}(this.value)},l.parseBusValue=function(t){for(var e=[],i=t.length-1;i>=0;i--){switch(t.substr(i,1)){case"0":e.push(!1);break;case"1":e.push(!0);break;case"?":e.push(void 0);break;default:return null}}return e},l.busValueToDecimal=function(t,e){if(void 0===t)return null;var i=0,n=1;for(var o in t){if(void 0===t[o])return null;t[o]&&(i+=n),n*=2}return void 0!==e&&(i%=e),i},l.prototype.touch=function(t,e){var i=this.getLoc(),n=this.touchRange;return t>=i.x-n&&t<=i.x+n&&e>=i.y-n&&e<=i.y+n},l.prototype.getLoc=function(){switch(this.orientation){case"w":return new s(this.component.x+this.x-this.len,this.component.y+this.y);case"n":return new s(this.component.x+this.x,this.component.y+this.y-this.len);case"s":return new s(this.component.x+this.x,this.component.y+this.y+this.len);case"e":return new s(this.component.x+this.x+this.len,this.component.y+this.y)}},l.prototype.draw=function(t,e){var i=this.component.x+this.x,n=this.component.y+this.y;switch(this.bus?t.lineWidth=2:t.lineWidth=1,this.orientation){case"e":if(t.beginPath(),t.moveTo(i,n+.5),t.lineTo(i+this.len,n+.5),t.fillRect(i+this.len-1,n-1,3,3),this.component.circuit.circuits.model.main.options.showOutputStates){t.font="11px Times",t.textAlign="left";var o=this.getAsString();o.length>8&&(o=parseInt(o,2),o=isNaN(o)?"?":r.toHex(o,4)),t.fillText(o,i+5,n-2)}void 0!==this.name&&(t.font="12px Times",t.textAlign="right",t.fillText(this.name,i-3,n+3)),t.stroke();break;case"w":if(t.beginPath(),t.moveTo(i,n+.5),t.lineTo(i-this.len,n+.5),t.fillRect(i-this.len-1,n-1,3,3),this.clock){var s=7;t.moveTo(i,n-s),t.lineTo(i+s,n),t.lineTo(i,n+s)}void 0!==this.name&&(t.font="12px Times",t.textAlign="left",t.fillText(this.name,i+2,n+3)),t.stroke();break;case"n":if(t.beginPath(),t.moveTo(i+.5,n),t.lineTo(i+.5,n-this.len),t.fillRect(i-1,n-this.len-1,3,3),this.clock){s=7;t.moveTo(i-s,n),t.lineTo(i,n+s),t.lineTo(i+s,n)}t.stroke(),void 0!==this.name&&(n+=this.clock?12+s:12,t.font="12px Times",t.textAlign="center",t.fillText(this.name,i,n));break;case"s":if(t.beginPath(),t.moveTo(i+.5,n),t.lineTo(i+.5,n+this.len),t.fillRect(i-1,n+this.len-1,3,3),this.clock){s=7;t.moveTo(i-s,n),t.lineTo(i,n-s),t.lineTo(i+s,n)}t.stroke(),void 0!==this.name&&(n-=this.clock?6+s:6,t.font="12px Times",t.textAlign="center",t.fillText(this.name,i,n))}t.lineWidth=1},l.prototype.autoLen=function(){switch(this.orientation){case"s":for(this.len=8*Math.floor(this.y/8)+8-this.y;this.len<12;)this.len+=8}},l.prototype.bounds=function(){var t=this.component.x+this.x,e=this.component.y+this.y,i=new a(t,e,t,e);switch(this.orientation){case"e":i.expandXY(t+this.len,e);break;case"w":i.expandXY(t-this.len,e);break;case"n":i.expandXY(t,e-this.len);break;case"s":i.expandXY(t,e+this.len)}return i};var u=function(t,e,i,n,o,r){l.call(this,t,e,i,n,o,r),this.to=[],this.orientation="e"};(u.prototype=Object.create(l.prototype)).constructor=u,u.prototype.clone=function(){var t=new u(this.component,this.x,this.y,this.len,this.name,this.inv);return t.orientation=this.orientation,t.copyFrom(this),t},u.prototype.set=function(t){var e=!0;if(Array.isArray(t)){if(Array.isArray(this.value)&&t.length===this.value.length)for(var i in e=!1,t)if(t[i]!==this.value[i]){e=!0;break}}else e=this.value!==t;if(e){this.value=t;for(var n=0;n<this.to.length;n++){var o=this.to[n].to;null!==o&&o.set()}}},u.prototype.setAsString=function(t){if(this.bus)this.set(l.parseBusValue(t));else switch(t){default:this.set(!1);break;case"1":this.set(!0);break;case"?":this.set(void 0)}},u.prototype.get=function(){return this.value},u.prototype.draw=function(t,e){l.prototype.draw.call(this,t,e),this.bus?t.lineWidth=2:t.lineWidth=1;for(var i=0;i<this.to.length;i++)this.to[i].draw(t,e);t.lineWidth=1},u.prototype.add=function(t){this.to.push(t)},u.prototype.remove=function(t){var e=[];this.to.forEach((function(i){i!==t&&e.push(i)})),this.to=e},u.prototype.clear=function(){this.to.forEach((function(t){t.delete(this)})),this.to=[]},u.prototype.touchConnections=function(t,e){for(var i=0;i<this.to.length;i++){var n=this.to[i].touch(t,e);if(null!=n)return n}return null},u.prototype.selectRect=function(t,e){for(var i=0;i<this.to.length;i++)this.to[i].selectRect(t,e)},u.prototype.bounds=function(){var t,e=l.prototype.bounds.call(this),i=c(this.to);try{for(i.s();!(t=i.n()).done;){var n=t.value;e.expand(n.bounds())}}catch(t){i.e(t)}finally{i.f()}return e};var d=function(t,e,i,n,o,r){l.call(this,t,e,i,n,o,r),this.from=[],this.orientation="w"};(d.prototype=Object.create(l.prototype)).constructor=d,d.prototype.clone=function(){var t=new d(this.component,this.x,this.y,this.len,this.name,this.inv);return t.orientation=this.orientation,t.copyFrom(this),t},d.prototype.set=function(){var t=this.from.length>0&&null!==this.from[0].from?this.from[0].from.value:void 0;this.value!==t&&(this.value=t,this.component.pending())},d.prototype.testAsString=function(t){this.component.testAsString(t,this)},d.prototype.setConnection=function(t){this.from.forEach((function(t){t.delete(this)})),t.to=this,this.from=[t],this.set()},d.prototype.clear=function(){this.from.forEach((function(t){t.delete(this)})),this.from=[]},d.prototype.add=function(t){this.from.push(t)},d.prototype.remove=function(t){var e=[];this.from.forEach((function(i){i!==t&&e.push(i)})),this.from=e},d.prototype.draw=function(t,e){l.prototype.draw.call(this,t,e);for(var i=0;i<this.from.length;i++)null===this.from[i].from&&this.from[i].draw(t,e)},d.prototype.bounds=function(){return l.prototype.bounds.call(this)};var p=function(t,e,i,n,o,r){u.call(this,t,e,i,n,o,r)};(p.prototype=Object.create(u.prototype)).constructor=p,p.prototype.draw=function(t,e){var i=this.component.x+this.x,n=this.component.y+this.y;t.beginPath(),t.arc(i+4+.5,n,4,0,2*Math.PI),t.moveTo(i+8,n+.5),t.lineTo(i+this.len,n+.5),t.fillRect(i+this.len-1,n-1,3,3),this.component.circuit.circuits.model.main.options.showOutputStates&&(t.font="11px Times",t.fillText(void 0===this.value?"?":this.value?"1":"0",i+7+8,n-2)),t.stroke(),void 0!==this.name&&(t.font="12px Times",t.textAlign="right",t.fillText(this.name,i-3,n+3),this.inv&&(n-=8,t.beginPath(),t.moveTo(i-3,n),t.lineTo(i-13,n),t.stroke()));for(var o=0;o<this.to.length;o++)this.to[o].draw(t,e)},p.prototype.set=function(t){void 0===t?u.prototype.set.call(this,t):u.prototype.set.call(this,!t)};var f=function(t,e){o.call(this),this.connection=null,void 0!==t&&(this.x=t,this.moveX=t),void 0!==e&&(this.y=e,this.moveY=e)};function v(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return m(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return m(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw r}}}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}(f.prototype=Object.create(o.prototype)).constructor=f,f.prototype.touchRange=12,f.prototype.size=4,f.prototype.clone=function(){var t=new f;return t.copyFrom(this),t},f.prototype.draw=function(t,e){e.selection.isSelected(this)&&(this.selectStyle(t,e),t.beginPath(),t.arc(this.x,this.y,this.size,0,2*Math.PI),t.fill())},f.prototype.touch=function(t,e){return Math.abs(t-this.x)+Math.abs(e-this.y)<=this.touchRange},f.prototype.delete=function(t){this.connection.removeBend(this)},f.prototype.save=function(){return{x:this.x,y:this.y}};var y=function(t,e,i){if(o.call(this),this.touchRange=8,this.bends=[],null!==t){if(this.circuit=t.component.circuit,this.from=t,this.from.add(this),null===e){var n=t.getLoc();this.x=n.x,this.y=n.y}}else this.from=null;if(void 0===e&&console.log(this),null!==e){if(this.circuit=e.component.circuit,this.to=e,this.to.add(this),null===t){n=e.getLoc();this.x=n.x,this.y=n.y}!0!==i&&e.set()}else this.to=null};(y.prototype=Object.create(o.prototype)).constructor=y,y.prototype.clone=function(){if(null===this.from||null===this.to)return null;var t=this.from.component.prev,e=this.to.component.prev,i=this.from.index,n=this.to.index;void 0===e.ins[n]&&console.log(this);for(var o=new y(t.outs[i],e.ins[n],!0),r=0;r<this.bends.length;r++){var s=this.bends[r].clone();o.addBend(s)}return o},y.prototype.delete=function(t){var e=this.to;null!==this.to&&this.to!==t&&this.to.remove(this),null!==this.from&&this.from!==t&&this.from.remove(this),null!==e&&e.set()},y.prototype.removeBend=function(t){var e=[];this.bends.forEach((function(i){i!==t&&e.push(i)})),this.bends=e},y.prototype.getCircuit=function(){return null!==this.from?this.from.component.circuit:null!==this.to?this.to.component.circuit:null},y.prototype.drop=function(){if(null!==this.from&&null===this.to){var t=this.from.component.circuit.touchIn(this.x,this.y);null!==t&&this.from.bus===t.bus?t.setConnection(this):this.from.remove(this)}else if(null===this.from&&null!==this.to){var e=this.to.component.circuit.touchOut(this.x,this.y);null!==e&&this.to.bus===e.bus?(this.to.clear(),this.to.from=[this],this.from=e,e.add(this),this.to.set()):this.to.remove(this)}},y.prototype.draw=function(t,e){if(this.selectStyle(t,e),t.beginPath(),null!==this.from){var i=this.from.getLoc();t.moveTo(i.x+.5,i.y+.5)}else t.moveTo(this.x+.5,this.y+.5);for(var n=0;n<this.bends.length;n++){var o=this.bends[n];t.lineTo(o.x+.5,o.y+.5)}if(null!==this.to){i=this.to.getLoc();t.lineTo(i.x+.5,i.y+.5)}else t.lineTo(this.x+.5,this.y+.5);t.stroke();for(n=0;n<this.bends.length;n++)this.bends[n].draw(t,e)},y.prototype.bounds=function(){var t=null;if(null!==this.from){var e=this.from.getLoc();t=new a(e.x,e.y,e.x,e.y)}else t=new a(this.x,this.y,this.x,this.y);var i,n=v(this.bends);try{for(n.s();!(i=n.n()).done;){var o=i.value;t.expandXY(o.x,o.y)}}catch(t){n.e(t)}finally{n.f()}if(null!==this.to){var r=this.to.getLoc();t.expandXY(r.x,r.y)}else t.expandXY(this.x,this.y);return t},y.prototype.touch=function(t,e){for(var i=null!==this.from?this.from:new s(t,e),n=null!==this.to?this.to:new s(t,e),o=0;o<this.bends.length;o++){var r=this.bends[o];if(r.touch(t,e))return r}var a=i.getLoc();for(o=0;o<this.bends.length;o++){var l=this.bends[o];if(s.distanceToLineSegment({x:t,y:e},a,l).d<=this.touchRange)return this;a=l}return s.distanceToLineSegment({x:t,y:e},a,n.getLoc()).d<=this.touchRange?this:null},y.prototype.selectRect=function(t,e){for(var i=0;i<this.bends.length;i++){var n=this.bends[i];t.contains(n.x,n.y)&&e.push(n)}},y.prototype.spawn=function(t,e){if(null!==this.to&&null!==this.from){for(var i=0,n=1e10,o=this.from.getLoc(),r=0;r<this.bends.length;r++){var a=this.bends[r];(l=s.distanceToLineSegment({x:t,y:e},o,a)).d<=n&&(i=r,n=l.d),o=a}var l;(l=s.distanceToLineSegment({x:t,y:e},o,this.to.getLoc())).d<=n&&(i=r,n=l.d);var c=new f;return i<this.bends.length?this.insertBend(i,c):this.addBend(c),c.place(t,e),c}return null},y.prototype.insertBend=function(t,e){e.connection=this,e.circuit=this.circuit,this.bends.splice(t,0,e)},y.prototype.addBend=function(t){t.connection=this,t.circuit=this.circuit,this.bends.push(t)},y.prototype.save=function(){if(null===this.from||null===this.to)return null;for(var t=this.from.component,e=this.to.component,i=this.from.index,n=this.to.index,o=[],r=0;r<this.bends.length;r++){var s=this.bends[r];o.push(s.save())}return{from:t.id,out:i,to:e.id,in:n,bends:o}},y.prototype.load=function(t){var e=this;t.bends.forEach((function(t){var i=new f(t.x,t.y);e.addBend(i)}))};var g=function(){};g.unique=1,g.uniqueId=function(){return g.unique++},g.uniqueName=function(){return"cirsim-id-"+g.unique++};const b=g;var w=i(90484);function x(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return T(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return T(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw r}}}}function T(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var I=function(){};I.isVisible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},I.addClass=function(t,e){t.classList?t.classList.add(e):t.className+=" "+e},I.addClasses=function(t,e){null!=e&&e.split(" ").forEach((function(e){I.addClass(t,e)}))},I.removeClass=function(t,e){var i=new RegExp("\\b"+e+"\\b","g");t.className=t.className.replace(i,"")},I.createClassedDiv=function(t,e){var i=document.createElement("div");return I.addClass(i,t),void 0!==e&&I.addContent(i,e),i},I.addContent=function(t,e){I.isString(e)?t.innerHTML+=e:I.isElement(e)&&t.appendChild(e)},I.isString=function(t){return"string"==typeof t||!!t&&"object"===(0,w.Z)(t)&&"[object String]"===Object.prototype.toString.call(t)},I.isElement=function(t){return null!=t&&void 0!==t.nodeValue},I.offset=function(t){var e=t.getBoundingClientRect();return{left:e.left+t.scrollLeft+window.pageXOffset,top:e.top+t.scrollTop+window.pageYOffset}},I.child=function(t,e){var i,n=x(t.childNodes);try{for(n.s();!(i=n.n()).done;){var o=i.value;if(o.tagName===e)return o}}catch(t){n.e(t)}finally{n.f()}return null};var S=i(27856),k=i.n(S),A=i(34618),O=function(t){this.classes=void 0!==t?"cirsim "+t:"cirsim",this.buttonOk="Ok",this.buttonCancel="Cancel",this.resize="none;",this.titleBarButtons=null};O.prototype.contents=function(t,e){this.html=t,this.title=e},O.prototype.open=function(){var t=this,e=document.createElement("form"),i=I.createClassedDiv("cirsim-dlg-content");e.appendChild(i);var n="".concat(this.html,'<p class="error"></p>\n<input type="submit" tabindex="-1" style="position:absolute; top:-1000px">');i.innerHTML=n,this.element=i;var o=[];null!==this.buttonOk&&o.push({contents:"Ok",click:function(e){t.ok()},focus:!0,class:"cs-ok"}),null!==this.buttonCancel&&o.push({contents:"Cancel",click:function(t){t.close()},class:"cs-cancel"});var r=new A.Z({addClass:this.classes,title:this.title,content:e,buttons:o,resize:this.resize,titleBarButtons:this.titleBarButtons});this.dialog=r,this.onOpen(),this.close=function(){r.close()},e.addEventListener("submit",(function(e){e.preventDefault(),t.ok()})),this.buttonOk=function(){return this.dialog.div.querySelector("button.cs-ok")}},O.prototype.ok=function(){this.close()},O.prototype.error=function(t){void 0!==t&&(this.element.querySelector(".error").innerHTML=t)},O.prototype.cancel=function(){},O.prototype.onOpen=function(){},O.prototype.sanitize=function(t){return k().sanitize(t)},O.prototype.uniqueId=function(){return g.uniqueName()};var C=function(t,e){var i=this;O.call(this,"component"),this.resize="both";var n=null,o="",r=function(){},s=function(){return null},a=function(){return null};this.open=function(){var s="";"help"in t.constructor&&(s+='<a class="helper">help</a>'),"description"in t.constructor&&(s+='<div class="description">',s+=t.constructor.description+"</div>");var a="";if(null!==t.naming)a=t.naming;else if(null!==t.prefix)for(var l=1;;l++){if(a=t.prefix+l,null===t.circuit.getComponentByNaming(a))break}var c="";null!==t.prefix&&(c+='<div class="control1 center gap"><label for="'+(n=g.uniqueName())+'">Name: </label><input type="text" name="'+n+'" id="'+n+'" value="'+a+'" spellcheck="false" class="compname text ui-widget-content ui-corner-all"></div>'),c+=o+s,i.contents(c,"Cirsim Component Properties"),O.prototype.open.call(i),r(),null!==n&&document.getElementById(n).select();var h=i.element.querySelector("a.helper");null!==h&&h.addEventListener("click",(function(i){i.preventDefault();var n=t.constructor.help;e.menu.helpMenu.componentHelp(n)}))},this.ok=function(){var o="";if(null!==t.prefix){var r=document.getElementById(n);if(0!==(o=r.value.replace(/^\s+|\s+$/gm,"")).length){var l=t.circuit.getComponentByNaming(o);if(null!==l&&l!==t)return I.addClass(r,"cirsim-error"),void i.error("Name already exists")}I.removeClass(r,"cirsim-error"),o=i.sanitize(o)}var c=s();null===c?(e.backup(),null!==t.prefix&&(t.naming=o.length>0?o:null),a(),i.close(),e.currentView().draw()):i.error(c)},this.extra=function(t,e,i){o=t,s=e,a=i},this.extraCreate=function(t){r=t}};function E(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return z(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return z(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw r}}}}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}(C.prototype=Object.create(O.prototype)).constructor=C;var B=function(){o.call(this);var t=null;Object.defineProperty(this,"circuit",{get:function(){return t},set:function(e){t=e}}),this.height=10,this.width=10,this.prev=null,this.id="",this.circuit=null,this.naming=null,this.ins=[],this.outs=[]};(B.prototype=Object.create(o.prototype)).constructor=B,B.prototype.prefix="U",B.prototype.nameRequired=!1,B.prototype.delay=11,B.prototype.brand=function(){this.id="c"+ ++B.maxId},B.maxId=1e3,B.prototype.copyFrom=function(t){this.height=t.height,this.width=t.width,this.prev=t.prev,this.naming=t.naming,this.id=t.id,t.prev=this,o.prototype.copyFrom.call(this,t);for(var e=0;e<this.ins.length;e++)this.ins[e].copyFrom(t.ins[e]);for(var i=0;i<this.outs.length;i++)this.outs[i].copyFrom(t.outs[i])},B.prototype.drop=function(){this.x<this.width/2&&(this.x=this.width/2),this.y<this.height/2&&(this.y=this.height/2)},B.prototype.grab=function(){o.prototype.grab.call(this),this.circuit.moveToFront(this)},B.prototype.mouseUp=function(){},B.prototype.added=function(t){if(this.circuit=t,null===this.naming&&this.nameRequired)for(var e=1;;e++){var i=void 0;if(i="*"===this.prefix.charAt(0)?e<=26?"ABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(e-1):this.prefix.charAt(1)+(e-26):this.prefix+e,null===this.circuit.getComponentByNaming(i)){this.naming=i;break}}},B.prototype.addIn=function(t,e,i,n){var o=new d(this,t,e,i,n);return o.index=this.ins.length,this.ins.push(o),o},B.prototype.addOut=function(t,e,i,n,o){var r=new u(this,t,e,i,n,o);return r.index=this.outs.length,this.outs.push(r),r},B.prototype.addOutInv=function(t,e,i,n,o){var r=new p(this,t,e,i,n,o);return r.index=this.outs.length,this.outs.push(r),r},B.prototype.touch=function(t,e){var i=this.touchOut(t,e);if(null!==i)return new y(i,null);if(null!==(i=this.touchIn(t,e)))return new y(null,i);if(t>=this.x-this.width/2&&t<=this.x+this.width/2&&e>=this.y-this.height/2&&e<=this.y+this.height/2)return this;for(var n=0;n<this.outs.length;n++){var o=this.outs[n].touchConnections(t,e);if(null!==o)return o}return null},B.prototype.touchOut=function(t,e){for(var i=0;i<this.outs.length;i++)if(this.outs[i].touch(t,e))return this.outs[i];return null},B.prototype.touchIn=function(t,e){for(var i=0;i<this.ins.length;i++)if(this.ins[i].touch(t,e))return this.ins[i];return null},B.prototype.inRect=function(t,e){t.contains(this.x,this.y)&&e.push(this),this.outs.forEach((function(i){i.selectRect(t,e)}))},B.prototype.delete=function(){for(var t=0;t<this.ins.length;t++)this.ins[t].clear();for(t=0;t<this.outs.length;t++)this.outs[t].clear();this.circuit.delete(this)},B.prototype.bounds=function(){var t,e=new a(this.x-this.width/2,this.y-this.height/2,this.x+this.width/2,this.y+this.height/2),i=E(this.ins);try{for(i.s();!(t=i.n()).done;){var n=t.value;e.expand(n.bounds())}}catch(t){i.e(t)}finally{i.f()}var o,r=E(this.outs);try{for(r.s();!(o=r.n()).done;){var s=o.value;e.expand(s.bounds())}}catch(t){r.e(t)}finally{r.f()}return e},B.prototype.draw=function(t,e){this.selectStyle(t,e),this.drawBox(t),this.drawName(t,0,3),this.drawIO(t,e)},B.prototype.drawIO=function(t,e){for(var i=0;i<this.ins.length;i++)this.selectStyle(t,e),this.ins[i].draw(t,e);for(i=0;i<this.outs.length;i++)this.selectStyle(t,e),this.outs[i].draw(t,e)},B.prototype.save=function(){var t=this.constructor.type,e=this.naming;return null!==e&&(e=e.replace(/'/g,"`")),{id:this.id,x:this.x,y:this.y,name:e,type:t}},B.prototype.load=function(t){this.id=this.sanitize(t.id);var e=+this.id.substr(1);e>B.maxId&&(B.maxId=e),this.x=+t.x,this.y=+t.y,this.moveX=this.x,this.moveY=this.y;var i=t.name;this.naming=null!==i?this.sanitize(i).replace(/`/g,"'"):null},B.prototype.saveConnections=function(){for(var t=[],e=0;e<this.outs.length;e++)for(var i=this.outs[e],n=0;n<i.to.length;n++){var o=i.to[n].save();null!==o&&t.push(o)}return t},B.prototype.properties=function(t){new C(this,t).open()},B.prototype.advance=function(t){return!1},B.prototype.pending=function(){for(var t=.1*this.delay,e=[],i=0;i<this.ins.length;i++)e.push(this.ins[i].value);null!==this.circuit.circuits&&this.circuit.circuits.simulation.queue(this,t,e)},B.prototype.getSimulation=function(){return null!==this.circuit?this.circuit.circuits.simulation:null},B.prototype.getDelay=function(){return this.delay},B.prototype.compute=function(t){},B.prototype.newTab=function(){},B.prototype.drawName=function(t,e,i,n){null!==this.naming&&(t.beginPath(),t.font=void 0!==n?n:"14px Times",t.textAlign="center",t.fillText(this.naming,this.x+e,this.y+i),t.stroke())},B.prototype.drawText=function(t,e,i,n,o){t.beginPath(),t.font=void 0!==o?o:"14px Times",t.textAlign="center",t.fillText(e,this.x+i,this.y+n),t.stroke()},B.prototype.drawBox=function(t,e){if("none"!==e){var i=t.fillStyle;t.fillStyle=void 0!==e?e:"#ffffff",t.fillRect(this.x-this.width/2-.5,this.y-this.height/2-.5,this.width,this.height),t.fillStyle=i}t.beginPath(),t.rect(this.x-this.width/2-.5,this.y-this.height/2-.5,this.width,this.height),t.stroke()},B.prototype.drawTrap=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=20);var n=this.x-this.width/2-.5,o=this.x+this.width/2+.5,r=this.y-this.height/2-.5,s=this.y+this.height/2+.5;t.fillStyle="#ffffff",t.beginPath(),t.moveTo(n,r+e),t.lineTo(n,s-e),t.lineTo(o,s-i),t.lineTo(o,r+i),t.lineTo(n,r+e),t.fill(),t.beginPath(),t.moveTo(n,r+e),t.lineTo(n,s-e),t.lineTo(o,s-i),t.lineTo(o,r+i),t.lineTo(n,r+e),t.stroke()},B.prototype.command=function(t){if(!("string"==typeof t||t instanceof String)||"type:"!==t.substr(0,5))return null;var e=t.substr(5);if(e!==this.constructor.type){var i=this.circuit.circuits.model.main.components.get(e);return i=null!==i?i.label:e,{ok:!1,msg:"Component "+this.naming+" should be type <strong>"+i+"</strong> but is <strong>"+this.constructor.label+"</strong>"}}return{ok:!0}},B.prototype.setAsString=function(t){},B.prototype.testAsString=function(t,e){console.log(t)},B.prototype.jaggedLine=function(t,e,i,n,o,r){var s=Math.round(e+(n-e)*r)+.5;i+=.5,o+=.5,t.moveTo(e,i),t.lineTo(s,i),t.lineTo(s,o),t.lineTo(n,o),t.stroke()},B.prototype.sanitize=function(t){return k().sanitize(t)},B.prototype.update=function(){};var N=function(t,e){var i=e.options;this.html=function(){var t="",e=i.getAPI("save"),o=i.getAPI("open");if(null!==o&&void 0===o.name&&(t+='<li><a class="file-open"><span class="icons-cl icons-cl-folder-open"></span>Open...</a></li>'),null!==e&&(t+='<li><a class="file-save"><span class="icons-cl icons-cl-disk"></span>Save</a></li>'),null!==e&&void 0===e.name&&(t+='<li><a class="file-saveas"><span class="icons-cl icons-cl-disk"></span>Save As...</a></li>'),i.loadMenu.length>0){t+=n(t);for(var r=0;r<i.loadMenu.length;r++){t+='<li><a class="cs-file-load-menu" data-index="'+r+'"><span class="icons-cl icons-cl-arrowthickstop-1-n"></span>'+i.loadMenu[r].name+"</a></li>"}}return"none"!==i.export&&(t+=n(t),"both"!==i.export&&"import"!==i.export||(t+='<li><a class="cs-file-import"><span class="icons-cl icons-cl-arrowthickstop-1-n"></span>Import</a></li>'),"both"!==i.export&&"export"!==i.export||(t+='<li><a class="cs-file-export"><span class="icons-cl icons-cl-arrowthickstop-1-s"></span>Export</a></li>')),i.exportPNG&&(t+='<li><a class="cs-file-export-png"><span class="icons-cl icons-cl-arrowthickstop-1-s"></span>Export PNG</a></li>'),i.imports.length>0&&(t+=n(t)+'<li><a class="cs-file-import-tab"><span class="icons-cl icons-cl-arrowthickstop-1-s"></span>Import Tab</a></li>'),null!==i.exit&&(t.length>0&&(t+='<li class="menu-divider">&nbsp;</li>'),t+='<li><a class="file-exit">Exit</a></li>'),""!==t?'<li><a>File</a><ul class="file-menu">'+t+"</ul></li>":""};var n=function(t){return t.length>0?'<li class="menu-divider">&nbsp;</li>':""};this.activate=function(){t.click(".cs-file-import",(function(){e.import()})),t.click(".cs-file-export",(function(){e.export()})),t.click(".cs-file-load-menu",(function(t){var n=t.target.dataset.index;e.load(i.loadMenu[n].json)})),t.click(".cs-file-export-png",(function(t){e.currentView().exportPNG()})),t.click(".file-saveas",(function(){e.saveAs()})),t.click(".file-save",(function(){e.save()})),t.click(".file-open",(function(){e.open()})),t.click(".cs-file-import-tab",(function(){e.importTab()})),t.click(".file-exit",(function(){null!==i.exit&&(window.location.href=i.exit)}))},this.opening=function(){var i=!1,n=e.currentView().circuit;if(null!==n)for(var o=n.name,r=0;r<e.options.imports.length;r++){if(e.options.imports[r].into===o){i=!0;break}}t.enable(".cs-file-import-tab",i)}},P=function(t,e){this.html=function(){return'<li><a>Edit</a><ul class="edit-menu"><li><a class="edit-undo"><span class="icons-cl icons-cl-arrowreturnthick-1-w"></span>Undo</a></li><li><a class="edit-delete"><span class="icons-cl icons-cl-trash"></span>Delete</a></li><li class="menu-divider">&nbsp;</li><li><a class="edit-properties">Properties</a></li></ul></li>'},this.activate=function(){t.click(".edit-delete",(function(t){console.log("delete"),e.backup(),e.currentView().delete()})),t.click(".edit-undo",(function(t){e.undo()})),t.click(".edit-properties",(function(t){1===e.currentView().selection.selection.length&&e.currentView().selection.selection[0]instanceof B&&e.currentView().selection.selection[0].properties(e)})),document.addEventListener("keydown",(function(i){"Delete"===i.key?(t.closeAll(),e.backup(),e.currentView().delete()):"z"!==i.key||!i.ctrlKey||i.altKey||i.shiftKey||(t.closeAll(),e.undo())}))}},j=function(t){O.call(this);var e;this.open=function(){e=this.uniqueId();var t='<div class="control1 center"><label for="'.concat(e,'">New tab name: </label>\n<input class="tabname" type="text" id="').concat(e,'" spellcheck="false"></div>\n<p>Enter the name for the new tab.</p>');this.contents(t,"New Tab"),O.prototype.open.call(this),document.getElementById(e).select()},this.ok=function(){var i=document.getElementById(e).value;if(i=i.replace(/^\s+|\s+$/gm,""),(i=this.sanitize(i)).length<1)return this.error("Must provide a tab name"),void document.getElementById(e).select();if(i.length>8)return this.error("Name must be no longer than 8 characters"),void document.getElementById(e).select();var n=t.validateName(i);if(null!==n)return this.error(n),void document.getElementById(e).select();t.add(i),this.close()}};(j.prototype=Object.create(O.prototype)).constructor=j;var L=function(t,e,i){O.call(this),this.open=function(i,n){this.contents(e,t),!0!==n&&(this.buttonCancel=null),this.ok=function(){void 0!==i&&i(),this.close()},O.prototype.open.call(this)}};(L.prototype=Object.create(O.prototype)).constructor=L;var R=function(t){O.call(this);var e;this.open=function(){var i=t.currentCircuit(),n=i.getName(),o=i.stats();e=this.uniqueId();var r='\n<div class="control1 center"><label for="'.concat(e,'">Tab name: </label>\n<input class="tabname" type="text" id="').concat(e,'" value="').concat(n,'" spellcheck="false" ').concat("main"===n?"disabled":"","></div>");r+="main"===n?'<p class="center"><em>The main tab cannot be renamed.</em></p>':"<p>This page presents information for the currently selected tab. Enter a new name to rename the tab.</p>",r+="<table>\n<tr><th>Property</th><th>Value</th></tr>\n<tr><td>Components</td><td>".concat(o.numComponents,"</td></tr>\n<tr><td>Connections</td><td>").concat(o.numConnections,"</td></tr>\n<tr><td>Width</td><td>").concat(o.width," pixels</td></tr>\n<tr><td>Height</td><td>").concat(o.height," pixels</td></tr>\n</table>"),this.contents(r,"New Tab"),O.prototype.open.call(this),document.getElementById(e).select()},this.ok=function(){var i=t.currentCircuit();if("main"!==i.getName()){var n=document.getElementById(e).value;if(n=n.replace(/^\s+|\s+$/gm,""),(n=this.sanitize(n)).length<1)return this.error("Must provide a tab name"),void document.getElementById(e).select();if(n.length>8)return this.error("Name must be no longer than 8 characters"),void document.getElementById(e).select();var o=t.validateName(n,i);if(null!==o)return this.error(o),void document.getElementById(e).select();n!==i.getName()&&t.rename(n),this.close()}else this.close()}};(R.prototype=Object.create(O.prototype)).constructor=R;var D=function(t,e){this.html=function(){return'<li><a>Tabs</a>\n<ul class="tabs-menu">\n<li><a class="tabs-properties"><span class="icons-cl icons-cl-wrench"></span>Properties...</a></li>\n<li><a class="tabs-add"><span class="icons-cl icons-cl-play"></span>Add...</a></li>\n<li><a class="tabs-delete"><span class="icons-cl icons-cl-close"></span>Delete...</a></li>\n<li><a class="tabs-left"><span class="icons-cl icons-cl-arrowthick-1-w"></span>Move Left</a></li>\n<li><a class="tabs-right"><span class="icons-cl icons-cl-arrowthick-1-e"></span>Move Right</a></li>\n</ul>\n</li>'};this.activate=function(){t.click(".tabs-add",(function(){new j(e.tabs).open()})),t.click(".tabs-delete",(function(){var t;null!==(t=e.tabs.currentCircuit())&&new L("Are you sure?",'<p class="large">Are you sure you want to delete the tab <em>'+t.getName()+"</em>?</p>",200).open((function(){e.tabs.delActive()}),!0)})),t.click(".tabs-properties",(function(){new R(e.tabs).open()})),t.click(".tabs-left",(function(){var t=e.tabs;e.model.circuits.moveLeft(t.active)&&t.sync()})),t.click(".tabs-right",(function(){var t=e.tabs;e.model.circuits.moveRight(t.active)&&t.sync()}))},this.opening=function(){var i=e.tabs,n=e.model.circuits;t.enable(".tabs-delete",n.canDelete(i.active)),t.enable(".tabs-left",n.canMoveLeft(i.active)),t.enable(".tabs-right",n.canMoveRight(i.active))}},U=function(t,e){this.html=function(){return'<li><a>Options</a>\n<ul class="option-menu">\n<li><a class="option-showoutputstates">Show Output States<img></a></li>\n</ul></li>'},this.activate=function(){t.click(".option-showoutputstates",(function(t){e.options.showOutputStates=!e.options.showOutputStates,e.currentView().draw()}))},this.opening=function(){e.options.showOutputStates?I.addClass(t.find(".option-showoutputstates img"),"check"):I.removeClass(t.find(".option-showoutputstates img"),"check")}},M=function(t){O.call(this,"about"),this.open=function(){this.buttonCancel=null;var e=t.cirsim.root,i='<figure><img src="'.concat(e,'cirsim/img/logo-icon.png" alt="Cirsim Logo"></figure>\n<h1>Cirsim Circuit Simulator</h1>\n<p>Version: ').concat(t.cirsim.version,"</p>\n<p>Written by: Charles B. Owen</p>");t.cirsim.root.indexOf("cirsim-dev")>=0&&(i+='<p class="gap">Running from the development site.</p>'),this.contents(i,"About Cirsim"),O.prototype.open.call(this)}};(M.prototype=Object.create(O.prototype)).constructor=M;var q=function(){};function F(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return H(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return H(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw r}}}}function H(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}q.do=function(t){var e=new XMLHttpRequest;if("GET"===t.method){var i=[];for(var n in t.data)t.data.hasOwnProperty(n)&&i.push(encodeURIComponent(n)+"="+encodeURIComponent(t.data[n]));e.open("GET",t.url+"?"+i.join("&"),!0)}else e.open(t.method,t.url,!0);if(e.onload=function(){if(e.status>=200&&e.status<400)if("json"===t.dataType)try{t.success(JSON.parse(e.responseText))}catch(t){console.log(t),console.log(e.responseText)}else t.success(e.responseText);else t.error(e.xhr,e.statusText,"invalid URL")},e.onerror=function(){t.error(e.xhr,e.statusText,"server not found")},"POST"===t.method)if("application/json"===t.contentType)e.setRequestHeader("Content-Type","application/json"),e.send(JSON.stringify(t.data));else{e.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");var o=[];for(var r in t.data)t.data.hasOwnProperty(r)&&o.push(encodeURIComponent(r)+"="+encodeURIComponent(t.data[r]));e.send(o.join("&"))}else e.send()};var X=function(t,e){var i=this,n=[];this.html=function(){return'<div class="cirsim-help">Fetching...</div>'},this.present=function(e){""===e&&(e="cirsim/help/index.html"),e=t.cirsim.root+e,this.presentAbsolute(e)},this.presentAbsolute=function(e){n.push(e),q.do({url:e,data:{},method:"GET",success:function(t){o(t)},error:function(e,i,n){t.toast.message("Unable to communicate with server: "+n)}})};var o=function(n){if(n.indexOf("{{components}}")>0){t.cirsim.root;var o="<ul>";t.palette.palette.forEach((function(t){if(void 0!==t.help){var e=t.label;switch(e){case"0":e="Zero";break;case"1":e="One"}o+='<li><a href="'.concat(t.help,'.html">').concat(e,"</a> <em>").concat(t.desc,"</em></li>")}})),o+="</ul>",n=n.replace("{{components}}",o)}var r=t.cirsim.root;n=(n=n.replace(/src="img\//g,'src="'+r+"cirsim/help/img/")).replace(/href="/g,'href="'+r+"cirsim/help/");var s=e.element.querySelector(".cirsim-help");if(null!==s){s.innerHTML=n;var a,l=F(s.querySelectorAll("a"));try{for(l.s();!(a=l.n()).done;){a.value.addEventListener("click",(function(t){t.preventDefault(),i.presentAbsolute(t.target.href)}))}}catch(t){l.e(t)}finally{l.f()}}};this.home=function(){this.present("")},this.back=function(){if(!(n.length<2)){n.pop();var t=n[n.length-1];n.pop(),this.presentAbsolute(t)}}},W=function(t){O.call(this,"help"),this.open=function(e){this.buttonCancel=null,this.resize="both";var i=new X(t,this),n=i.html();this.contents(n,"Cirsim Help"),this.titleBarButtons=[{type:"custom",contents:'<span class="icons-cl icons-cl-arrowthick-1-w">',click:function(){i.back()}},{type:"custom",contents:'<span class="icons-cl icons-cl-home">',click:function(){i.home()}},{type:"close"}],O.prototype.open.call(this),i.present(e)}};(W.prototype=Object.create(O.prototype)).constructor=W;var Y=function(t,e){this.html=function(){return'<li><a>Help</a><ul class="help-menu"><li><a class="help-help">Help</a></li><li><a class="help-docked-help">Docked Help<img></a></li><li><a class="help-about">About...</a></li></ul></li>'},this.componentHelp=function(t){(t="cirsim/help/"+t+".html",e.isHelpDocked())?e.help.url(t):new W(e).open(t)},this.activate=function(){t.click(".help-about",(function(t){new M(e).open()})),t.click(".help-help",(function(t){e.isHelpDocked()?e.help.home():new W(e).open("")})),t.click(".help-docked-help",(function(t){e.dockedHelp(!e.isHelpDocked())}))},this.opening=function(){e.isHelpDocked()?I.addClass(t.find(".help-docked-help img"),"check"):I.removeClass(t.find(".help-docked-help img"),"check")}};function V(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return _(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return _(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw r}}}}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var G=function(t){var e=this,i=new N(this,t),n=new P(this,t),o=new D(this,t),r=new U(this,t),s=new Y(this,t);this.helpMenu=s,this.nav=null,this.ul=null;var a=function(t){for(var i=t.target.parentNode;null!==i;i=i.parentNode)if(i===e.nav)return;e.closeAll()},l=function(t){var n,l=V(e.ul.childNodes);try{for(l.s();!(n=l.n()).done;){var u=n.value;if("LI"===u.tagName){var d=I.child(u,"UL");null!==d&&I.removeClass(d,"menu-open")}}}catch(t){l.e(t)}finally{l.f()}c(".edit-delete"),h(".edit-properties"),i.opening(),o.opening(),r.opening(),s.opening();var p=I.child(t,"UL");null!==p&&I.addClass(p,"menu-open"),document.addEventListener("click",a),document.addEventListener("mousedown",a)};this.closeAll=function(){var t,i=V(e.ul.childNodes);try{for(i.s();!(t=i.n()).done;){var n=t.value;if("LI"===n.tagName){var o=I.child(n,"UL");null!==o&&I.removeClass(o,"menu-open")}}}catch(t){i.e(t)}finally{i.f()}document.removeEventListener("click",a),document.removeEventListener("mousedown",a)},this.enable=function(t,i){var n=e.ul.querySelector(t);null!==n&&(i?I.removeClass(n.parentNode,"menu-disabled"):I.addClass(n.parentNode,"menu-disabled"))};var c=function(i){e.enable(i,t.currentView().selection.selection.length>0)},h=function(i){1===t.currentView().selection.selection.length&&t.currentView().selection.selection[0]instanceof B?e.enable(i,!0):e.enable(i,!1)};this.find=function(t){return e.ul.querySelector(t)},this.click=function(t,i){var n=e.find(t);null!==n&&n.addEventListener("click",(function(t){t.preventDefault(),e.closeAll(),i(t)}))},function(){e.nav=document.createElement("nav"),I.addClass(e.nav,"menubar"),t.div.appendChild(e.nav);var a=document.createElement("ul");e.nav.appendChild(a),e.ul=a;var c="";c+=i.html(),c+=n.html(),t.options.tabsMenu&&(c+=o.html()),c+=r.html(),c+=s.html();var h,u=0,d=V(t.test.tests);try{for(d.s();!(h=d.n()).done;){var p=h.value;c+='<li><a class="cirsim-test-'+u+'">'+p.name+"</a></li>",u++}}catch(t){d.e(t)}finally{d.f()}a.innerHTML=c;var f,v=V(a.childNodes);try{var m=function(){var t=f.value;"LI"===t.tagName&&t.addEventListener("click",(function(i){i.preventDefault();var n=I.child(t,"UL");null!==n&&("hidden"===getComputedStyle(n).getPropertyValue("visibility")?l(t):e.closeAll())}))};for(v.s();!(f=v.n()).done;)m()}catch(t){v.e(t)}finally{v.f()}u=0;var y,g=V(t.test.tests);try{var b=function(){var i=y.value,n=".cirsim-test-"+u;e.click(n,(function(e){e.preventDefault(),t.test.runTestDlg(i)})),u++};for(g.s();!(y=g.n()).done;)b()}catch(t){g.e(t)}finally{g.f()}i.activate(),n.activate(),o.activate(),r.activate(),s.activate()}()},J=function(t,e){this.width=t,this.height=e,this.scale=t/60;var i=e/this.scale;this.element=document.createElement("canvas"),this.element.style.width="60px",this.element.style.height=i+"px",this.element.style.backgroundColor="transparent",this.canvas=this.element,this.canvas.height=this.height,this.canvas.width=this.width,this.context=this.canvas.getContext("2d"),this.context.lineWidth=this.scale};J.prototype.box=function(t,e){var i=this.width/2,n=this.height/2,o=i-t/2-.5,r=i+t/2+.5,s=n-e/2-.5,a=n+e/2+.5;this.context.beginPath(),this.context.moveTo(o,s),this.context.lineTo(r,s),this.context.lineTo(r,a),this.context.lineTo(o,a),this.context.lineTo(o,s),this.fillStroke()},J.prototype.circle=function(t,e,i){t+=this.width/2,e+=this.height/2;var n=this.context.fillStyle;this.context.fillStyle="#ffffff",this.context.beginPath(),this.context.arc(t,e,i,0,2*Math.PI),this.context.fill(),this.context.fillStyle=n,this.context.beginPath(),this.context.arc(t,e,i,0,2*Math.PI),this.context.stroke()},J.prototype.io=function(t,e,i,n,o){n=void 0!==n?n:1,o=void 0!==o?o:1,t+=this.width/2,e+=this.height/2;for(var r=0;r<n;r++){this.context.beginPath(),this.context.moveTo(t,e);var s=6*this.scale;switch(i){case"w":case"W":this.context.lineTo(t-s,e);break;case"e":case"E":this.context.lineTo(t+s,e);break;case"n":case"N":this.context.lineTo(t,e-s);break;case"s":case"S":this.context.lineTo(t,e+s)}this.context.stroke(),e+=o}},J.prototype.clock=function(t,e,i){this.io(t,e,i),this.context.beginPath();switch(t+=this.width/2,e+=this.height/2,i){case"n":case"N":this.context.moveTo(t-3,e),this.context.lineTo(t,e+3),this.context.lineTo(t+3,e)}this.context.stroke()},J.prototype.drawText=function(t,e,i,n){var o=this.context;o.beginPath(),o.font=void 0!==n?n:"14px Times",o.textAlign="center",o.fillText(t,e+this.width/2,i+this.height/2),o.stroke()},J.prototype.drawTextBar=function(t,e,i,n){var o=this.context,r=o.lineWidth;this.drawText(t,e,i,n),o.lineWidth=1;var s=o.measureText(t);o.beginPath(),i+=this.height/2-16,o.moveTo(e+this.width/2-s.width/2,i),o.lineTo(e+this.width/2+s.width/2,i),o.stroke(),o.lineWidth=r},J.prototype.fillStroke=function(t){void 0===t&&(t="white");var e=this.context.fillStyle;this.context.fillStyle=t,this.context.fill(),this.context.fillStyle=e,this.context.stroke()},J.prototype.lineWidth=function(t){var e=this.context.lineWidth;return this.context.lineWidth=t,e};var Z=function(t,e,i){this.palette=t,this.obj=e,this.circuit=void 0!==i?i.name:null;var n=this.paletteImage(e),o=I.createClassedDiv("cs-item"),r=I.createClassedDiv("cs-box");o.appendChild(r);var s=I.createClassedDiv("cs-img");r.appendChild(s),s.appendChild(n);var a=I.createClassedDiv("cs-desc");e.label.length>7&&I.addClass(a,"long"),a.innerText=void 0!==i?i.name:e.label,r.appendChild(a),this.element=o,t.main.dragAndDrop.draggable(this)};Z.prototype.paletteImage=function(){var t=this.obj;if(null!==t.img&&void 0!==t.img){var e=this.palette.cirsim.root,i=document.createElement("img");return i.setAttribute("src",e+"cirsim/img/"+t.img),i.setAttribute("alt",t.desc),i.setAttribute("title",t.desc),i.setAttribute("draggable","false"),i}if(void 0!==t.paletteImage)return t.paletteImage().element;var n=new J(60,60);return n.box(30,40),n.io(15,20,"w",2,20),n.io(45,20,"e",2,20),n.drawText(t.label,0,0,"6px Times"),n.element};var Q=function(){};Q.roundedRect=function(t,e,i,n,o,r){n<2*r&&(r=n/2),o<2*r&&(r=o/2),t.beginPath(),t.moveTo(e+r,i),t.arcTo(e+n,i,e+n,i+o,r),t.arcTo(e+n,i+o,e,i+o,r),t.arcTo(e,i+o,e,i,r),t.arcTo(e,i,e+n,i,r),t.closePath()},Q.fillWith=function(t,e){var i=t.fillStyle;t.fillStyle=void 0!==e?e:"#ffffff",t.fill(),t.fillStyle=i},Q.fillTextWith=function(t,e,i,n,o){var r=t.fillStyle;t.fillStyle=void 0!==o?o:"#ffffff",t.fillText(e,i,n),t.fillStyle=r};function K(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return $(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return $(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw r}}}}function $(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var tt=function(t){B.call(this),this.height=160,this.width=80,this.circuitName=void 0!==t?t.circuit:void 0,this.circuitRef=null,this.circuitIns=[],this.circuitOuts=[]};function et(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return it(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return it(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw r}}}}function it(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}(tt.prototype=Object.create(B.prototype)).constructor=tt,tt.type="CircuitRef",tt.label="REF",tt.desc="Circuit Component",tt.img="circuitref.png",tt.order=99,tt.description="<h2>Circuit Component</h2><p>A Circuit Component uses anotherCirsim circuit as a component in the current circuit</p>",tt.prototype.compute=function(t){this.getCircuitRef();for(var e=0;e<this.ins.length&&e<this.circuitIns.length;e++)this.circuitIns[e].set(t[e]);for(var i=0;i<this.outs.length&&i<this.circuitOuts.length;i++)this.outs[i].set(this.circuitOuts[i].get())},tt.prototype.advance=function(t){null!==this.circuitRef&&this.circuitRef.advance(t);for(var e=0;e<this.outs.length&&e<this.circuitOuts.length;e++)this.outs[e].set(this.circuitOuts[e].get());return!0},tt.prototype.getCircuitRef=function(){return null!==this.circuitRef?(this.circuitRef.circuits=this.circuit.circuits,this.circuitRef):null===this.circuit.circuits.getCircuit(this.circuitName)?null:(this.circuitRef=this.circuit.circuits.getCircuit(this.circuitName).copy_clone(),this.circuitRef.circuits=this.circuit.circuits,this.circuitRef.newTab(),this.circuitRef.pending(),this.ensureIO(),this.circuitRef)},tt.prototype.newTab=function(){this.circuitRef=null,this.circuitIns=[],this.circuitOuts=[]},tt.prototype.update=function(){this.circuitRef=null,this.circuitIns=[],this.circuitOuts=[],this.ensureIO()},tt.prototype.ensureIO=function(){var t=this.circuitRef;if(null!==t){var e=function(e,i){var n,o=t.getComponentsByType(e),r=K(t.getComponentsByType(i));try{for(r.s();!(n=r.n()).done;){var s=n.value;o.push(s)}}catch(t){r.e(t)}finally{r.f()}return o.sort((function(t,e){return t.y===e.y?t.x-e.x:t.y-e.y})),o},i=function(t){var e,i={},n=K(t);try{for(n.s();!(e=n.n()).done;){var o=e.value;i[o.id]=o}}catch(t){n.e(t)}finally{n.f()}return i},n=e("InPin","InPinBus"),o=i(n);if(0===this.circuitIns.length)for(var r=0;r<n.length;r++)n[r].set(void 0);this.circuitIns=n;var s=e("OutPin","OutPinBus"),a=i(s);if(this.circuitOuts=s,n.length===this.ins.length&&s.length===this.outs.length){for(var l=!1,c=0;c<n.length;c++)if(this.ins[c].name!==n[c].naming||this.ins[c].bus!==("InPinBus"===n[c].constructor.type)){l=!0;break}for(var h=0;h<s.length;h++)if(this.outs[h].name!==s[h].naming||this.outs[h].bus!==("OutPinBus"===s[h].constructor.type)){l=!0;break}if(!l)return}var u=n.length>s.length?n.length:s.length;this.height=16*u+32,this.height<48&&(this.height=48);var d=this.width/2,p=-this.height/2+8,f=function(t,e){var i,n={},o=K(t);try{for(o.s();!(i=o.n()).done;){var r=i.value;null!==r.reference&&void 0!==e[r.reference]?n[e[r.reference].naming]=r:n[r.name]=r}}catch(t){o.e(t)}finally{o.f()}return n},v=f(this.ins,o);this.ins=[];var m=0;for(m=0;m<n.length;m++){var y=void 0;void 0!==v[n[m].naming]?(y=v[n[m].naming],this.ins.push(y),y.name=n[m].naming,y.x=-d,y.y=p+16*m,y.len=16,v[n[m].naming]=null):y=this.addIn(-d,p+16*m,16,n[m].naming),y.bus="InPinBus"===n[m].constructor.type,y.index=m,y.reference=n[m].id}for(var g in v)null!==v[g]&&v[g].clear();var b=f(this.outs,a);for(this.outs=[],m=0;m<s.length;m++){var w=void 0;void 0!==b[s[m].naming]?(w=b[s[m].naming],this.outs.push(w),w.name=s[m].naming,w.x=d,w.y=p+16*m,w.len=16,b[s[m].naming]=null):w=this.addOut(d,p+16*m,16,s[m].naming),w.index=m,w.bus="OutPinBus"===s[m].constructor.type,w.reference=s[m].id}for(var x in b)null!==b[x]&&b[x].clear()}},tt.prototype.clone=function(){var t=new tt;t.circuitName=this.circuitName;for(var e=0;e<this.ins.length;e++){var i=this.ins[e].clone();i.component=t,t.ins.push(i)}for(var n=0;n<this.outs.length;n++){var o=this.outs[n].clone();o.component=t,t.outs.push(o)}return null!==this.circuitRef&&(t.circuitRef=this.circuitRef.copy_clone(),t.ensureIO()),t.copyFrom(this),t},tt.prototype.load=function(t){this.circuitName=t.circuitName,B.prototype.load.call(this,t),this.getCircuitRef()},tt.prototype.save=function(){var t=B.prototype.save.call(this);return t.circuitName=this.circuitName,t},tt.prototype.draw=function(t,e){this.getCircuitRef(),this.ensureIO(),this.selectStyle(t,e);var i=this.x-this.width/2-.5,n=(this.x,this.width,this.y-this.height/2-.5);this.y,this.height;t.beginPath(),t.rect(i,n,this.width,this.height),Q.fillWith(t),t.stroke(),t.font="14px Times",t.textAlign="center",null!==this.naming&&t.fillText(this.naming,this.x,this.y-10),t.fillText(this.circuitName,this.x,this.y+this.height/2-5),t.stroke(),this.drawIO(t,e)};var nt=function(t,e){var i=this;this.main=t,this.cirsim=t.cirsim,this.palette=[];var n=null,o=[],s=function(e){var s=e.type;if(r.inArray(s,o)||r.inArray(s,t.options.always)){i.palette.push(e);var a=new Z(i,e);n.appendChild(a.element)}};this.refresh=function(){var e,i=et(n.querySelectorAll(".cs-circuitref"));try{for(i.s();!(e=i.n()).done;){var o=e.value;n.removeChild(o)}}catch(t){i.e(t)}finally{i.f()}for(var r=t.currentView().tabnum+1;r<t.model.circuits.circuits.length;r++){var s=t.model.circuits.circuits[r],a=new Z(this,tt,s);a.element.classList.add("cs-circuitref"),n.appendChild(a.element)}},function(){if(n=I.createClassedDiv("cs-palette"),e.appendChild(n),"string"==typeof t.options.components){if(null===(o=t.components.getPalette(t.options.components)))throw new Error("options.components invalid name "+t.options.components)}else t.options.components.forEach((function(e){var i=t.components.getPalette(e);null!==i?o=o.concat(i):("not"===e.toLowerCase()&&(e="Inverter"),"decoder"===e.toLowerCase()&&(e="BusDecoder"),o.push(e))}));t.components.components.forEach((function(t){s(t)}))}()},ot=function(){};ot.sanitize=function(t){return k().sanitize(t)},ot.boolean=function(t){return!0===t},ot.htmlentities=function(t){return t=(t=(t=t.replace(/&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")};var rt=i(42603),st=i.n(rt),at=0,lt=function(){var t=this;this.time=1,this.view=null,this.speed=1e-6,this.instance=++at,this.order=1,this.priorityQueue=new(st().PriorityQueue)((function(t,e){return t.time===e.time?e.order-t.order:e.time-t.time})),this.setView=function(t){this.view=t,null===this.view||e||(e=!0,requestAnimationFrame(o))};var e=!1,i=null,n=!1,o=function o(r){e=!1,null===i&&(i=r);var s=.001*(r-i);for(i=r,s>1&&(s=1);s>0;){var a=s;a>.03&&(a=.03),t.advance(a*t.speed)&&null!==t.view&&t.view.draw(),s-=a}null===t.view||n||(e=!0,requestAnimationFrame(o))};this.kill=function(){n=!0}};function ct(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return ht(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return ht(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw r}}}}function ht(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}lt.prototype.queue=function(t,e,i){var n=1e-9*e;this.priorityQueue.add({time:this.time+n,order:this.order,component:t,state:i}),this.order++},lt.prototype.advance=function(t){for(var e=!1;!this.priorityQueue.isEmpty()&&this.priorityQueue.peek().time<=this.time+t;){var i=this.priorityQueue.dequeue(),n=i.time-this.time;t-=n,this.time=i.time,n>0&&null!==this.view&&this.view.advance(n)&&(e=!0),i.component.compute(i.state),e=!0}return this.time+=t,t>0&&null!==this.view&&this.view.advance(t)&&(e=!0),e};var ut=function(t,e){this.model=t,this.circuits=[],this.grid=8,this.snap=!0,this.id=null!==t?t.id:void 0,this.simulation=e||new lt,this.prev=null};function dt(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return pt(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return pt(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw r}}}}function pt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}ut.prototype.add=function(t){return this.circuits.push(t),t.circuits=this,t},ut.prototype.insert=function(t){return this.circuits.unshift(t),t.circuits=this,t},ut.prototype.getCircuits=function(){return this.circuits.slice()},ut.prototype.getCircuit=function(t){for(var e=0;e<this.circuits.length;e++){var i=this.circuits[e];if(i.name===t)return i}return null},ut.prototype.advance=function(t){for(var e=!1,i=0;i<this.circuits.length;i++){this.circuits[i].advance(t)&&(e=!0)}return e},ut.prototype.canDelete=function(t){if(0===t)return!1;for(var e=this.circuits[t],i=0;i<t;i++){if(this.circuits[i].references(e).length>0)return!1}return!0},ut.prototype.canMoveLeft=function(t){if(t<2)return!1;var e=this.circuits[t];return 0===this.circuits[t-1].references(e).length},ut.prototype.canMoveRight=function(t){if(0===t||t===this.circuits.length-1)return!1;var e,i=this.circuits[t+1].name,n=ct(this.circuits[t].references());try{for(n.s();!(e=n.n()).done;){if(e.value.circuitName===i)return!1}}catch(t){n.e(t)}finally{n.f()}return!0},ut.prototype.moveLeft=function(t){if(this.canMoveLeft(t)){this.model.backup();var e=this.circuits[t-1];return this.circuits[t-1]=this.circuits[t],this.circuits[t]=e,!0}return!1},ut.prototype.moveRight=function(t){if(this.canMoveRight(t)){this.model.backup();var e=this.circuits[t+1];return this.circuits[t+1]=this.circuits[t],this.circuits[t]=e,!0}return!1},ut.prototype.rename=function(t,e){this.model.backup();for(var i=this.circuits[t],n=0;n<t;n++){var o,r=ct(this.circuits[n].references(i));try{for(r.s();!(o=r.n()).done;){o.value.circuitName=e}}catch(t){r.e(t)}finally{r.f()}}i.setName(e)},ut.prototype.newTab=function(){for(var t=this.circuits.length-1;t>=0;t--)this.circuits[t].newTab()},ut.prototype.recompute=function(){for(var t=this.circuits.length-1;t>=0;t--)this.circuits[t].recompute()},ut.prototype.clone=function(){var t=new ut(this.model,this.simulation);t.grid=this.grid,t.snap=this.snap,t.prev=this.prev,this.prev=t;for(var e=0;e<this.circuits.length;e++){var i=this.circuits[e];t.add(i.clone())}return t},ut.prototype.update=function(t){var e,i=ct(this.circuits);try{for(i.s();!(e=i.n()).done;){var n=e.value;if(n===t)break;n.update()}}catch(t){i.e(t)}finally{i.f()}},ut.prototype.toJSON=function(){return JSON.stringify(this.save())},ut.prototype.fmJSON=function(t){var e=JSON.parse(t);this.load(e)},ut.prototype.save=function(){for(var t=[],e=0;e<this.circuits.length;e++){var i=this.circuits[e];t.push(i.save())}var n={grid:this.grid,circuits:t,id:this.id};return this.snap&&(n.snap=!0),n},ut.prototype.load=function(t){this.grid=+t.grid,this.snap=ot.boolean(t.snap),this.prev=null,this.circuits=[],void 0!==t.id&&(this.id=ot.sanitize(t.id));for(var e=t.circuits.length-1;e>=0;e--){var i=t.circuits[e],n=new ft(i.name);this.insert(n),n.load(i)}for(var o=this.circuits.length-1;o>=0;o--)this.circuits[o].pending()},ut.prototype.addCircuit=function(t){var e=new ft(t);this.add(e)},ut.prototype.deleteCircuitByIndex=function(t){this.circuits.splice(t,1)},ut.prototype.getComponentByNaming=function(t){for(var e=0;e<this.circuits.length;e++){var i=this.circuits[e].getComponentByNaming(t);if(null!==i)return i}return null},ut.prototype.getComponentsByType=function(t){for(var e=[],i=0;i<this.circuits.length;i++){var n=this.circuits[i].getComponentsByType(t);e=e.concat(n)}return e},ut.prototype.replaceCircuit=function(t){t.circuits=this;for(var e=0;e<this.circuits.length;e++)if(this.circuits[e].name===t.name){this.circuits[e]=t,t.components.forEach((function(t){t.pending()})),this.model.newTab();break}};var ft=function(t){this.circuits=null,this.components=[],this.name=t,this.width=this.defWidth,this.height=this.defHeight,this.prev=null,this.touch=function(t,e){for(var i=this.components.length-1;i>=0;i--){var n=this.components[i].touch(t,e);if(null!==n)return n}return null},this.advance=function(t){for(var e=!1,i=0;i<this.components.length;i++){this.components[i].advance(t)&&(e=!0)}return e}};function vt(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return mt(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return mt(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw r}}}}function mt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}ft.prototype.defWidth=1920,ft.prototype.defHeight=1080,ft.prototype.clone=function(){var t=new ft(this.name);t.width=this.width,t.height=this.height,t.prev=this.prev,this.prev=t;for(var e=0;e<this.components.length;e++){var i=(o=this.components[e]).clone();t.add(i)}for(var n=0;n<this.components.length;n++)for(var o=this.components[n],r=0;r<o.outs.length;r++)for(var s=o.outs[r],a=0;a<s.to.length;a++)s.to[a].clone();return t},ft.prototype.copy_clone=function(){var t=new ft(this.name);t.width=this.width,t.height=this.height;for(var e=0;e<this.components.length;e++){var i=(n=this.components[e]).clone();t.add(i)}for(e=0;e<this.components.length;e++)for(var n=this.components[e],o=0;o<n.outs.length;o++)for(var r=n.outs[o],s=0;s<r.to.length;s++)r.to[s].clone();return t},ft.prototype.update=function(){var t,e=dt(this.components);try{for(e.s();!(t=e.n()).done;){t.value.update()}}catch(t){e.e(t)}finally{e.f()}},ft.prototype.draw=function(t,e){this.components.forEach((function(i,n,o){i.draw(t,e)}))},ft.prototype.newTab=function(){for(var t=0;t<this.components.length;t++){this.components[t].newTab()}},ft.prototype.recompute=function(){for(var t=0;t<this.components.length;t++)this.components[t].pending()},ft.prototype.inRect=function(t){for(var e=[],i=this.components.length-1;i>=0;i--)this.components[i].inRect(t,e);return e},ft.prototype.snapIt=function(t){this.circuits.snap&&(t.x=this.circuits.grid*Math.round(t.x/this.circuits.grid),t.y=this.circuits.grid*Math.round(t.y/this.circuits.grid))},ft.prototype.add=function(t){return this.components.push(t),t.added(this),t},ft.prototype.delete=function(t){for(var e=0;e<this.components.length;e++)if(this.components[e]===t){this.components.splice(e,1);break}},ft.prototype.touchIn=function(t,e){for(var i=this.components.length-1;i>=0;i--){var n=this.components[i].touchIn(t,e);if(null!==n)return n}return null},ft.prototype.touchOut=function(t,e){for(var i=this.components.length-1;i>=0;i--){var n=this.components[i].touchOut(t,e);if(null!==n)return n}return null},ft.prototype.save=function(){for(var t=[],e=0;e<this.components.length;e++){var i=this.components[e];t.push(i.save())}for(var n=[],o=0;o<this.components.length;o++){var r=this.components[o];n=n.concat(r.saveConnections())}return{name:this.name,width:this.width,height:this.height,components:t,connections:n}},ft.prototype.load=function(t){this.name=ot.sanitize(t.name),this.width=+t.width,this.height=+t.height;for(var e={},i=0;i<t.components.length;i++){var n=t.components[i],o=void 0;if(null!==(o="CircuitRef"===n.type?tt:this.circuits.model.main.components.get(n.type))){var r=new o;r.circuit=this,r.load(n),e[r.id]=r,this.add(r)}else console.log(n)}for(var s=0;s<t.connections.length;s++){var a=t.connections[s],l=e[a.from];if(void 0!==l){var c=e[a.to];if(void 0!==c){var h=a.out,u=a.in,d=this.connect(l,h,c,u);null!==d&&d.load(a)}else console.log("To object undefined"),console.log(this),console.log(a)}else console.log("From object undefined"),console.log(this),console.log(a)}},ft.prototype.getComponentByNaming=function(t){for(var e=0;e<this.components.length;e++){var i=this.components[e];if(i.naming===t)return i}return null},ft.prototype.getComponentsByType=function(t){for(var e=[],i=0;i<this.components.length;i++){var n=this.components[i];n.constructor.type===t&&e.push(n)}return e},ft.prototype.mouseUp=function(){for(var t=0;t<this.components.length;t++){this.components[t].mouseUp()}},ft.prototype.connect=function(t,e,i,n){return t.outs.length<=e||i.ins.length<=n?null:new y(t.outs[e],i.ins[n])},ft.prototype.getComponentsByType=function(t){for(var e=[],i=0;i<this.components.length;i++){var n=this.components[i];n.constructor.type===t&&e.push(n)}return e},ft.prototype.maxXY=function(){for(var t=1,e=1,i=0;i<this.components.length;i++){var n=this.components[i].bounds();n.right>t&&(t=n.right),n.bottom>e&&(e=n.bottom)}return{x:t+16,y:e+16}},ft.prototype.bounds=function(){if(0===this.components.length)return new a;for(var t=this.components[0].bounds(),e=0;e<this.components.length;e++){var i=this.components[e].bounds();t.expand(i)}return t},ft.prototype.pending=function(){for(var t=0;t<this.components.length;t++){this.components[t].pending()}},ft.prototype.getName=function(){return this.name},ft.prototype.setName=function(t){this.name=t},ft.prototype.stats=function(){var t=0;return this.components.forEach((function(e){e.outs.forEach((function(e){t+=e.to.length}))})),{name:this.name,numComponents:this.components.length,numConnections:t,width:this.width,height:this.height}},ft.prototype.moveToFront=function(t){for(var e=0;e<this.components.length;e++)if(this.components[e]===t){this.components.splice(e,1),this.components.push(t);break}},ft.prototype.references=function(t){var e,i=[],n=dt(this.components);try{for(n.s();!(e=n.n()).done;){var o=e.value;o instanceof tt&&(void 0!==t?o.circuitName===t.name&&i.push(o):i.push(o))}}catch(t){n.e(t)}finally{n.f()}return i};var yt=function(t){this.main=t,this.circuits=new ut(this),this.circuits.add(new ft("main"))};yt.prototype.getCircuit=function(t){return this.circuits.getCircuit(t)},yt.prototype.undo=function(){null!==this.circuits.prev&&(this.circuits=this.circuits.prev)},yt.prototype.backup=function(){this.circuits.clone()},yt.prototype.status=function(){var t,e=0,i=this.circuits,n=vt(i.circuits);try{for(n.s();!(t=n.n()).done;){for(var o=t.value,r=0,s=o;null!==s;)r++,s=s.prev;console.log("circuit depth: "+r)}}catch(t){n.e(t)}finally{n.f()}for(;null!==i;)e++,i=i.prev;console.log("circuits depth: "+e)},yt.prototype.update=function(t){this.circuits.update(t)},yt.prototype.toJSON=function(){return this.circuits.toJSON()},yt.prototype.fmJSON=function(t){this.circuits.simulation.setView(null),this.circuits=new ut(this),this.circuits.fmJSON(t)},yt.prototype.getSimulation=function(){return this.circuits.simulation},yt.prototype.newTab=function(){this.circuits.newTab(),this.recompute()},yt.prototype.recompute=function(){this.circuits.recompute()},yt.prototype.addCircuit=function(t){this.backup(),this.circuits.addCircuit(t)},yt.prototype.deleteCircuitByIndex=function(t){this.backup(),this.circuits.deleteCircuitByIndex(t)},yt.prototype.getComponentByNaming=function(t){return this.circuits.getComponentByNaming(t)},yt.prototype.getComponentsByType=function(t){return this.circuits.getComponentsByType(t)},yt.prototype.replaceCircuit=function(t){this.circuits.replaceCircuit(t)},yt.prototype.kill=function(){this.getSimulation().kill()};var gt=function(t){var e=this;this.selection=[];var i=!1,n=!1,o=null;this.mouseDown=function(e,r,s){i=!0,n=!0;var l=t.circuit.touch(e,r);null!==l?l.single()?this.selection=[l]:this.isSelected(l)||(s.shiftKey||(this.selection=[]),this.selection.push(l)):(s.shiftKey||(this.selection=[]),o=new a(e,r,e,r));for(var c=0;c<this.selection.length;c++)this.selection[c].grab()},this.mouseMove=function(e,r,s,a){if(i){if(n){if(null===o&&this.selection.length>0&&t.model.backup(),1===this.selection.length){var l=this.selection[0].spawn(e,r);null!==l&&(this.selection=[l])}n=!1}if(null!==o)o.setRightBottom(e,r);else for(var c=0;c<this.selection.length;c++)this.selection[c].move(s,a);t.model.update(t.circuit)}},this.mouseUp=function(e,n){if(i){for(var s=!1,a=0;a<this.selection.length;a++)this.selection[a].single()&&(s=!0),this.selection[a].drop();s&&(this.selection=[])}i=!1,null!==o&&(r(),o=null),t.circuit.mouseUp()};var r=function(){if(o.normalize(),!o.isEmpty()){var i=t.circuit.inRect(o);if(i.length>0){for(var n=e.selection.slice(),r=0;r<i.length;r++)e.isSelected(i[r])||n.push(i[r]);e.selection=n}}};this.isSelected=function(t){for(var e=0;e<this.selection.length;e++)if(t===this.selection[e])return!0;return!1},this.draw=function(t){null!==o&&(t.setLineDash||(t.setLineDash=function(){}),t.strokeStyle="#888888",t.setLineDash([2,3]),t.beginPath(),t.rect(o.left,o.top,o.right-o.left,o.bottom-o.top),t.stroke(),t.setLineDash([]))},this.getSelection=function(){return this.selection},this.clear=function(){this.selection=[]}};gt.prototype.delete=function(){this.selection.forEach((function(t){t.delete()})),this.clear()};function bt(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return wt(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return wt(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw r}}}}function wt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var xt=function(t){this.api=t};xt.prototype.errors=function(){return void 0!==this.api.errors?this.api.errors:null},xt.prototype.fetch=function(t){if(void 0===this.api.data)return[];var e=[];return this.api.data.forEach((function(i){i.type===t&&e.push(i)})),e},xt.prototype.getData=function(t){if(void 0===this.api.data)return[];var e,i=bt(this.api.data);try{for(i.s();!(e=i.n()).done;){var n=e.value;if(n.type===t)return n}}catch(t){i.e(t)}finally{i.f()}return null};var Tt=function(t,e,i){O.call(this),this.buttonOk=null,this.open=function(n){var o=this;this.contents("<p>Loading tab from server...</p>","Loading tab..."),O.prototype.open.call(this);var r=e.getAPI("import"),s={};Object.assign(s,r.extra),Object.assign(s,t.extra),null!==r&&q.do({url:r.url,data:Object.assign({cmd:"open",name:t.name},s),method:"GET",dataType:"json",success:function(t){var e=new xt(t);if(!i.jsonErrors(e)){var r=t.data[0].attributes.data;n(r)}o.close()},error:function(t,e,n){console.log(t.responseText),i.message("Unable to communicate with server: "+n),o.close()}})}};(Tt.prototype=Object.create(O.prototype)).constructor=Tt;i(27240);var It=i(20578),St=function(t){O.call(this);var e=this.uniqueId();this.open=function(){var t='<div class="control"><label for="'.concat(e,'">Name</label>\n<input type="text" id="').concat(e,'" value="circuit" class="text ui-widget-content ui-corner-all">\n</div>\n<p>Enter a name for the exported .png file.</p>');this.buttonOk="Export",this.contents(t,"Cirsim Export PNG"),O.prototype.open.call(this),document.getElementById(e).select()},this.ok=function(){var i=this.sanitize(document.getElementById(e).value).replace(/^\s+|\s+$/gm,"").replace(/\.[^/.]+$/,"");if(0===i.length)this.error("You must supply a name");else{this.close(),i.endsWith(".png")||(i+=".png");var n=t.circuit,o=document.createElement("canvas"),r=n.bounds(),s=r.right-r.left+2,a=r.bottom-r.top+2;o.style.width=s+"px",o.style.height=a+"px",o.width=s,o.height=a;var l=o.getContext("2d");l.fillStyle="white",l.fillRect(0,0,o.width,o.height),l.translate(1-r.left,1-r.top),n.draw(l,t),o.toBlob((function(t){(0,It.Z)(t,i)}))}}};(St.prototype=Object.create(O.prototype)).constructor=St;var kt=function(t,e,i){var n=this;Object.defineProperties(this,{main:{get:function(){return t}},circuit:{get:function(){return i},set:function(t){i=t}},element:{get:function(){return e}},model:{get:function(){return i.circuits.model}}}),this.selection=new gt(this),this.tabnum=-1,e.addEventListener("dragover",(function(t){t.preventDefault()})),e.addEventListener("drop",(function(t){t.preventDefault()})),this.initialize=function(){n.setSize(),t.dragAndDrop.droppable(n,(function(t,e,i){var o=t.obj;if(void 0!==o){n.model.backup();var r=new o(t);r.brand(),r.x=e,r.y=i,n.circuit.add(r),n.circuit.snapIt(r),n.ensureSize(),n.draw()}}));var i={x:0,y:0},o={x:0,y:0},r={x:0,y:0},s=function(s,h,u,d){var p=I.offset(e);r={x:s,y:h},o.x=s-p.left,o.y=h-p.top,i.x=o.x,i.y=o.y,"inline"!==t.options.display?(n.selection.mouseDown(o.x,o.y,d),n.draw(),u?e.addEventListener("touchmove",c):e.addEventListener("mousemove",l),e.parentNode.addEventListener("scroll",a)):n.circuit.touch(o.x,o.y)},a=function(){var t=I.offset(e);o.x=r.x-t.left,o.y=r.y-t.top,n.selection.mouseMove(o.x,o.y,o.x-i.x,o.y-i.y),i.x=o.x,i.y=o.y,n.draw()},l=function(t){t.preventDefault(),h(t.pageX,t.pageY,!1)},c=function(t){t.preventDefault();var e=t.changedTouches[0];h(e.pageX,e.pageY,!0)},h=function(t,s,a){if(t!==r.x||s!==r.y){var l=I.offset(e);r={x:t,y:s},o.x=t-l.left,o.y=s-l.top,n.selection.mouseMove(o.x,o.y,o.x-i.x,o.y-i.y),n.ensureSize(),i.x=o.x,i.y=o.y,n.draw()}},u=function(t,r,s){e.parentNode.removeEventListener("scroll",a);var l=I.offset(e);o.x=t-l.left,o.y=r-l.top,n.selection.mouseUp(o.x,o.y),i.x=o.x,i.y=o.y,n.draw()};e.addEventListener("mousedown",(function(t){t.preventDefault(),s(t.pageX,t.pageY,!1,t)})),e.addEventListener("dblclick",(function(e){(e.preventDefault(),1===n.selection.selection.length&&n.selection.selection[0]instanceof B)&&n.selection.selection[0].properties(t)})),document.querySelector("body").addEventListener("mouseup",(function(t){e.removeEventListener("mousemove",l),u(t.pageX,t.pageY,!1)})),e.addEventListener("touchstart",(function(t){t.preventDefault();var e=t.changedTouches[0];s(e.pageX,e.pageY,!0,t)})),e.addEventListener("touchend",(function(t){t.preventDefault();var e=t.changedTouches[0];u(e.pageX,e.pageY,!0)})),e.addEventListener("touchcancel",(function(t){var e=t.changedTouches[0];u(e.pageX,e.pageY,!0)}))},this.draw=function(){var t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),this.circuit.draw(t,this),this.selection.draw(t)},this.delete=function(){this.model.backup(),this.selection.delete(),this.draw()},this.advance=function(t){return this.circuit.circuits.advance(t)},this.ensureSize=function(){var t=this.circuit.bounds(),n=t.right+1,o=t.bottom+1;n>e.offsetWidth&&(e.style.width=n+"px",e.setAttribute("width",n),i.width=n),o>e.offsetHeight&&(e.style.height=t.bottom+"px",e.setAttribute("height",t.bottom),i.height=t.bottom)},this.setSize=function(){e.offsetWidth===this.circuit.width&&e.offsetHeight===this.circuit.height||(e.style.width=this.circuit.width+"px",e.style.height=this.circuit.height+"px",e.width=this.circuit.width,e.height=this.circuit.height)},this.initialize(),this.draw()};function At(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return Ot(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Ot(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw r}}}}function Ot(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}kt.prototype.importTab=function(t){var e=this;this.selection.clear(),new Tt(t,this.main.options,this.main.toast).open((function(i){e.model.backup();var n=new yt(e.main);n.fmJSON(i);var o=n.getCircuit(t.from);null!==o&&(o.name=t.into,e.main.model.replaceCircuit(o),e.circuit=o,e.draw())}))},kt.prototype.exportPNG=function(){new St(this).open()};var Ct=function(t){var e=this;this.active=-1;var i=[],n=null,o=null,r=null;this.size=function(){return i.length},this.create=function(t){n=I.createClassedDiv("tabs"),o=document.createElement("ul"),n.appendChild(o),r=I.createClassedDiv("panes"),n.appendChild(r),t.appendChild(n),i=[],e.sync()},this.sync=function(){if(function(){var e=t.model.circuits.getCircuits();if(i.length!==e.length)return!0;for(var n=0;n<i.length;n++){if(i[n].circuit!==e[n])return!0;if(i[n].li.querySelector("a").textContent!==e[n].getName())return!0}return!1}()){var e=this.active>=0?i[this.active].circuit:null,a=t.model.circuits.getCircuits();r=I.createClassedDiv("panes"),o=document.createElement("ul");var l=[];a.forEach((function(e){var n=document.createElement("li"),a=document.createElement("a");n.appendChild(a),a.innerText=e.getName(),n.addEventListener("click",(function(t){t.preventDefault(),s(n)})),a.addEventListener("click",(function(t){t.preventDefault(),s(n)})),o.appendChild(n);var c=null,h=null;for(var u in i)e===i[u].circuit&&(c=i[u].pane,h=i[u].view);if(null===c){c=I.createClassedDiv("tab");var d=document.createElement("canvas");c.appendChild(d),h=new kt(t,d,e)}r.appendChild(c),h.tabnum=l.length,l.push({li:n,pane:c,circuit:e,view:h})})),n.innerHTML="",n.appendChild(o),n.appendChild(r),i=l,this.selectTabByCircuit(e)}},this.selectTabByCircuit=function(t){if(null===t)this.selectTab(0,!0);else{var e=!1;for(var n in i)if(t===i[n].circuit){e=!0,this.selectTab(n,!0);break}e||(this.active>=i.length?this.selectTab(this.active-1):this.selectTab(this.active))}};var s=function(t){for(var n=0;n<i.length;n++)i[n].li===t&&e.selectTab(n)};this.selectTab=function(n,o){if(!0===o||n!==e.active){i.forEach((function(t){I.removeClass(t.li,"selected"),I.removeClass(t.pane,"selected")})),e.active=+n;var r=i[e.active];I.addClass(r.li,"selected"),I.addClass(r.pane,"selected"),r.view.draw(),t.model.getSimulation().setView(r.view),t.newTab()}},this.currentView=function(){return e.active<0?null:i[e.active].view},this.currentCircuit=function(){return e.active<0?null:i[e.active].circuit},this.undo=function(){var t=this.active>=0?i[this.active].circuit:null;null!==t&&(t=t.prev),this.active=-1;var e,n=At(i);try{for(n.s();!(e=n.n()).done;){e.value.view.selection.clear()}}catch(t){n.e(t)}finally{n.f()}this.sync();var o,r=At(i);try{for(r.s();!(o=r.n()).done;){o.value.view.draw()}}catch(t){r.e(t)}finally{r.f()}this.selectTabByCircuit(t)},this.destroy=function(){this.active=-1,n.parentNode.removeChild(n),n=null,i=[]},this.validateName=function(e,i){for(var n=t.model.circuits.getCircuits(),o=0;o<n.length;o++){var r=n[o];if(r!==i&&e.toLowerCase()===r.getName().toLowerCase())return"Name "+e+" already in use by another tab"}return null},this.add=function(e){t.model.addCircuit(e),this.sync(),this.selectTab(i.length-1,!0)},this.delActive=function(i){e.active<0||(t.model.deleteCircuitByIndex(e.active),e.sync())},this.rename=function(e){t.model.circuits.rename(this.active,e),this.sync()}},Et=function(t){O.call(this);var e=this.uniqueId();this.open=function(){var t='<div class="control"><label for="'.concat(e,'">Name</label>\n<input type="text" id="').concat(e,'" value="circuit" class="text ui-widget-content ui-corner-all">\n</div>\n<p>Enter a name for the exported .cirsim file.</p>');this.buttonOk="Export",this.contents(t,"Cirsim Export"),O.prototype.open.call(this),document.getElementById(e).select()},this.ok=function(){var i=this.sanitize(document.getElementById(e).value).replace(/^\s+|\s+$/gm,"").replace(/\.[^/.]+$/,"");if(0===i.length)this.error("You must supply a name");else{this.close(),i.endsWith(".cirsim")||(i+=".cirsim");var n=t.toJSON();(0,It.Z)(new Blob([n],{type:"application/json"}),i)}}};(Et.prototype=Object.create(O.prototype)).constructor=Et;var zt=function(t,e){O.call(this);var i=this,n=b.uniqueName(),o='<div class="control gap"><input class="file" type="file" id="'+n+'" /><br><span id="import-error" class="error"></span></div><p>Choose a file to import into Cirsim.</p>';this.ok=function(){var o=document.getElementById(n).files;if(!(o.length<1)){var r=o[0],s=new FileReader;s.onload=function(n){e.fmJSON(n.target.result),i.close(),t.reload()},s.onerror=function(t){i.error("Error reading circuits file")},s.onabort=function(t){i.error("Circuits file read aborted")},s.readAsText(r)}},this.buttonOk="Import",this.contents(o,"Cirsim Import")};(zt.prototype=Object.create(O.prototype)).constructor=zt;var Bt=function t(e,i){this.value=void 0,this.type=void 0!==i?i:t.AUTO,void 0!==e&&this.set(e)};Bt.AUTO=0,Bt.BINARY=1,Bt.HEX=2,Bt.FLOAT16=3,Bt.prototype.get=function(){return this.value},Bt.prototype.getBit=function(t){if(!(this.value.length<=t))return this.value[t]},Bt.prototype.set=function(t){Array.isArray(t)?this.value=t.slice():t instanceof Bt?this.value=t.value.slice():"string"==typeof t||t instanceof String?this.setAsString(t):this.value=t},Bt.prototype.setZero=function(t){this.value=[];for(var e=0;e<t;e++)this.value.push(!1)},Bt.prototype.clone=function(){return new Bt(this.value,this.type)},Bt.prototype.save=function(t){t.value=this.value,this.type!==Bt.AUTO&&(t.valuetype=this.type)},Bt.prototype.equals=function(t){if(this.value===t.value)return!0;if(Array.isArray(this.value)&&Array.isArray(t.value)&&this.value.length===t.value.length){for(var e=0;e<this.value.length;e++)if(this.value[e]!==t.value[e])return!1;return!0}return!1},Bt.prototype.load=function(t){this.set(t.value),void 0!==t.valuetype&&(this.type=t.valuetype)},Bt.prototype.getAsString=function(){if(void 0===this.value)return"?";switch(this.type){default:return this.value.length>8?this.getAsHex():this.getAsBinary();case Bt.BINARY:return this.getAsBinary();case Bt.HEX:return this.getAsHex();case Bt.FLOAT16:return this.getAsFloat16()}},Bt.prototype.setAsString=function(t,e){if("string"==typeof t||t instanceof String||(t=t.toString()),(t=(t=(t=ot.sanitize(t)).replace(/^\s+|\s+$/gm,"")).toLowerCase()).indexOf("inf")>=0||"nan"===t)return this.setAsFloat16(t,e);var i=t.substr(0,2);if("0x"===i)return this.setAsHex(t.substr(2),e);if("0b"===i)return this.setAsBinary(t.substr(2),e);if(t.indexOf(".")>=0||t.indexOf("e")>=0||t.indexOf("-")>=0)return this.setAsFloat16(t,e);switch(this.type){default:case Bt.BINARY:return this.setAsBinary(t,e);case Bt.HEX:return this.setAsHex(t,e);case Bt.FLOAT16:return this.setAsFloat16(t,e)}},Bt.prototype.draw=function(t,e,i,n,o){t.save(),t.translate(e,i),t.font="14px Times",t.textAlign="left";var r=0;null!=o&&(r=t.measureText(o+": ").width);var s=this.getAsString(),a=r+t.measureText(s).width,l=1;a>n&&(l=n/a,t.scale(l,l));r>0&&t.fillText(o+": ",-a/2,5),(this.type==Bt.HEX||this.type==Bt.AUTO&&Array.isArray(this.value)&&this.value.length>8)&&(t.font="bold 14px Times"),t.fillText(s,-a/2+r,5),t.restore()},Bt.prototype.dialogContent=function(t,e){var i=this,n=t.uniqueId(),o=t.uniqueId(),r=function(t,e,n){return'<input type="radio" name="'.concat(o,'" value="').concat(n,'"').concat(i.type===n?" checked":"","> ").concat(e)},s="";if(e){var a;switch(this.type){default:case Bt.BINARY:a="0b"+this.getAsBinary();break;case Bt.HEX:a="0x"+this.getAsHex();break;case Bt.FLOAT16:a=this.getAsFloat16()}s+='<div class="control"><label for="'+n+'">Value</label><input type="text" id="'+n+'" name="'+n+'" value="'+a+'" spellcheck="false" onfocus=" this.select()"></div>'}return{html:s+='<div class="control">'+r(0,"Auto",Bt.AUTO)+"<br>"+r(0,"Hexadecimal",Bt.HEX)+"<br>"+r(0,"Binary",Bt.BINARY)+"<br>"+r(0,"Float-16",Bt.FLOAT16)+"</div>",validate:function(){if(e){var t=i.type;i.type=parseInt(document.querySelector('input[name="'+o+'"]:checked').value);var r=document.getElementById(n).value,s=i.setAsString(r,!0);if(i.type=t,!s)return"Invalid value"}return null},accept:function(){if(i.type=parseInt(document.querySelector('input[name="'+o+'"]:checked').value),e){var t=document.getElementById(n).value;i.setAsString(t,!1)}}}},Bt.prototype.dialogOptions=function(t,e,i){var n=this.dialogContent(t,e);t.extra(n.html,n.validate,(function(){n.accept(),void 0!==i&&i()}),e?170:130)},Bt.prototype.getAsInteger=function(){if(!Array.isArray(this.value))return"?";for(var t=0,e=1,i=0;i<this.value.length;i++,e*=2){if(void 0===this.value[i])return"?";this.value[i]&&(t+=e)}return t},Bt.prototype.setAsInteger=function(t,e){for(var i=[],n=0;n<e;n++)i.push(1==(1&t)),t>>=1;return this.value=i,!0},Bt.prototype.getAsHex=function(){if(!Array.isArray(this.value))return"?";for(var t="",e=0;e<this.value.length;e+=4){for(var i=1,n=0,o=0;o<4&&e+o<this.value.length;o++,i*=2){if(void 0===this.value[e+o]){n=-1;break}this.value[e+o]&&(n+=i)}t=n<0?"?"+t:Number(n).toString(16)+t}return t},Bt.prototype.setAsHex=function(t,e){for(var i=[],n=t.length-1;n>=0;n--){var o=t.substr(n,1);if(" "!==o)if("?"===o)i.push([void 0,void 0,void 0,void 0]);else{var r=parseInt(o,16);if(isNaN(r))return!1;i.push(1==(1&r),2==(2&r),4==(4&r),8==(8&r))}else if(i.length>0)break}return e||(this.value=i),!0},Bt.prototype.getAsBinary=function(){return function t(e){if(Array.isArray(e)){var i="";return e.forEach((function(e){i=t(e)+i})),i}return void 0===e?"?":e?"1":"0"}(this.value)},Bt.prototype.setAsBinary=function(t,e){for(var i=[],n=t.length-1;n>=0;n--){var o=t.substr(n,1);if(" "!==o)switch(o){case"0":i.push(!1);break;case"1":i.push(!0);break;case"?":i.push(void 0);break;default:return!1}else if(i.length>0)break}return e||(this.value=i),!0},Bt.prototype.setInfinity16=function(t){this.value=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!0,!0,!0,!0,t]},Bt.prototype.getAsFloat16=function(){if(this.value.length<16)return"?";for(var t=this.value[15]?"-":"",e=0;e<15&&!this.value[e];e++);if(e>=15)return t+"0";var i=1,n=0;for(e=10;e<15;e++,i*=2)this.value[e]&&(n+=i);if(31==n){for(e=0;e<10;e++)if(this.value[e])return"NaN";return t+"inf"}n-=15;var o=1;i=.5;for(e=9;e>=0;e--,i/=2)this.value[e]&&(o+=i);return t+(o*=Math.pow(2,n)).toExponential(3)},Bt.prototype.setAsFloat16=function(t,e){var i=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];if("inf"===t)return e||(this.value=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!0,!0,!0,!0,!1]),!0;if("-inf"===t)return e||(this.value=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!0,!0,!0,!0,!0]),!0;if("nan"===t)return e||(this.value=[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1]),!0;var n=parseFloat(t);if(isNaN(n))return!1;if(0==n)return e||(this.value=i),!0;var o=n<0;o&&(n=-n);for(var r=0;n>1&&r<16;)n/=2,r++;if(r>=15)return e||this.setInfinity16(o),!0;for(;n<1&&r>-15;)n*=2,r--;if(r<=-15)return e||this.setZero(16),!0;n-=1,n*=2;for(var s=9;s>=0;s--,n*=2)n>=1?(i[s]=!0,n-=1):i[s]=!1;for(r+=15,s=10;s<15;s++,r>>=1)i[s]=!!(1&r);return i[15]=o,e||(this.value=i),!0};var Nt=function(t){this.msg=t};function Pt(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return jt(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return jt(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw r}}}}function jt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var Lt=function(t){function e(t){return"string"==typeof t||t instanceof String}function i(e,i,n){if(void 0!==e.result){var o,r=Pt(document.querySelectorAll(e.result));try{for(r.s();!(o=r.n()).done;){o.value.value=i}}catch(t){r.e(t)}finally{r.f()}}if(void 0!==e.circuit){var s,a=Pt(document.querySelectorAll(e.circuit));try{for(a.s();!(s=a.n()).done;){s.value.value=n}}catch(t){a.e(t)}finally{a.f()}}var l=t.options.getAPI("test");if(null!==l){var c=Object.assign({cmd:"test",name:l.name,result:i,data:n,type:"application/json"},l.extra);q.do({url:l.url,data:c,method:"POST",dataType:"json",contentType:l.contentType,success:function(e){var i=new xt(e);t.toast.jsonErrors(i)||t.toast.message("Test result successfully saved to server")},error:function(e,i,n){t.toast.message("Unable to communicate with server: "+n)}})}}this.main=t,this.tests=[],this.addTest=function(t){t===Object(t)?this.tests.push(t):("{"===t.substr(0,1)||(t=atob(t)),this.tests.push(JSON.parse(t)))},this.findTest=function(t){for(var e=0;e<this.tests.length;e++)if(this.tests[e].tag===t)return this.tests[e];return null},this.runTestDlg=function(e){t.save(!0,!0),t.modal(!0),this.runTest(e).then((function(e){t.modal(!1);new L("Success","<h1>Circuit Success</h1><p>The test has passed.</p>").open(),i(e,void 0!==e.success?e.success:"success",t.model.toJSON())}),(function(n){t.modal(!1),new L("Test Failure","<h1>Circuit Failure</h1>"+n,450).open(),i(e,"fail",t.model.toJSON())}))},this.runTest=function(i){return new Promise((function(n,o){var r=t.model;r.backup();var s,a,l=-1;try{s=function(e){for(var i=t.model,n=[],o=0;o<e.input.length;o++){var r=e.input[o],s=r.split(":"),a=i,l="";if("tab"===s[0]){if(s.length<3)throw new Nt("<p>Invalid input tab definition: "+r+"</p>");var c=s[1];if(null===(a=i.getCircuit(c)))throw new Nt("<p>Invalid input tab: "+c+"</p>");l=" in tab <em>"+c+"</em>",s.splice(0,2)}if("type"===s[0]){if(s.length<2)throw new Nt("<p>Invalid input type specification: "+r+"</p>");var h=s[1],u=a.getComponentsByType(h);if(s.length>2){var d,p=null,f=Pt(u);try{for(f.s();!(d=f.n()).done;){var v=d.value;if(v.naming===s[2]){p=v;break}}}catch(t){f.e(t)}finally{f.f()}if(null===p)throw new Nt("<p>The test is not able to pass because you do not have a component named "+s[2]+" of type "+h+l+".</p>");n.push(p)}else{if(0===u.length)throw new Nt("<p>The test is not able to pass because you do not have a component of type "+h+l+".</p>");if(u.length>1)throw new Nt("<p>The test is not able to pass because you have more than one  component of type "+h+l+".</p><p>You are only allowed one component of that type in this circuit.</p>");n.push(u[0])}}else{var m=a.getComponentByNaming(s[0]);if(null===m)throw new Nt("<p>The test is not able to pass because you do not have a component named "+s[0]+l+".</p><p>Typically, the tests are looking for an input pin or a bus input pin. Input pins are labeled IN in the palette. Double-click on an input pin to set the name. Names in Cirsim are case sensitive.</p>");n.push(m)}}return n}(i),a=function(e){for(var i=t.model,n=[],o=0;o<e.output.length;o++){var r=i,s="",a=e.output[o].split("-"),l=a[0],c=l.split(":");if("tab:"===l.substr(0,4)){var h=l.substr(4),u=h.indexOf(":");if(-1===u)throw new Nt("<p>Invalid output tab definition: "+l+"</p>");var d=h.substr(0,u);if(null===(r=i.getCircuit(d)))throw new Nt("<p>Invalid out tab: "+d+"</p>");s=" in tab <em>"+d+"</em>",l=h.substr(u+1),c.splice(0,2)}var p=a.length>1?a[1]:0;if("type"===c[0]){if(c.length<2)throw new Nt("<p>Invalid output type specification: "+l+"</p>");var f=c[1],v=r.getComponentsByType(f);if(c.length>2){var m,y=null,g=Pt(v);try{for(g.s();!(m=g.n()).done;){var b=m.value;if(b.naming===c[2]){y=b;break}}}catch(t){g.e(t)}finally{g.f()}if(null===y)throw new Nt("<p>The test is not able to pass because you do not have a component named "+c[2]+" of type "+f+s+".</p>");n.push(y.ins[p])}else{if(0===v.length)throw new Nt("<p>The test is not able to pass because you do not have a component of type "+f+s+".</p>");if(v.length>1)throw new Nt("<p>The test is not able to pass because you have more than one  component of type "+f+s+".</p><p>You are only allowed one component of that type in this circuit.</p>");n.push(v[0].ins[p])}}else{var w=r.getComponentByNaming(l);if(!(null!==w&&w.ins.length>p))throw new Nt("<p>The test is not able to pass because you do not have a component named "+l+s+".</p><p>Output pins are labeled OUT in the palette. Double-click on an output pin to set the name. Pin names are case sensitive.</p>");n.push(w.ins[p])}}return n}(i)}catch(t){if(t instanceof Nt)return void o(t.msg);throw t}setTimeout((function c(){if(l>=0)for(var h=i.test[l],u=0;u<a.length&&u+s.length<h.length;u++){var d=h[u+s.length];if(null!=d&&"?"!==d){var p=!1,f=!1;if(e(d)){var v=!1;do{v=!1,"bitslop:"===d.substr(0,8)?(p=!0,d=d.substr(8),v=!0):"test:"===d.substr(0,5)&&(f=!0,d=d.substr(5),v=!0)}while(v)}if(f){var m,y=Pt(d.split(";"));try{for(y.s();!(m=y.n()).done;){var g=m.value;try{a[u].testAsString(g)}catch(t){return void(!0===g.quiet?o('<div class="cirsim-test-result"><p>This test is failing. Some output is not what is currently expected by the test. The circuit is left in the state it was in when the test failed. No additional detail will be provided about why the test is failed. It is your responsibility to create a circuit that works as expected.</p></div>'):o('<div class="cirsim-test-result"><p>This test is failing. '.concat(t,'</p>\n<p class="cs-info">Test ').concat(l,"</p></div>")))}}}catch(t){y.e(t)}finally{y.f()}}else{var b=new Bt;b.type=Bt.BINARY,b.setAsString(d);var w=a[u].getAsString(),x=!0;if(p)d=b.getAsInteger(),b.setAsBinary(w),("?"===(w=b.getAsInteger())||w<d-1||w>d+1)&&(x=!1);else if(e(d=b.getAsBinary())){for(var T=w.length-1,I=d.length-1;I>=0&&x;T--,I--)if("?"!==d.substr(I,1)){if(T<0){x=!1;break}w.substr(T,1)!=d.substr(I,1)&&(x=!1)}T>0&&(x=!1)}else null!==d&&"?"!==d&&(x=d==w);if(!x)return console.log("Test: "+l+" Output "+a[u].component.naming+" Actual: "+w+" Expected: "+d),void(!0===i.quiet?o('<div class="cirsim-test-result"><p>This test is failing. Some output is not what is currently expected by the test. The circuit is left in the state it was in when the test failed. No additional detail will be provided about why the test is failed. It is your responsibility to create a circuit that works as expected.</p></div>'):o('<div class="cirsim-test-result"><p>This test is failing. An output value is \nnot what is currently expected by the test. The circuit is left in the state it was \nin when the test failed.<p>\n<p class="cs-result">Output '.concat(a[u].component.naming," expected: ").concat(d," actual: ").concat(w,'</p>\n<p class="cs-info">Test ').concat(l,"</p></div>\n")))}}}if(++l<i.test.length){for(var S=i.test[l],k=0;k<s.length&&k<S.length;k++)if(null!==S[k]){var A=s[k].command(S[k]);if(null!==A){if(!A.ok)return void o("<p>This test is failing. "+A.msg+"</p>")}else try{s[k].setAsString(S[k])}catch(t){return void o('<div class="cirsim-test-result"><p>This test is failing. '.concat(t,'</p>\n<p class="cs-info">Test ').concat(l,"</p></div>"))}}for(var O=r.getSimulation(),C=0;C<100&&O.advance(.01*O.speed);C++);setTimeout(c,t.options.testTime),null!==O.view&&O.view.draw()}else n(i)}),t.options.testTime)}))}},Rt=function(t){var e=this;this.defaultDuration=2e3,this.interToastDelay=500;var i=[],n=!1,o=null;this.create=function(t){o=I.createClassedDiv("toast"),t.appendChild(o),o.innerHTML="testing"};var r=function t(){if(i.length>0&&!n){var r=i[0];i.splice(0,1),o.innerHTML=r.msg,o.classList.add("toast-active"),n=!0,setTimeout((function(){o.classList.remove("toast-active"),setTimeout((function(){n=!1,t()}),e.interToastDelay)}),r.time)}};this.message=function(t,e){void 0===e&&(e=this.defaultDuration),i.push({msg:t,time:e}),r()},this.jsonErrors=function(t){var e=this;return null!==t.errors()&&(t.errors().forEach((function(t){e.message("Server Error: "+t.title,5e3)})),!0)}},Dt=function(t){O.call(this),this.open=function(e){this.done=e;var i="<p>File "+t+" exists. Are you sure you want to overwrite?";this.contents(i,"Overwrite?"),O.prototype.open.call(this)},this.ok=function(){this.close(),this.done(!0)},this.cancel=function(){this.done(!1)}};(Dt.prototype=Object.create(O.prototype)).constructor=Dt;var Ut=function(t,e,i){var n=this;O.call(this);var o=this,r=e.getAPI("files"),s=null,a=null;this.filename="";var l=this.uniqueId(),c=this.uniqueId(),h="#"+l,u="#"+c;this.open=function(e){a=e;var i='<div class="control"><label for="'+c+'">'+(t?"Available":"Existing")+'</label><select class="files" id="'+c+'" name="'+c+'" size="5"></select><div class="notice">Querying Server...</div></div><div class="control"><label for="'+l+'">Name</label><input type="text" name="'+l+'" id="'+l+'" value="'+this.filename+'" spellcheck="false" class="text ui-widget-content ui-corner-all"></div>';t?this.contents(i,"File Open"):(i+="<p>Enter a name to save your circuit on the server as.</p>",this.contents(i,"File Save")),O.prototype.open.call(this);var n=document.getElementById(c),o=document.getElementById(l);n.addEventListener("click",(function(t){o.value=n.value})),o.select(),d(u,h),t||this.buttonOk().setAttribute("disabled","true")},this.ok=function(){var e=this,i=(document.getElementById(c),document.getElementById(l));if(this.filename=this.sanitize(i.value).replace(/^\s+|\s+$/gm,""),0===this.filename.length)return i.focus(),void this.error("Must supply a file name");if(!/^[0-9a-zA-Z\.\-\+ ]+$/.test(this.filename))return i.focus(),void this.error("Names can contain a-z, A-Z, 0-9, ., -, +, and space");((this.filename.length<8||".cirsim"!==this.filename.substr(this.filename.length-7,7))&&(this.filename+=".cirsim"),t)?this.read(this.filename,a):s.indexOf(this.filename)>=0?new Dt(this.filename).open((function(t){t&&e.write(e.filename,a)})):this.write(this.filename,a)};var d=function(){q.do({url:r.url,data:Object.assign({cmd:"files"},r.extra),method:"GET",dataType:"json",success:function(t){var e=new xt(t);if(i.jsonErrors(e))o.close();else{var r=e.getData("files"),a=document.getElementById(c),h=(document.getElementById(l),a.parentNode.querySelector(".notice"));null!==h&&h.parentNode.removeChild(h),s=[],r.attributes.forEach((function(t){var e=document.createElement("option");e.value=t.name,e.innerText=t.name,a.appendChild(e),s.push(t.name)})),n.buttonOk().removeAttribute("disabled")}},error:function(t,e,n){console.log(t.responseText),i.message("Unable to communicate with server: "+n),o.close()}})}};(Ut.prototype=Object.create(O.prototype)).constructor=Ut;var Mt=function(t,e,i,n){Ut.call(this,!1,i,n);var o=i.getAPI("save");this.write=function(e,i){var r=this;q.do({url:o.url,data:Object.assign({cmd:"save",name:e,data:t},o.extra),method:"POST",dataType:"json",success:function(t){var o=new xt(t);n.jsonErrors(o)||(r.close(),i(e))},error:function(t,e,i){console.log(t.responseText),n.message("Unable to communicate with server: "+i),r.close()}})}};(Mt.prototype=Object.create(Ut.prototype)).constructor=Mt;var qt=function(t,e){Ut.call(this,!0,t,e);var i=t.getAPI("open");this.read=function(t,n){var o=this;q.do({url:i.url,data:Object.assign({cmd:"open",name:t},i.extra),method:"GET",dataType:"json",success:function(i){var r=new xt(i);if(!e.jsonErrors(r)){var s=i.data[0].attributes.data;n(t,s),o.close()}},error:function(t,i,n){console.log(t.responseText),e.message("Unable to communicate with server: "+n),o.close()}})}};(qt.prototype=Object.create(Ut.prototype)).constructor=qt;var Ft=function(t,e,i,n,o){O.call(this);var r=this;this.buttonOk=null,this.open=function(){var e=this;this.contents("<p>Saving to server...</p>","Saving..."),O.prototype.open.call(this);var s=n.getAPI("save");q.do({url:s.url,data:Object.assign({cmd:"save",name:i,data:t},s.extra),method:"POST",dataType:"json",success:function(t){var e=new xt(t);o.jsonErrors(e)||r.close()},error:function(t,i,n){console.log(t.responseText),o.message("Unable to communicate with server: "+n),e.close()}})}};(Ft.prototype=Object.create(O.prototype)).constructor=Ft;var Ht=function(t,e,i){O.call(this),this.buttonOk=null,this.open=function(n){var o=this;this.contents("<p>Loading from server...</p>","Loading..."),O.prototype.open.call(this);var r=e.getAPI("open");null!==r&&q.do({url:r.url,data:Object.assign({cmd:"open",name:t},r.extra),method:"GET",dataType:"json",success:function(e){var r=new xt(e);if(!i.jsonErrors(r)){var s=e.data[0].attributes.data;n(t,s)}o.close()},error:function(t,e,n){i.message("Unable to communicate with server: "+n),o.close()}})}};(Ht.prototype=Object.create(O.prototype)).constructor=Ht;var Xt=function(t){var e,i=this;this.home=function(){e.home()},this.url=function(t){e.present(t)},function(){e=new X(t,i);var n=I.createClassedDiv("help-div");i.element=n,t.element.appendChild(n);var o='<div class="header"><h1>Cirsim Help</h1>\n<button type="button" class="help-back" title="Back">\n<span class="icons-cl icons-cl-arrowthick-1-w"></span></button>\n<button type="button" class="help-home" title="Home">\n<span class="icons-cl icons-cl-home"></span></button>\n<button type="button" class="help-close" title="Close">\n<span class="icons-cl icons-cl-closethick"></span></button>\n</div>\n'.concat(e.html());n.innerHTML=o,e.present("");var r=n.querySelector(".header");null!==r&&(r.querySelector("button.help-close").addEventListener("click",(function(e){e.preventDefault(),t.dockedHelp(!1)})),r.querySelector("button.help-home").addEventListener("click",(function(t){t.preventDefault(),e.home()})),r.querySelector("button.help-back").addEventListener("click",(function(t){t.preventDefault(),e.back()})))}()};function Wt(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return Yt(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Yt(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw r}}}}function Yt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var Vt=function(t){var e=null,i=null,n=[];this.draggable=function(t){t.element.addEventListener("mousedown",(function(e){e.preventDefault(),o(t),r(e.pageX,e.pageY)})),t.element.addEventListener("touchstart",(function(e){e.preventDefault(),o(t);var i=e.changedTouches[0];r(i.pageX,i.pageY)}))},this.droppable=function(t,e){n.push({view:t,callback:e})};var o=function(n){var o=n.paletteImage();t.element.appendChild(o),o.style.position="absolute",o.style.top=0,o.style.left=0,o.style.zIndex=100,o.style.cursor="pointer",i=n,e=o},r=function(i,n){if(null!==e){var o=t.element.getBoundingClientRect(),r=o.left+t.element.scrollLeft+window.pageXOffset,s=o.top+t.element.scrollTop+window.pageYOffset;return e.style.left=i-r-e.clientWidth/2+"px",e.style.top=n-s-e.clientHeight/2+"px",!0}return!1},s=function(o,r){if(null!==e){var s,a=Wt(n);try{for(a.s();!(s=a.n()).done;){var l=s.value,c=l.view.element;if("none"!==c.parentNode.style.display){var h=c.getBoundingClientRect(),u=h.left+c.scrollLeft+window.pageXOffset,d=h.top+c.scrollTop+window.pageYOffset;if(o>=u&&r>=d&&o<u+(h.right-h.left)&&r<d+(h.bottom-h.top)){l.callback(i,o-u,r-d);break}}}}catch(t){a.e(t)}finally{a.f()}t.element.removeChild(e),e=null,i=null}};t.element.addEventListener("mousemove",(function(t){0!==t.which?r(t.pageX,t.pageY):s(t.pageX,t.pageY)})),t.element.addEventListener("touchmove",(function(t){var e=t.changedTouches[0];r(e.pageX,e.pageY)})),t.element.addEventListener("mouseup",(function(t){s(t.pageX,t.pageY)})),t.element.addEventListener("touchend",(function(t){var e=t.changedTouches[0];s(e.pageX,e.pageY)})),t.element.addEventListener("touchcancel",(function(t){var e=t.changedTouches[0];s(e.pageX,e.pageY)}))};function _t(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return Gt(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Gt(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw r}}}}function Gt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var Jt=function(t,e,i){var o=this;this.cirsim=t,this.element=e,this.options=t.options,this.components=t.components,this.test=new Lt(this),this.div=null;var r,s=_t(i);try{for(s.s();!(r=s.n()).done;){var a=r.value;this.test.addTest(a)}}catch(t){s.e(t)}finally{s.f()}var l,c=_t(this.options.tests);try{for(c.s();!(l=c.n()).done;){var h=l.value;this.test.addTest(h)}}catch(t){c.e(t)}finally{c.f()}this.filename=null;var u=t.options,d=null,p=null,f=null,v=null,m=null,y=null;this.initialize=function(){var t=this;if("none"!==u.display){switch(I.addClass(e,"cirsim"),e.innerHTML="",u.display){case"full":I.addClass(e,"cirsim-full");break;case"inline":I.addClass(e,"cirsim-inline");break;default:I.addClass(e,"cirsim-window")}"window"===u.display&&(e.classList.contains("resizer")||new n.w(e,{handle:"10px solid #18453B"})),this.dragAndDrop=new Vt(this);var i=new MutationObserver((function(){document.body.contains(e)||(i.disconnect(),t.model.kill())}));i.observe(document.body,{childList:!0})}for(var o in d=new yt(this),this.model=d,this.options.tabs)this.model.circuits.add(new ft(this.options.tabs[o]));if(null!==this.options.load&&d.fmJSON(this.options.load),"inline"!==u.display&&"none"!==u.display&&(this.div=I.createClassedDiv("main"),this.element.appendChild(this.div),this.help=new Xt(this),v=new Ct(this),this.tabs=v,p=new G(this),this.menu=p,y=I.createClassedDiv("work"),this.div.appendChild(y),f=new nt(this,y),this.palette=f,v.create(y),m=I.createClassedDiv("cirsim-overlay"),this.div.appendChild(m),this.toast=new Rt(this),this.toast.create(this.div)),"inline"===u.display){var r=document.createElement("div");e.appendChild(r);var s=document.createElement("canvas");r.appendChild(s);var a=d.circuits.getCircuit("main"),l=new kt(this,s,a,0);d.getSimulation().setView(l),m=I.createClassedDiv("cirsim-overlay"),e.appendChild(m),this.toast=new Rt(this),this.toast.create(this.element)}var c=this.options.getAPI("open");null!==c&&void 0!==c.url&&void 0!==c.name&&(this.filename=c.name,new Ht(c.name,this.options,this.toast).open((function(e,i){d.fmJSON(i),t.reload(),t.filename=e})))},this.addTest=function(t){this.test.addTest(t)},this.currentView=function(){return v.currentView()},this.newTab=function(){null!==f&&f.refresh(),d.newTab()},this.backup=function(){d.backup()},this.undo=function(){d.undo(),v.undo(),f.refresh()},this.modal=function(t){m.style.display=t?"block":"none"},this.open=function(){var t=this;new qt(this.options,this.toast).open((function(e,i){d.fmJSON(i),t.reload(),t.filename=e}))},this.save=function(t,e){var i=o.options.getAPI("save");if(null!==i)if(void 0===i.name){if(!0!==t)if(null===o.filename)o.saveAs();else{var n=d.toJSON();new Ft(n,"application/json",o.filename,o.options,o.toast).open()}}else{var r=d.toJSON(),s=Object.assign({cmd:"save",name:i.name,data:r,type:"application/json"},i.extra);q.do({url:i.url,data:s,method:"POST",dataType:"json",contentType:i.contentType,success:function(t){var i=new xt(t);o.toast.jsonErrors(i)||!0!==e&&o.toast.message("Successfully saved to server")},error:function(t,e,i){console.log(t.responseText),o.toast.message("Unable to communicate with server: "+i)}})}},this.saveAs=function(){var t=this,e=d.toJSON(),i=new Mt(e,"application/json",this.options,this.toast);null!==this.filename&&(i.filename=this.filename),i.open((function(e){t.filename=e}))},this.export=function(){new Et(d).open()},this.import=function(){new zt(this,d).open()},this.importTab=function(){for(var t=0;t<this.options.imports.length;t++){var e=this.options.imports[t];if(e.into===this.currentView().circuit.name)return void this.currentView().importTab(e)}},this.reload=function(){v.destroy(),v.create(y,d)};var g=!1;this.isHelpDocked=function(){return g},this.dockedHelp=function(t){(g=t)?I.addClass(this.element,"docked-help"):I.removeClass(this.element,"docked-help")},this.load=function(t){d.fmJSON(t),this.reload()},this.initialize()};Jt.prototype.runTest=function(t){return this.test.runTest(t)};var Zt=function(t){for(var e in t=t||{},this.display="window",this.load=null,this.loadMenu=[],this.tabs=[],this.tabsMenu=!0,this.export="both",this.exportPNG=!1,this.testTime=17,this.userid=null,this.tests=[],this.imports=[],this.api=null,this.exit=null,this.global=null,this.components=["combinatorial","sequential"],this.always=["Zero","One","InPin","OutPin","Clock","Button","LED","Text"],this.showOutputStates=!1,t)if(t.hasOwnProperty(e)){if(!this.hasOwnProperty(e))throw new Error("Invalid option "+e);this[e]=t[e]}this.getAPI=function(t){if(null===this.api)return null;if(this.api===Object(this.api)){var e;if(void 0!==this.api[t]){var i=this.api[t];if(void 0===i.url)return null;e={url:i.url},void 0!==i.contentType?e.contentType=i.contentType:void 0!==this.api.contentType?e.contentType=this.api.contentType:e.contentType="application/x-www-form-urlencoded; charset=UTF-8",void 0!==i.extra?e.extra=i.extra:void 0!==this.api.extra?e.extra=this.api.extra:e.extra={},void 0!==i.name?e.name=i.name:void 0!==this.api.name&&(e.name=this.api.name)}else{if(void 0===this.api.url)return null;e={url:this.api.url},void 0!==this.api.extra?e.extra=this.api.extra:e.extra={},void 0!==this.api.name&&(e.name=this.api.name)}return e}return{url:this.api}}},Qt=function(){this.components=[],this.palettes={},this.add=function(t){this.components.push(t),this.components.sort((function(t,e){return t.order-e.order}))},this.get=function(t){for(var e=0;e<this.components.length;e++)if(this.components[e].type===t)return this.components[e];return null},this.addPalette=function(t,e){for(var i=[],n=0;n<e.length;n++)i.push(e[n].type);this.palettes[t]=i},this.getPalette=function(t){return this.palettes.hasOwnProperty(t)?this.palettes[t]:null}};var Kt=function(){B.call(this),this.height=16,this.width=16,this.addOut(8,0,8),this.outs[0].set(!1)};(Kt.prototype=Object.create(B.prototype)).constructor=Kt,Kt.prototype.prefix=null,Kt.type="Zero",Kt.label="0",Kt.desc="0 (false)",Kt.description="<h2>Zero</h2><p>A simple false value.</p>",Kt.order=0,Kt.help="zero",Kt.prototype.compute=function(t){this.outs[0].set(!1)},Kt.prototype.clone=function(){var t=new Kt;return t.copyFrom(this),t},Kt.prototype.draw=function(t,e){this.selectStyle(t,e),this.drawBox(t),this.drawText(t,"0",0,5,"14px Times"),this.drawIO(t,e)},Kt.paletteImage=function(){var t=new J(60,30);return t.box(16,16),t.io(8,0,"e"),t.drawText("0",0,5,"14px Times"),t};var $t=function(){B.call(this),this.height=16,this.width=16,this.addOut(8,0,8),this.outs[0].set(!0)};($t.prototype=Object.create(B.prototype)).constructor=$t,$t.prototype.prefix=null,$t.type="One",$t.label="1",$t.desc="1 (true)",$t.description="<h2>One</h2><p>A simple true value.</p>",$t.order=1,$t.help="one",$t.prototype.compute=function(t){this.outs[0].set(!0)},$t.prototype.clone=function(){var t=new $t;return t.copyFrom(this),t},$t.prototype.draw=function(t,e){this.selectStyle(t,e),this.drawBox(t),this.drawText(t,"1",0,5,"14px Times"),this.drawIO(t,e)},$t.paletteImage=function(){var t=new J(60,30);return t.box(16,16),t.io(8,0,"e"),t.drawText("1",0,5,"14px Times"),t};var te=function(){B.call(this),this.height=50,this.width=64,this.addIn(-32,-16,16),this.addIn(-32,16,16),this.addOut(32,0,16)};(te.prototype=Object.create(B.prototype)).constructor=te,te.type="And",te.label="AND",te.desc="AND gate",te.order=11,te.description="<h2>AND Gate</h2><p>The output of an AND gate is <em>true</em> if both inputs are true.</p>",te.help="and",te.prototype.compute=function(t){t[0]&&t[1]?this.outs[0].set(!0):!1===t[0]||!1===t[1]?this.outs[0].set(!1):this.outs[0].set(void 0)},te.prototype.clone=function(){var t=new te;return t.copyFrom(this),t},te.prototype.draw=function(t,e){this.selectStyle(t,e),te.path(t,this.x,this.y,this.width,this.height),Q.fillWith(t),t.stroke(),this.drawName(t,-2,5),this.drawIO(t,e)},te.path=function(t,e,i,n,o){var r=e-n/2-.5,s=e+n/2+.5,a=i-o/2-.5,l=i+o/2+.5;t.beginPath(),t.moveTo(r,l),t.lineTo(r,a),t.lineTo(s-o/2,a),t.arc(s-o/2,i,o/2+.5,-Math.PI/2,Math.PI/2),t.lineTo(r,l)},te.paletteImageBase=function(){var t=new J(120,70),e=t.context;e.lineWidth=1.5;var i=t.width/2,n=t.height/2,o=.5*t.width,r=(t.height,26.5),s=i-o/2-.5,a=i+o/2+.5,l=n-r+.5,c=n+r-.5;return this.leftX=s-t.width/2,this.rightX=a-t.width/2,e.beginPath(),e.moveTo(s,c),e.lineTo(s,l),e.lineTo(a-r,l),e.arc(a-r,n,r,-Math.PI/2,Math.PI/2),e.lineTo(s,c),t.fillStroke(),t.io(this.rightX,0,"e"),t},te.paletteImage=function(){var t=te.paletteImageBase();return t.io(this.leftX,-16,"w"),t.io(this.leftX,16,"w"),t};var ee=function t(){B.call(this),this.height=50,this.width=64;var e=t.offsetX,i=Math.atan2(this.height/2,e),n=e/Math.cos(i),o=Math.sqrt(n*n-256)-e;this.addIn(-32+o,-16,16+o),this.addIn(-32+o,16,16+o),this.addOut(32,0,16)};(ee.prototype=Object.create(B.prototype)).constructor=ee,ee.offsetX=40,ee.offsetY=30,ee.type="Or",ee.label="OR",ee.desc="OR gate",ee.order=20,ee.description="<h2>OR Gate</h2><p>The output of an OR gate is <em>true</em> \nif either or both inputs are true. Otherwise, it is false.</p>",ee.help="or",ee.prototype.compute=function(t){t[0]||t[1]?this.outs[0].set(!0):void 0===t[0]||void 0===t[1]?this.outs[0].set(void 0):this.outs[0].set(!1)},ee.prototype.clone=function(){var t=new ee;return t.copyFrom(this),t},ee.prototype.draw=function(t,e){this.selectStyle(t,e),ee.draw(t,this.x,this.y,this.width,this.height),this.drawName(t,-2,5),this.drawIO(t,e)},ee.draw=function(t,e,i,n,o){ee.path(t,e,i,n,o),Q.fillWith(t),t.stroke()},ee.path=function(t,e,i,n,o){var r=e-n/2-.5,s=i-o/2-.5,a=i+o/2+.5;t.beginPath();var l=ee.offsetX,c=Math.atan2(o/2,l),h=l/Math.cos(c);t.arc(r-l,i,h,-c,c);var u=(n/2*(n/2)-o/2*(o/2))/o;h=o/2+u,c=Math.atan2(u,n/2),t.lineTo(e,a),t.arc(e,i-u,h,Math.PI/2,c,!0),t.arc(e,i+u,h,-c,-Math.PI/2,!0),t.lineTo(r,s)},ee.paletteImageBase=function(){var t=new J(120,70),e=t.context;e.lineWidth=1.5;var i=t.width/2,n=t.height/2,o=.5*t.width,r=.65*t.height,s=i-o/2-.5,a=i+o/2+.5,l=Math.round(n-r/2)-.5,c=Math.round(n+r/2)+.5;e.beginPath();var h=ee.offsetX,u=Math.atan2(r/2,h),d=h/Math.cos(u);e.arc(s-h,n,d,-u,u);var p=(o/2*(o/2)-r/2*(r/2))/r;return d=r/2+p,u=Math.atan2(p,o/2),this.leftX=s-t.width/2+3,this.rightX=a-t.width/2,e.lineTo(i,c),e.arc(i,n-p,d,Math.PI/2,u,!0),e.arc(i,n+p,d,-u,-Math.PI/2,!0),e.lineTo(s,l),t.fillStroke(),t.io(this.rightX,0,"e"),t},ee.paletteImage=function(){var t=ee.paletteImageBase();return t.io(this.leftX,-16,"w"),t.io(this.leftX,16,"w"),t};var ie=function t(){B.call(this),this.height=50,this.width=64;var e=t.offsetX,i=Math.atan2(this.height/2,e),n=e/Math.cos(i),o=Math.sqrt(n*n-256)-e,r=Math.sqrt(n*n-4)-e;this.addIn(-32+o,-16,16+o),this.addIn(-32+r,0,16+r),this.addIn(-32+o,16,16+o),this.addOut(32,0,16)};(ie.prototype=Object.create(B.prototype)).constructor=ie,ie.offsetX=40,ie.offsetY=30,ie.type="Or3",ie.label="OR",ie.desc="OR gate",ie.order=21,ie.description="<h2>OR Gate</h2><p>The output of a three-input OR gate is <em>true</em> if any of of the inputs are true. Otherwise, it is false.</p>",ie.prototype.compute=function(t){t[0]||t[1]||t[2]?this.outs[0].set(!0):void 0===t[0]||void 0===t[1]||void 0===t[2]?this.outs[0].set(void 0):this.outs[0].set(!1)},ie.prototype.clone=function(){var t=new ie;return t.copyFrom(this),t},ie.prototype.draw=function(t,e){this.selectStyle(t,e),ee.draw(t,this.x,this.y,this.width,this.height),this.drawName(t,-2,5),this.drawIO(t,e)},ie.paletteImage=function(){var t=ee.paletteImageBase();return t.io(ee.leftX,-16,"w"),t.io(ee.leftX,0,"w"),t.io(ee.leftX,16,"w"),t};var ne=function t(){B.call(this),this.height=64,this.width=64;var e=t.offsetX,i=Math.atan2(this.height/2,e),n=e/Math.cos(i),o=Math.sqrt(n*n-64)-e,r=Math.sqrt(n*n-576)-e;this.addIn(-32+r,-24,16+r),this.addIn(-32+o,-8,16+o),this.addIn(-32+o,8,16+o),this.addIn(-32+r,24,16+r),this.addOut(32,0,16)};(ne.prototype=Object.create(B.prototype)).constructor=ne,ne.offsetX=40,ne.offsetY=30,ne.type="Or4",ne.label="OR",ne.desc="OR gate",ne.order=22,ne.description="<h2>OR Gate</h2><p>The output of a four-input OR gate is <em>true</em> if any of of the inputs are true. Otherwise, it is false.</p>",ne.prototype.compute=function(t){t[0]||t[1]||t[2]||t[3]?this.outs[0].set(!0):void 0===t[0]||void 0===t[1]||void 0===t[2]||void 0===t[3]?this.outs[0].set(void 0):this.outs[0].set(!1)},ne.prototype.clone=function(){var t=new ne;return t.copyFrom(this),t},ne.prototype.draw=function(t,e){this.selectStyle(t,e),ee.draw(t,this.x,this.y,this.width,this.height),this.drawName(t,-2,5),this.drawIO(t,e)},ne.paletteImage=function(){var t=ee.paletteImageBase();return t.io(ee.leftX,-16,"w"),t.io(ee.leftX,-5.5,"w"),t.io(ee.leftX,5.5,"w"),t.io(ee.leftX,16,"w"),t};var oe=function(){ee.call(this,name),this.outs=[],this.addOutInv(32,0,16)};(oe.prototype=Object.create(ee.prototype)).constructor=oe,oe.type="Nor",oe.label="NOR",oe.desc="NOR gate",oe.img="nor.png",oe.order=30,oe.description="<h2>NOR Gate</h2><p>The output of a NOR gate is <em>false</em> if either or both \n inputs are true. Otherwise, it is true.</p>",oe.help="nor",oe.prototype.clone=function(){var t=new oe;return t.copyFrom(this),t};var re=function(){B.call(this),this.height=50,this.width=64,this.addIn(-32,-16,16),this.addIn(-32,0,16),this.addIn(-32,16,16),this.addOut(32,0,16)};(re.prototype=Object.create(B.prototype)).constructor=re,re.type="And3",re.label="AND",re.desc="3-Input AND gate",re.order=12,re.description="<h2>AND Gate</h2><p>The output of a three-input AND gate is <em>true</em> if all three inputs are true.</p>",re.help="and3",re.prototype.compute=function(t){t[0]&&t[1]&&t[2]?this.outs[0].set(!0):void 0===t[0]||void 0===t[1]||void 0===t[2]?this.outs[0].set(void 0):this.outs[0].set(!1)},re.prototype.clone=function(){var t=new re;return t.copyFrom(this),t},re.prototype.draw=function(t,e){this.selectStyle(t,e);var i=this.x-this.width/2-.5,n=this.x+this.width/2+.5,o=this.y-this.height/2-.5,r=this.y+this.height/2+.5;t.beginPath(),t.moveTo(i,o),t.lineTo(i,r),t.moveTo(i,o),t.lineTo(n-this.height/2,o),t.moveTo(i,r),t.lineTo(n-this.height/2,r),t.stroke(),t.beginPath(),t.arc(n-this.height/2,this.y,this.height/2+.5,-Math.PI/2,Math.PI/2),null!==this.naming&&(t.font="14px Times",t.textAlign="center",t.fillText(this.naming,this.x-2,this.y+5)),t.stroke(),this.drawIO(t,e)},re.paletteImage=function(){var t=te.paletteImageBase();return t.io(te.leftX,-16,"w"),t.io(te.leftX,0,"w"),t.io(te.leftX,16,"w"),t};var se=function(){B.call(this),this.height=50,this.width=64,this.addIn(-32,-24,16),this.addIn(-32,-8,16),this.addIn(-32,8,16),this.addIn(-32,24,16),this.addOut(32,0,16)};(se.prototype=Object.create(B.prototype)).constructor=se,se.type="And4",se.label="AND",se.desc="4-Input AND gate",se.order=13,se.description="<h2>AND Gate</h2><p>The output of a four-input AND gate is <em>true</em> if all four inputs are true.</p>",se.help="and4",se.prototype.compute=function(t){t[0]&&t[1]&&t[2]&&t[3]?this.outs[0].set(!0):void 0===t[0]||void 0===t[1]||void 0===t[2]||void 0===t[3]?this.outs[0].set(void 0):this.outs[0].set(!1)},se.prototype.clone=function(){var t=new se;return t.copyFrom(this),t},se.prototype.draw=function(t,e){this.selectStyle(t,e);var i=this.x-this.width/2-.5,n=this.x+this.width/2+.5,o=this.y-this.height/2-.5,r=this.y+this.height/2+.5;t.beginPath(),t.moveTo(i,o),t.lineTo(i,r),t.moveTo(i,o),t.lineTo(n-this.height/2,o),t.moveTo(i,r),t.lineTo(n-this.height/2,r),t.stroke(),t.beginPath(),t.arc(n-this.height/2,this.y,this.height/2+.5,-Math.PI/2,Math.PI/2),null!==this.naming&&(t.font="14px Times",t.textAlign="center",t.fillText(this.naming,this.x-2,this.y+5)),t.stroke(),this.drawIO(t,e)},se.paletteImage=function(){var t=te.paletteImageBase();t.height;return t.io(te.leftX,-24,"w"),t.io(te.leftX,-8,"w"),t.io(te.leftX,8,"w"),t.io(te.leftX,24,"w"),t};var ae=function(){te.call(this,name),this.outs=[],this.addOutInv(32,0,16)};(ae.prototype=Object.create(te.prototype)).constructor=ae,ae.type="Nand",ae.label="NAND",ae.desc="NAND gate",ae.order=16,ae.description="<h2>NAND Gate</h2><p>The output of a NAND gate is <em>false</em> if and only if both inputs are true.</p>",ae.help="nand",ae.prototype.clone=function(){var t=new ae;return t.copyFrom(this),t},ae.paletteImage=function(){var t=te.paletteImageBase();return t.io(te.leftX,-16,"w"),t.io(te.leftX,16,"w"),t.io(te.rightX+10,0,"e"),t.circle(te.rightX+5,0,5),t};var le=function(t,e,i,n){this.x=t,this.y=e,this.color="undefined",void 0===n?(this.radius=i,this.width=2*i,this.height=2*i):(this.radius=null,this.width=i,this.height=n)};le.colors={black:["#000000","#000000"],undefined:["#444444","#888888"],green:["#55ff88","#00fb4a"],red:["#ff4444","#ff0000"],blue:["#25ffff","#15ddff"],purple:["#c000ff","#8000ff"],yellow:["#ffff00","#ffff80"],none:["#000000","#000000"]},le.prototype.draw=function(t,e,i,n){if("none"!==this.color){var o=t.fillStyle;void 0===n&&(n="white"),t.beginPath(),e+=this.x,i+=this.y;var r,s,a=1.15*this.radius;if(le.colors.hasOwnProperty(this.color)?(r=le.colors[this.color][0],s=le.colors[this.color][1]):(r="#000000",s="#000000"),null!==this.radius){var l=t.createRadialGradient(e,i,1,e,i,a);l.addColorStop(0,r),l.addColorStop(.5,s),l.addColorStop(1,n),t.fillStyle=l}else{var c=t.createLinearGradient(0,i-this.height/2,0,i+this.height/2);c.addColorStop(0,n),c.addColorStop(.25,r),c.addColorStop(.75,r),c.addColorStop(1,n),t.fillStyle=c}t.fillRect(e-this.width/2,i-this.height/2,this.width,this.height),"undefined"===this.color&&(t.font="14px Times",t.fillStyle="#ffffff",t.fontWeight="bold",t.textAlign="center",t.fillText("?",e,i+5),t.fillText("?",e+1,i+5),t.fontWeight="normal"),t.fillStyle=o}},le.prototype.touch=function(t,e,i,n){return t+=this.x,e+=this.y,s.distance({x:t,y:e},{x:i,y:n})<=this.radius},le.colorSelector=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n='<div class="control1 center"><label for="'+t+'">Color: </label><select id="'+t+'">',o=le.colors;for(var r in o)o.hasOwnProperty(r)&&"black"!==r&&"undefined"!==r&&(!0!==i&&"none"===r||(n+=r===e?"<option selected>"+r+"</option>":"<option>"+r+"</option>"));return n+="</select></div>"};var ce=function(){B.call(this),this.height=16,this.width=64,this.led=new le(19,0,7),this.addOut(32,0,16),this.set(!1)};(ce.prototype=Object.create(B.prototype)).constructor=ce,ce.prototype.prefix="*I",ce.prototype.nameRequired=!0,ce.type="InPin",ce.label="In Pin",ce.desc="Input Pin",ce.img="inpin.png",ce.order=2,ce.description="<h2>Input Pin</h2><p>An IN pin serves as input for a circuit. Clicking the LED toggles the output true or false.</p>",ce.help="inpin",ce.prototype.clone=function(){var t=new ce;return t.value=this.value,t.copyFrom(this),t},ce.prototype.compute=function(t){this.outs[0].set(this.value)},ce.prototype.draw=function(t,e){var i=this.value?"white":"#dddddd";this.outlinePath(t),t.fillStyle=i,t.fill(),this.led.color=this.value?"green":"off",this.led.draw(t,this.x,this.y,i),this.selectStyle(t,e),this.outlinePath(t),t.stroke(),t.beginPath(),t.font="14px Times",t.textAlign="center";var n=this.value?"1":"0",o=this.x-9;null!==this.naming?t.fillText(this.naming+": "+n,o,this.y+5):t.fillText(n,o,this.y+5),this.drawIO(t,e)},ce.prototype.outlinePath=function(t){var e=this.x-this.width/2-.5,i=this.x+this.width/2+.5,n=this.y-this.height/2-.5,o=this.y+this.height/2+.5;t.beginPath(),t.moveTo(e,n),t.lineTo(e,o),t.lineTo(i-this.height/2,o),t.lineTo(i,this.y),t.lineTo(i-this.height/2,n),t.lineTo(e,n)},ce.prototype.touch=function(t,e){return this.led.touch(this.x,this.y,t,e)?(this.circuit.circuits.model.backup(),this.set(!this.value),null):B.prototype.touch.call(this,t,e)},ce.prototype.set=function(t){"string"==typeof t||t instanceof String?this.setAsString(t):(this.value=t,this.outs[0].set(t))},ce.prototype.setAsString=function(t){switch(t){case void 0:case"undefined":case"?":this.set(void 0);break;case"false":case"0":case!1:this.set(!1);break;case"true":case"1":case!0:this.set(!0);break;default:var e=1==+t;this.set(e)}},ce.prototype.get=function(){return this.value},ce.prototype.save=function(){var t=B.prototype.save.call(this);return t.value=this.value,t},ce.prototype.load=function(t){this.set(t.value),B.prototype.load.call(this,t)},ce.prototype.properties=function(t){var e=this,i=new C(this,t),n=i.uniqueId(),o='<div class="control center"><div class="choosers"><label><input type="radio" id="'+n+'" value="1" name="'+n+'"'+(this.value?" checked":"")+'> true (1)</label><label><input type="radio" id="'+n+'" value="0" name="'+n+'"'+(this.value?"":" checked")+"> false (0)</label></div></div>";i.extra(o,(function(){return null}),(function(){e.set("1"===document.querySelector("#"+n+":checked").value)})),i.open()};var he=function(){B.call(this),this.height=16,this.width=64,this.color="green",this.led=new le(-19,0,7),this.addIn(-32,0,16)};(he.prototype=Object.create(B.prototype)).constructor=he,he.prototype.prefix="O",he.prototype.nameRequired=!0,he.type="OutPin",he.label="Out Pin",he.desc="Output Pin",he.img="outpin.png",he.order=3,he.description="<h2>Ouput Pin</h2><p>An OUT pin serves as output \nfor a circuit. The LED indicates if the input is true (led illuminated), false \n(black), or undefined (?).</p>",he.help="outpin",he.prototype.pending=function(){},he.prototype.get=function(){return this.ins[0].value},he.prototype.getAsString=function(){switch(this.ins[0]){case!0:return"1";case!1:return"0";default:return"?"}},he.prototype.getAsValue=function(){return new Bt(this.ins[0].value)},he.prototype.clone=function(){var t=new he;return t.color=this.color,t.copyFrom(this),t},he.prototype.load=function(t){void 0!==t.color&&(this.color=ot.sanitize(t.color)),B.prototype.load.call(this,t)},he.prototype.save=function(){var t=B.prototype.save.call(this);return"green"!==this.color&&(t.color=this.color),t},he.prototype.draw=function(t,e){var i=this.get(),n=this.value?"white":"#dddddd";if(this.outlinePath(t),t.fillStyle=n,t.fill(),"none"!==this.color&&(this.led.color=void 0===i?"undefined":i?this.color:"off",this.led.draw(t,this.x,this.y,n)),this.selectStyle(t,e),this.outlinePath(t),t.stroke(),t.beginPath(),t.font="14px Times",t.textAlign="center","none"!==this.color){var o=void 0===i?"?":i?"1":"0",r=this.x+9;null!==this.naming?t.fillText(this.naming+": "+o,r,this.y+5):t.fillText(o,r,this.y+5)}else{var s=this.x+4;null!==this.naming&&t.fillText(this.naming,s,this.y+5)}this.drawIO(t,e)},he.prototype.outlinePath=function(t){var e=this.x-this.width/2-.5,i=this.x+this.width/2+.5,n=this.y-this.height/2-.5,o=this.y+this.height/2+.5;t.beginPath(),t.moveTo(e,this.y),t.lineTo(e+this.height/2,o),t.lineTo(i,o),t.lineTo(i,n),t.lineTo(e+this.height/2,n),t.lineTo(e,this.y)},he.prototype.properties=function(t){var e=this,i=new C(this,t),n='<div class="control1 center">',o=i.uniqueId();n+=le.colorSelector(o,this.color,!0),n+="</div>",i.extra(n,(function(){return null}),(function(){e.color=ot.sanitize(document.getElementById(o).value)})),i.open()};var ue=function(){B.call(this),this.height=44,this.width=44,this.freq=1e6,this.period=.5,this.addOut(22,0,10),this.set(!0),this.remaining=1/this.freq*this.period};(ue.prototype=Object.create(B.prototype)).constructor=ue,ue.prototype.prefix="C",ue.type="Clock",ue.label="Clock",ue.desc="Clock",ue.img="clock.png",ue.order=104,ue.description="<h2>Clock</h2><p>A clock generates a sequence of pulses over time. The duty cycle is the width of the true period of the pulse as a percentage.</p>",ue.prototype.clone=function(){var t=new ue;return t.freq=this.freq,t.period=this.period,t.value=this.value,t.remaining=this.remaining,t.copyFrom(this),t},ue.prototype.advance=function(t){return this.remaining-=t,this.remaining<=0&&(this.set(!this.value),this.remaining=1/this.freq*(this.value?this.period:1-this.period),!0)},ue.prototype.set=function(t){this.value=t,this.outs[0].set(t)},ue.prototype.get=function(){return this.value},ue.prototype.compute=function(t){this.set(!1)},ue.prototype.load=function(t){this.freq=t.freq,this.period=t.period,B.prototype.load.call(this,t)},ue.prototype.save=function(){var t=B.prototype.save.call(this);return t.freq=this.freq,t.period=this.period,t},ue.prototype.draw=function(t,e){this.selectStyle(t,e);var i=this.x,n=this.y;t.beginPath(),t.arc(i,n,this.width/2,0,2*Math.PI),t.fillStyle="#ffffff",t.fill(),t.beginPath(),t.arc(i,n,this.width/2,0,2*Math.PI),t.stroke();var o=this.x-15.5,r=this.x+15.5,s=this.y-10.4,a=this.y+10.5,l=o+this.period*(r-o),c=t.strokeStyle;t.strokeStyle="#00aa00",t.beginPath(),t.moveTo(o,a),t.lineTo(o,s),t.lineTo(l,s),t.lineTo(l,a),t.lineTo(r,a),null!==this.naming&&(t.font="14px Times",t.textAlign="center",t.fillText(this.naming,this.x-2,this.y+5)),t.stroke(),t.strokeStyle=c,this.drawIO(t,e)},ue.prototype.properties=function(t){var e=this,i=new C(this,t),n=i.uniqueId(),o=i.uniqueId(),r='<div class="control"><label for="'.concat(n,'">Frequency (Hz)</label>\n<input type="text" id="').concat(n,'" value="').concat(this.freq,'"></div>\n<div class="control slider"><label for="').concat(o,'">Duty Cycle</label>\n<input type="range" min="100" max="900" class="" value="').concat(1e3*this.period,'" id="').concat(o,'">\n</div>');i.extra(r,(function(){var t=document.getElementById(n).value;return+t!==parseInt(t)||t<1||t>1e7?"Frequency must be integer 1 to 1000000":null}),(function(){e.freq=document.getElementById(n).value,e.period=.001*document.getElementById(o).value})),i.open()};var de=function(){B.call(this),this.height=50,this.width=40,this.addIn(-20,0,12),this.addOutInv(20,0,12)};(de.prototype=Object.create(B.prototype)).constructor=de,de.type="Inverter",de.label="Inverter",de.desc="Inverter gate",de.order=50,de.description="<h2>Inverter</h2><p>The output of an Inverter gate is <em>true</em> if the \n input is false and <em>false</em> if the input is true.</p>",de.help="inverter",de.prototype.compute=function(t){this.outs[0].set(t[0])},de.prototype.clone=function(){var t=new de;return t.copyFrom(this),t},de.prototype.draw=function(t,e){this.selectStyle(t,e),de.path(t,this.x,this.y,this.width,this.height),Q.fillWith(t),de.path(t,this.x,this.y,this.width,this.height),t.stroke(),null!==this.naming&&(t.font="14px Times",t.textAlign="center",t.fillText(this.naming,this.x-6,this.y+5),t.stroke()),this.drawIO(t,e)},de.path=function(t,e,i,n,o){var r=e-n/2-.5,s=e+n/2+.5,a=i-o/2-.5,l=i+o/2+.5;t.beginPath(),t.moveTo(r,a),t.lineTo(r,l),t.lineTo(s,i),t.lineTo(r,a)},de.paletteImage=function(){var t=new J(120,70);return de.path(t.context,60,35,40,50),t.fillStroke(),t.io(-20,0,"w"),t.io(30,0,"e"),t.circle(25,0,5),t};var pe=function(){B.call(this),this.height=32,this.width=32,this.value=void 0,this.led=new le(0,0,12),this.color="blue",this.addIn(-16,0,16)};(pe.prototype=Object.create(B.prototype)).constructor=pe,pe.prototype.prefix="L",pe.prototype.nameRequired=!0,pe.type="LED",pe.label="LED",pe.desc="Light Emitting Diode",pe.img="led.png",pe.order=102,pe.description="<h2>LED</h2><p>An LED indicates if the input is true (color), false (black), or undefined (?). The LED color can be set using the component properties dialog box.</p>",pe.prototype.compute=function(t){this.value=t[0]},pe.prototype.get=function(){return this.ins[0].value},pe.prototype.clone=function(){var t=new pe;return t.color=this.color,t.value=this.value,t.copyFrom(this),t},pe.prototype.draw=function(t,e){var i=this.get(),n=this.x-this.width/2-.5,o=this.y-this.height/2+.5;this.selectStyle(t,e);var r=t.fillStyle,s=t.strokeStyle,a=i?"#ffffff":"#dddddd";t.fillStyle=a,t.fillRect(n,o,this.width,this.height),t.fillStyle=r,t.beginPath(),t.rect(n,o,this.width,this.height),t.stroke(),t.lineWidth=1,t.fillStyle=r,t.strokeStyle=s,this.led.color=void 0===i?"undefined":i?this.color:"off",this.led.draw(t,this.x-.5,this.y,a);var l=12;t.fillRect(this.x-l-2,this.y-l,2,2),t.fillRect(this.x+l-2,this.y-l,2,2),t.fillRect(this.x-l-2,this.y+l,2,2),t.fillRect(this.x+l-2,this.y+l,2,2),this.drawIO(t,e)},pe.prototype.outlinePath=function(t){var e=this.x-this.width/2-.5,i=this.x+this.width/2+.5,n=this.y-this.height/2-.5,o=this.y+this.height/2+.5;t.beginPath(),t.moveTo(e,this.y),t.lineTo(e+this.height/2,o),t.lineTo(i,o),t.lineTo(i,n),t.lineTo(e+this.height/2,n),t.lineTo(e,this.y)},pe.prototype.load=function(t){this.color=ot.sanitize(t.color),B.prototype.load.call(this,t)},pe.prototype.save=function(){var t=B.prototype.save.call(this);return t.color=this.color,t},pe.prototype.properties=function(t){var e=this,i=new C(this,t,!1),n=i.uniqueId(),o=le.colorSelector(n,this.color);i.extra(o,(function(){return null}),(function(){e.color=ot.sanitize(document.getElementById(n).value)})),i.open()};var fe=function t(){B.call(this),this.height=50,this.width=64;var e=t.offsetX,i=Math.atan2(this.height/2,e),n=e/Math.cos(i),o=Math.sqrt(n*n-256)-e;this.addIn(-32+o,-16,16+o),this.addIn(-32+o,16,16+o),this.addOut(32,0,16)};(fe.prototype=Object.create(B.prototype)).constructor=fe,fe.offsetX=40,fe.offsetY=30,fe.offsetX1=6,fe.type="Xor",fe.label="XOR",fe.desc="XOR gate",fe.img="xor.png",fe.order=40,fe.description="<h2>XOR Gate</h2><p>The output of an XOR gate is <em>true</em> if the state of the inputs differ. Otherwise, it is false.</p>",fe.help="xor",fe.prototype.compute=function(t){void 0===t[0]||void 0===t[1]?this.outs[0].set(void 0):this.outs[0].set(t[0]&&!t[1]||!t[0]&&t[1])},fe.prototype.clone=function(){var t=new fe;return t.copyFrom(this),t},fe.prototype.draw=function(t,e){this.selectStyle(t,e),ee.draw(t,this.x,this.y,this.width,this.height),t.beginPath();var i=this.x-this.width/2-.5,n=fe.offsetX,o=Math.atan2(this.height/2,n),r=n/Math.cos(o);t.arc(i-n-fe.offsetX1,this.y,r,-o,o),t.stroke(),this.drawName(t,-2,5),this.drawIO(t,e)};var ve=function(){B.call(this),this.height=16,this.width=96,this.narrow=!1,this.value=new Bt,this.addOut(48,0,16).bus=!0,this.set([!1,!1,!1,!1])};(ve.prototype=Object.create(B.prototype)).constructor=ve,ve.prototype.prefix="I",ve.prototype.nameRequired=!0,ve.type="InPinBus",ve.label="Bus Input",ve.desc="Bus Input Pin",ve.img="inpinbus.png",ve.order=300,ve.description="<h2>Bus Input Pin</h2><p>A Bus Input pin serves as input for a circuit from a bus. Double-click to set the value.</p><p>Values can be preceeded by 0x or 0b for hexadecimal or binary values.</p><p>The display and input format is selectable. Auto format will display values with eight or fewer digits as binary and larger values in hex.</p>",ve.help="inpinbus",ve.prototype.clone=function(){var t=new ve;return t.copyFrom(this),t.value=this.value.clone(),t},ve.prototype.compute=function(t){this.outs[0].set(this.value.get())},ve.prototype.draw=function(t,e){this.outlinePath(t),t.fillStyle="#dddddd",t.fill(),this.selectStyle(t,e),this.outlinePath(t),t.stroke();var i=this.x;this.narrow&&(i=this.x-this.height/4+1),this.value.draw(t,i,this.y,this.width-this.height/2,this.naming),this.drawIO(t,e)},ve.prototype.outlinePath=function(t){var e=this.x-this.width/2-.5,i=this.x+this.width/2+.5,n=this.y-this.height/2-.5,o=this.y+this.height/2+.5;t.beginPath(),t.moveTo(e,n),t.lineTo(e,o),t.lineTo(i-this.height/2,o),t.lineTo(i,this.y),t.lineTo(i-this.height/2,n),t.lineTo(e,n)},ve.prototype.set=function(t){Array.isArray(t)?this.value.set(t):("string"==typeof t||t instanceof String)&&this.value.setAsString(t),this.outs[0].set(this.value.get())},ve.prototype.get=function(){return this.value.get()},ve.prototype.setAsString=function(t,e){this.value.setAsString(t,e),e||this.outs[0].set(this.value.get())},ve.prototype.getAsString=function(){return this.value.getAsString()},ve.prototype.save=function(){var t=B.prototype.save.call(this);return this.value.save(t),this.narrow&&(t.narrow=this.narrow),t},ve.prototype.load=function(t){this.value.load(t),this.setNarrow(ot.boolean(t.narrow)),B.prototype.load.call(this,t)},ve.prototype.properties=function(t){var e=this,i=new C(this,t),n=i.uniqueId(),o=this.value.dialogContent(i,!0),r=o.html+'<input type="checkbox" id="'.concat(n,'" name="').concat(n,'"').concat(this.narrow?" checked":"",'> <label for="').concat(n,'">Narrow</label>');i.extra(r,o.validate,(function(){o.accept(),e.setNarrow(document.getElementById(n).checked),e.compute(null)})),i.open()},ve.prototype.setNarrow=function(t){this.narrow=t,this.width=t?48:96,this.outs[0].x=this.width/2};var me=function(){B.call(this),this.value=new Bt,this.narrow=!1,this.height=16,this.width=96,this.addIn(-this.width/2,0,16).bus=!0};(me.prototype=Object.create(B.prototype)).constructor=me,me.prototype.prefix="O",me.prototype.nameRequired=!0,me.type="OutPinBus",me.label="Bus Output",me.desc="Bus Output Pin",me.img="outpinbus.png",me.order=302,me.description="<h2>Bus Output Pin</h2>\n<p>An Bus Out pin serves as output for a bus in a circuit.</p>\n<p>The output format is selectable. Auto format will display values \nwith eight or fewer digits as binary and larger values in hex.</p>",me.help="outpinbus",me.prototype.compute=function(t){this.value.set(t[0])},me.prototype.get=function(){return this.value.get()},me.prototype.getAsString=function(){return this.value.getAsString()},me.prototype.getAsValue=function(){return new Bt(this.value)},me.prototype.clone=function(){var t=new me;return t.copyFrom(this),t.value=this.value.clone(),t},me.prototype.save=function(){var t=B.prototype.save.call(this);return this.value.save(t),this.narrow&&(t.narrow=this.narrow),t},me.prototype.load=function(t){this.value.load(t),this.setNarrow(ot.boolean(t.narrow)),B.prototype.load.call(this,t)},me.prototype.draw=function(t,e){this.outlinePath(t),t.fillStyle="#dddddd",t.fill(),this.selectStyle(t,e),this.outlinePath(t),t.stroke();var i=this.x+this.height/4;this.narrow&&(i-=2),this.value.draw(t,i,this.y,this.width-this.height/2,this.naming),this.drawIO(t,e)},me.prototype.outlinePath=function(t){var e=this.x-this.width/2-.5,i=this.x+this.width/2+.5,n=this.y-this.height/2-.5,o=this.y+this.height/2+.5;t.beginPath(),t.moveTo(e,this.y),t.lineTo(e+this.height/2,o),t.lineTo(i,o),t.lineTo(i,n),t.lineTo(e+this.height/2,n),t.lineTo(e,this.y)},me.prototype.properties=function(t){var e=this,i=new C(this,t),n=i.uniqueId(),o=this.value.dialogContent(i),r=o.html+'<input type="checkbox" id="'.concat(n,'" name="').concat(n,'"').concat(this.narrow?" checked":"",'> <label for="').concat(n,'">Narrow</label>');i.extra(r,o.validate,(function(){o.accept(),e.setNarrow(document.getElementById(n).checked)})),i.open()},me.prototype.setNarrow=function(t){this.narrow=t,this.width=t?48:96,this.ins[0].x=-this.width/2};var ye=function(){B.call(this),this.height=16,this.width=96,this.value=new Bt,this.addOut(48,0,16).bus=!0,this.set([!1,!1,!1,!1])};(ye.prototype=Object.create(B.prototype)).constructor=ye,ye.prototype.prefix=null,ye.type="BusConstant",ye.label="Bus Constant",ye.desc="Bus Constant value",ye.img="busconstant.png",ye.description="<h2>Bus Constant Value</h2><p>A Bus Constant is a value that can be set in the circuit as a fixed value feeding a bus.</p><p>Values can be preceeded by 0x or 0b for hexadecimal or binary values.</p><p>The display and input format is selectable. Auto format will display values with eight or fewer digits as binary and larger values in hex.</p>",ye.order=301,ye.prototype.clone=function(){var t=new ye;return t.copyFrom(this),t.value=this.value.clone(),t},ye.prototype.compute=function(t){this.outs[0].set(this.value.get())},ye.prototype.draw=function(t,e){this.drawBox(t),t.fillStyle="#dddddd",t.fill(),this.selectStyle(t,e),this.drawBox(t),this.value.draw(t,this.x,this.y,this.width-this.height/2,this.naming),this.drawIO(t,e)},ye.prototype.set=function(t){this.value.set(t),this.outs[0].set(this.value.get())},ye.prototype.get=function(){return this.value.get()},ye.prototype.setAsString=function(t,e){this.value.setAsString(t,e),e||this.outs[0].set(this.value.get())},ye.prototype.getAsString=function(){return this.value.getAsString()},ye.prototype.save=function(){var t=B.prototype.save.call(this);return this.value.save(t),t},ye.prototype.load=function(t){this.value.load(t),B.prototype.load.call(this,t)},ye.prototype.properties=function(t){var e=this,i=new C(this,t);this.value.dialogOptions(i,!0,(function(){e.compute(null)})),i.open()};var ge=function(){B.call(this),this.height=50,this.width=80,this.size=4,this.addOut(this.width/2,0,16).bus=!0,this.ensureIO()};(ge.prototype=Object.create(B.prototype)).constructor=ge,ge.type="BusOr",ge.label="Bus OR",ge.desc="Bus OR gate",ge.img="busor.png",ge.description="<h2>Bus OR Gate</h2><p>The output of an OR gate is <em>true</em> \nif either or both  inputs are true. Otherwise, it is false. This version works for \nbuses. The size determines the number of inputs.</p>",ge.order=308,ge.prototype.compute=function(t){var e=[];t.forEach((function(t){if(Array.isArray(t))for(var i=0;i<t.length;i++){var n=t[i];e.length>i?!0===n&&(e[i]=!0):e.push(n)}})),this.outs[0].set(e)},ge.prototype.clone=function(){var t=new ge;return t.size=this.size,t.ensureIO(),t.copyFrom(this),t},ge.prototype.load=function(t){this.size=t.size,this.ensureIO(),B.prototype.load.call(this,t)},ge.prototype.save=function(){var t=B.prototype.save.call(this);return t.size=this.size,t},ge.prototype.ensureIO=function(){this.height=16*this.size+8,this.height<50&&(this.height=50);for(var t=this.size/2*16-8,e=0;e<this.size;e++){var i=30*this.size,n=Math.atan2(this.height/2,i),o=i/Math.cos(n),r=t-16*e,s=Math.sqrt(o*o-r*r)-i;e<this.ins.length?(this.ins[e].x=-this.width/2+s,this.ins[e].y=r,this.ins[e].len=16+s,this.ins[e].bus=!0):this.addIn(-this.width/2+s,t-16*e,16+s).bus=!0}for(;e<this.size;e++);if(e<this.ins.length){for(;e<this.ins.length;e++)this.ins[e].clear();this.ins.splice(this.size)}},ge.prototype.draw=function(t,e){this.selectStyle(t,e);var i=this.height,n=this.width,o=this.x-n/2-.5,r=(this.x,this.y-i/2-.5),s=this.y+i/2+.5;t.beginPath();var a=30*this.size,l=Math.atan2(i/2,a),c=a/Math.cos(l);t.arc(o-a,this.y,c,-l,l);var h=(n/2*(n/2)-i/2*(i/2))/i;c=i/2+h,l=Math.atan2(h,n/2),t.moveTo(o,r),t.lineTo(this.x-this.width/4,r),t.bezierCurveTo(this.x+this.width/4,r,this.x+3*this.width/8,this.y-this.height/4,this.x+this.width/2,this.y),t.moveTo(o,s),t.lineTo(this.x-this.width/4,s),t.bezierCurveTo(this.x+this.width/4,s,this.x+3*this.width/8,this.y+this.height/4,this.x+this.width/2,this.y),t.stroke(),this.drawName(t,-2,5),this.drawIO(t,e)},ge.prototype.properties=function(t){var e=this,i=new C(this,t),n=i.uniqueId(),o='<div class="control1 center"><label for="'.concat(n,'">Size: </label>\n<input class="number" type="text" name="').concat(n,'" id="').concat(n,'" value="').concat(this.size,'"></div>');i.extra(o,(function(){var t=parseInt(document.getElementById(n).value);return isNaN(t)||t<2||t>16?"Size must be an integer from 2 to 16":null}),(function(){e.size=parseInt(document.getElementById(n).value),e.ensureIO()})),i.open()};var be=function(){B.call(this),this.height=100,this.width=52,this.value=null;var t=!0;Object.defineProperty(this,"bus",{get:function(){return t},set:function(e){if(t!==e){if(this.ins[0].bus!==e){for(var i=0;i<this.ins.length;i++)this.ins[i].clear();this.ins=[]}t=e,this.ensureIO()}}}),this.setSize(3),this.circuitOuts=[],this.ensureIO()};(be.prototype=Object.create(B.prototype)).constructor=be,be.prototype.prefix="U",be.type="BusDecoder",be.label="Decoder",be.desc="Configurable Decoder",be.description="<h2>Decoder</h2>\n<p>The Decoder component converts a 2 to 4-bit binary value on <strong>In</strong> \nto a true on one of four to sixteen output lines. The number of outputs is determined \nby the bit size and is configurable.</p>",be.order=400,be.help="busdecoder",be.prototype.setSize=function(t){this.size=t,this.outputs=1;for(var e=0;e<t;e++)this.outputs*=2;this.ensureIO()},be.prototype.compute=function(t){if(this.bus)if(Array.isArray(t[0])){for(var e=0,i=1,n=0;n<t[0].length;n++)e+=t[0][n]?i:0,i*=2;this.set(e)}else this.set(null);else{for(var o=0,r=1,s=!1,a=0;a<t.length;a++){if(void 0===t[a]){s=!0;break}o+=t[a]?r:0,r*=2}this.set(s?null:o)}},be.prototype.set=function(t){if(null!=t){t&=this.outputs-1;for(var e=0;e<this.outputs;e++)this.outs[e].set(e==t)}else for(var i=0;i<this.outputs;i++)this.outs[i].set(void 0);this.value=t},be.prototype.clone=function(){var t=new be;return t.bus=this.bus,t.setSize(this.size),t.copyFrom(this),t},be.prototype.ensureIO=function(){var t,e=16,i=!1;if(this.height=this.outputs*e+26,this.height<80&&(this.height=80),this.ins.length>0&&this.ins[0].bus!==this.bus){for(t=0;t<this.ins.length;t++)this.ins[t].clear();this.ins=[]}if(this.bus)this.ins.length<1&&(this.addIn(-this.width/2,0,14,"In").bus=!0,i=!0);else{var n=this.size/2*e-8;for(t=0;t<this.size;t++){var o=n-t*e,r=null;t<this.ins.length?((r=this.ins[t]).x=-this.width/2,r.y=o,r.len=14):(i=!0,(r=this.addIn(-this.width/2,o,14,"I"+t)).orientation="w")}if(t<this.ins.length){for(;t<this.ins.length;t++)this.ins[t].clear();this.ins.splice(this.size)}}var s=this.width/2,a=this.outputs/2*e-8;for(t=0;t<this.outputs&&!(t>=this.outs.length);t++)this.outs[t].name="O"+t,this.outs[t].x=s,this.outs[t].y=a-t*e,this.outs[t].len=14;for(;t<this.outputs;t++)this.addOut(s,a-t*e,14,"O"+t),i=!0;if(t<this.outs.length){for(;t<this.outs.length;t++)this.outs[t].clear();this.outs.splice(this.outputs)}i&&this.set(this.value)},be.prototype.draw=function(t,e){this.selectStyle(t,e);var i=this.x-this.width/2-.5,n=this.x+this.width/2+.5;this.y,this.height,this.y,this.height;if(this.drawBox(t),t.font="12px Times",t.textAlign="center",t.fillText("decoder",this.x,this.y+this.height/2-2),null!==this.value&&this.value>=0&&this.value<this.outputs){var o=this.outs[this.value].y,r=this.value>=10?26:19;this.jaggedLine(t,i+15,this.y,n-r,this.y+o,.5)}this.drawName(t,0,-this.height/2+12),this.drawIO(t,e)},be.prototype.load=function(t){this.bus=!1!==t.bus,this.setSize(t.size),B.prototype.load.call(this,t)},be.prototype.save=function(){var t=B.prototype.save.call(this);return t.size=this.size,t.bus=this.bus,t},be.prototype.properties=function(t){var e=this,i=new C(this,t),n=i.uniqueId(),o='<div class="control1 center"><label for="'.concat(n,'">Size (bits): </label>\n<input class="number" type="text" name="').concat(n,'" id="').concat(n,'" value="').concat(this.size,'"></div>');o+='<div class="control center"><div class="choosers">';var r=i.uniqueId();o+='\n<label><input type="radio" name="'.concat(r,'"  ').concat(this.bus?"checked":"",' value="1"> Bus Input</label>\n<label><input type="radio" name="').concat(r,'" ').concat(this.bus?"":"checked",' value="0"> Single Bit Inputs</label>'),o+="</div></div>",i.extra(o,(function(){var t=parseInt(document.getElementById(n).value);return isNaN(t)||t<2||t>4?"Size must be an integer from 2 to 4":null}),(function(){e.setSize(document.getElementById(n).value),e.bus="1"===document.querySelector("input[name=".concat(r,"]:checked")).value})),i.open()},be.paletteImage=function(){var t=new J(60,44);return t.box(20,42),t.io(10,-17.5,"e",8,5),t.io(-10,0,"w"),t.drawText("Decoder",0,20,"4px Times"),t};var we=function(){B.call(this),this.height=16,this.width=96,this.from=0,this.to=1,this.addIn(-48,0,16).bus=!0,this.addOut(48,0,16).bus=!0};(we.prototype=Object.create(B.prototype)).constructor=we,we.prototype.prefix=null,we.type="BusSelector",we.label="Bus Selector",we.desc="Bus Subset Selector",we.img="busselector.png",we.description="<h2>Bus Selector</h2><p>A Bus Selector chooses some \nrange of bits from an input bus and feeds them to an output bus. This is a  tool \nto use to select fields from a bus.</p>\n<p>If configured as 4 to 8 (8:4 on the symbol), bits 4-8 becomes bits 0-4 on\nthe output bus. The output is a bus if more than one bit is selected and is a bit \nif only one bit is selected.</p>",we.order=310,we.help="busselector",we.prototype.clone=function(){var t=new we;return t.copyFrom(this),t.from=this.from,t.to=this.to,t},we.prototype.compute=function(t){if(void 0!==t[0])if(this.from==this.to)this.outs[0].set(t[0][this.from]);else{for(var e=[],i=this.from;i<=this.to;i++)e.push(t[0][i]);this.outs[0].set(e)}else this.outs[0].set(void 0)},we.prototype.draw=function(t,e){this.outlinePath(t),t.fillStyle="#dddddd",t.fill(),this.selectStyle(t,e),this.outlinePath(t),t.stroke(),t.font="14px Times",t.textAlign="center",t.fillText(this.to+":"+this.from,this.x,this.y+5),this.drawIO(t,e)},we.prototype.outlinePath=function(t){var e=this.x-this.width/2-.5,i=this.x+this.width/2+.5,n=this.y-this.height/2-.5,o=this.y+this.height/2+.5;t.beginPath(),t.moveTo(e+this.height/2,n),t.lineTo(e,this.y),t.lineTo(e+this.height/2,o),t.lineTo(i-this.height/2,o),t.lineTo(i,this.y),t.lineTo(i-this.height/2,n),t.lineTo(e+this.height/2,n)},we.prototype.save=function(){var t=B.prototype.save.call(this);return t.from=this.from,t.to=this.to,t},we.prototype.load=function(t){this.from=t.from,this.to=t.to,B.prototype.load.call(this,t),this.ensureIO()},we.prototype.ensureIO=function(){this.outs[0].bus=this.from!=this.to},we.prototype.properties=function(t){var e=this,i=new C(this,t),n=i.uniqueId(),o=i.uniqueId(),r='<div class="control1 center gap">\n<input class="number" type="text" name="'.concat(n,'" id="').concat(n,'" value="').concat(this.from,'" spellcheck="false" onfocus="this.select()"> \n<label for="').concat(o,'">to </label>\n<input class="number" type="text" name="').concat(o,'" id="').concat(o,'" value="').concat(this.to,'" spellcheck="false" onfocus="this.select()"></div>');i.extra(r,(function(){var t=document.getElementById(n).value,e=document.getElementById(o).value,i=parseInt(t),r=parseInt(e);return isNaN(i)||i<0||i>32?(document.getElementById(n).select(),"Invalid from value"):isNaN(r)||r<0||r>32?(document.getElementById(o).select(),"Invalid to value"):i>r?(document.getElementById(n).select(),"Invalid values, <em>from</em> must be less than or equal to <em>to</em>."):null}),(function(){var t=document.getElementById(n).value,i=document.getElementById(o).value;e.from=parseInt(t),e.to=parseInt(i),e.ensureIO(),e.pending()})),i.open()};var xe=function(){B.call(this),this.height=80,this.width=32,this.size=2,this.lastIn=null,this.bus=!0,this.circuitIns=[],this.addOut(this.width/2,0,8,"O").bus=!0,this.addIn(0,-this.height/2+10,13,"").orientation="n",this.ensureIO()};(xe.prototype=Object.create(B.prototype)).constructor=xe,xe.prototype.prefix=null,xe.prototype.indent=10,xe.type="Multiplexer",xe.label="Multiplexer",xe.desc="Multiplexer",xe.img="multiplexer.png",xe.description="<h2>Multiplexer</h2><p>Multiplexes 2 to 16 inputs to a single output. The \ninputs and outputs and can be configured as buses or single bits.</p>\n<p>The value of the input pin or bus determines which input is routed to O. The input will be a single\nbit if there are two choices (binary) or a bus if there are more than 2 choices. </p>",xe.order=402,xe.help="multiplexer",xe.prototype.compute=function(t){var e=t[0];if(void 0===e)return this.outs[0].set(void 0),void(this.lastIn=null);if(Array.isArray(e)){var i=0,n=1;e.forEach((function(t){t&&(i+=n),n*=2})),e=i}else e=e?1:0;e<=t.length?(this.outs[0].set(t[e+1]),this.lastIn=e):(this.outs[0].set(void 0),this.lastIn=null)},xe.prototype.clone=function(){var t=new xe;return t.size=this.size,t.bus=this.bus,t.ensureIO(),t.copyFrom(this),t},xe.prototype.load=function(t){this.size=t.size,this.bus=!1!==t.bus,this.ensureIO(),B.prototype.load.call(this,t)},xe.prototype.save=function(){var t=B.prototype.save.call(this);return t.size=this.size,t.bus=this.bus,t},xe.prototype.ensureIO=function(){if(this.bus!==this.outs[0].bus){for(this.outs[0].clear(),this.outs[0].bus=this.bus,n=1;n<this.ins.length;n++)this.ins[n].clear();this.ins.splice(1,this.ins.length-1)}this.height=16*this.size+16,this.height<48&&(this.height=48);var t=this.width/2,e=this.ins[0];e.x=0,e.y=-this.height/2+this.indent/2,e.bus=this.size>2;for(var i=this.size/2*16-8,n=0;n<this.size&&!(n>=this.ins.length-1);n++){var o=this.ins[n+1];o.name="I"+n,o.x=-t,o.y=i-16*n,o.len=8}for(;n<this.size;n++)this.addIn(-t,i-16*n,8,"I"+n).bus=this.bus;if(++n<this.ins.length){for(;n<this.ins.length;n++)this.ins[n].clear();this.ins.splice(this.size+1)}},xe.prototype.draw=function(t,e){if(this.selectStyle(t,e),this.drawTrap(t,0,this.indent),null!==this.lastIn){var i=this.x-4,n=this.x+4,o=this.y-1,r=this.y+this.size/2*16-10-16*this.lastIn;this.jaggedLine(t,i,r,n,o,.5)}this.drawIO(t,e)},xe.prototype.properties=function(t){var e=this,i=new C(this,t),n=i.uniqueId(),o='<div class="control1 center gap"><label for="'.concat(n,'">Number of inputs: </label>\n<input class="number" type="text" name="').concat(n,'" id="').concat(n,'" value="').concat(this.size,'"></div>');o+='<div class="control center"><div class="choosers">';var r=i.uniqueId();o+='\n<label><input type="radio" name="'.concat(r,'"  ').concat(this.bus?"checked":"",' value="1"> Bus</label>\n<label><input type="radio" name="').concat(r,'" ').concat(this.bus?"":"checked",' value="0"> Single Bit</label>'),o+="</div></div>",i.extra(o,(function(){var t=parseInt(document.getElementById(n).value);return isNaN(t)||t<2||t>16?(document.getElementById(n).select(),"Must be an integer from 2 to 16"):null}),(function(){e.size=parseInt(document.getElementById(n).value),e.bus="1"===document.querySelector("input[name=".concat(r,"]:checked")).value,e.ensureIO()})),i.open()};var Te=function(){};Te.draw=function(t,e,i,n,o){var r=t.fillStyle,s=t.strokeStyle;t.fillStyle="#dddddd",t.beginPath(),t.arc(e,i,n,0,2*Math.PI),t.fill(),t.strokeStyle="#000000",t.lineWidth=.5,t.beginPath(),t.arc(e,i,n,0,2*Math.PI);var a=Math.cos(o)*n,l=Math.sin(o)*n;t.moveTo(e-a,i-l),t.lineTo(e+a,i+l),t.stroke(),t.strokeStyle=s,t.fillStyle=r,t.lineWidth=1};var Ie=function(){B.call(this),this.height=50,this.width=50,this.buttonSize=40,this.value=!1,this.color="blue",this.addOut(this.width/2,0,48-this.width/2),this.set(!1)};(Ie.prototype=Object.create(B.prototype)).constructor=Ie,Ie.prototype.prefix="B",Ie.type="Button",Ie.label="Button",Ie.desc="Push Button",Ie.img="button.png",Ie.order=100,Ie.description="<h2>Push Button</h2><p>Clicking the button turns on the output (true), while releasing turns it off.</p>",Ie.prototype.clone=function(){var t=new Ie;return t.value=this.value,t.color=this.color,t.copyFrom(this),t},Ie.prototype.compute=function(t){this.outs[0].set(this.value)},Ie.prototype.load=function(t){this.color=void 0!==t.color?t.color:"blue",B.prototype.load.call(this,t)},Ie.prototype.save=function(){var t=B.prototype.save.call(this);return t.color=this.color,t},Ie.prototype.draw=function(t,e){this.selectStyle(t,e);var i=this.x-this.width/2-.5,n=this.y-this.height/2+.5,o=t.fillStyle,r=t.strokeStyle;switch(t.fillStyle="#cccccc",t.fillRect(i,n,this.width,this.height),t.fillStyle=o,t.beginPath(),t.rect(i,n,this.width,this.height),t.stroke(),this.color){case"blue":default:var s=["#25ffff","#15ddff","#00d5d4"];break;case"green":s=["#25ff25","#15ff00","#00d500"]}if(this.value){var a=t.createRadialGradient(this.x,this.y,1,this.x,this.y,16);a.addColorStop(0,s[0]),a.addColorStop(.5,s[1]),a.addColorStop(1,s[2]),t.fillStyle=a}else t.fillStyle="#888888";t.beginPath(),t.arc(this.x,this.y,16,0,2*Math.PI),t.fill(),t.strokeStyle="#000000",t.beginPath(),t.arc(this.x,this.y,17,0,2*Math.PI),t.lineWidth=4,t.stroke(),t.lineWidth=1,t.fillStyle=o,t.strokeStyle=r;var l=18;Te.draw(t,this.x-l,this.y-l,3,.3),Te.draw(t,this.x-l,this.y+l,3,1.3),Te.draw(t,this.x+l,this.y-l,3,2.3),Te.draw(t,this.x+l,this.y+l,3,.7),this.drawIO(t,e)},Ie.prototype.touch=function(t,e){return s.distance(new s(t,e),new s(this.x,this.y))<16?(this.set(!0),null):B.prototype.touch.call(this,t,e)},Ie.prototype.mouseUp=function(){this.set(!1)},Ie.prototype.set=function(t){this.value=t,this.outs[0].set(t)},Ie.prototype.setAsString=function(t){var e=1==+t;this.set(e)},Ie.prototype.get=function(){return this.value},Ie.prototype.properties=function(t){var e=this,i=this,n=new C(this,t,!1),o=n.uniqueId(),r='<div class="control1 center"><label for="'+o+'">Color: </label><select id="'+o+'">';["green","blue"].forEach((function(t){t===i.color?r+="<option selected>"+t+"</option>":r+="<option>"+t+"</option>"})),r+="</select></div>",n.extra(r,(function(){return null}),(function(){e.color=document.getElementById(o).value})),n.open()};var Se=function(){B.call(this),this.size=22,this.text="Text",this.color="black",this.height=this.size,this.width=2*this.size};(Se.prototype=Object.create(B.prototype)).constructor=Se,Se.prototype.prefix=null,Se.type="Text",Se.label="Text",Se.desc="Arbitrary Text",Se.img="text.png",Se.order=106,Se.description="<h2>Text</h2><p>Arbitrary text for diagrams. Allows for notations that help\ndescribe parts of diagrams. The text size in pixels can be specified, as can the colors from a \nlimited palette.</p><p>The color selection is overridden by the selection color (red) when the \ntext component is selected.</p>",Se.help="text",Se.prototype.clone=function(){var t=new Se;return t.copyFrom(this),t.text=this.text,t.size=this.size,t},Se.prototype.draw=function(t,e){var i=this.selectStyle(t,e),n=this.text.replace(/&lt;/g,"<");if(n=(n=n.replace(/&gt;/g,">")).replace(/&amp;/g,"&"),t.font=this.size+"px Times",t.textAlign="center",i)t.fillText(n,this.x-1,this.y+5);else{var o;switch(this.color){default:o=this.color;break;case"green":o="#008000";break;case"pink":o="#FF69B4"}Q.fillTextWith(t,n,this.x-1,this.y+5,o)}this.height=this.size,this.width=t.measureText(n).width,this.drawIO(t,e)},Se.prototype.properties=function(t){var e=this,i=new C(this,t),n=i.uniqueId(),o=i.uniqueId(),r=i.uniqueId(),s='<div class="control">\n<label for="'.concat(n,'">Text: </label>\n<input type="text" id="').concat(n,'" value="').concat(this.text,'">\n</div>\n<div class="control1 center"><label for="').concat(o,'">Size: </label>\n<input class="number" type="text" id="').concat(o,'" value="').concat(this.size,'"></div>');s+='<div class="control1 center"><label for="'+r+'">Color: </label><select id="'+r+'">';var a=["black","green","blue","purple","orange","maroon","pink"];for(var l in a){var c=a[l];c===this.color?s+="<option selected>"+c+"</option>":s+="<option>"+c+"</option>"}s+="</select></div>",i.extra(s,(function(){var t=parseInt(document.getElementById(o).value);return isNaN(t)||t<10||t>55?"Size must be an integer between 10 and 55":ot.htmlentities(document.getElementById(n).value).length<1?"Text cannot be empty":null}),(function(){e.text=ot.htmlentities(document.getElementById(n).value),e.size=parseInt(document.getElementById(o).value),e.color=ot.sanitize(document.getElementById(r).value)})),i.open(),document.getElementById(n).select()},Se.prototype.save=function(){var t=B.prototype.save.call(this);return t.text=this.text.replace(/'/g,"`"),t.size=this.size,"black"!==this.color&&(t.color=this.color),t},Se.prototype.load=function(t){this.text=ot.sanitize(t.text.replace(/`/g,"'")),this.size=+t.size,void 0!==t.color&&(this.color=ot.sanitize(t.color)),B.prototype.load.call(this,t)};var ke=function(){B.call(this),this.height=176,this.width=128;var t=this.width/2,e=this.height/2;this.values=[0,0,0,0,0,0,0,0],this.lastClk=!1,this.lastA=null,this.lastB=null,this.lastALU=null,this.lastW=null,this.alu=0;var i=this.addIn(0,-e,8);i.orientation="n",i.clock=!0,this.addIn(-t,-48,16,"ALU").bus=!0,this.addIn(-t,16,16,"Ae").bus=!0,this.addIn(-t,48,16,"Be").bus=!0,this.addIn(-t,-32,16,"ALUe").bus=!0,this.addIn(0,this.height/2,8,"R").orientation="s",this.addIn(-t,-16,16,"W"),this.addOut(t,-48,16,"A").bus=!0,this.addOut(t,48,16,"B").bus=!0,this.outs[0].set(void 0),this.outs[1].set(void 0)};(ke.prototype=Object.create(B.prototype)).constructor=ke,ke.prototype.prefix="R",ke.type="Registers16",ke.label="Registers",ke.desc="Register File",ke.img="registers16.png",ke.description="<h2>Registers</h2>\n<p>Simple 16-bit register file. Ae and Be choose which register is routed to \nthe A and B outputs. ALU is the input from the ALU. ALUe chooses which register to write. \nA register will only be written if W (write enable) is high.</p><p>R is a reset input and is optional. \nThe R input (reset) sets all registers to zero.</p>\n<p>The register file sets the \nregister on the clock <em>leading edge.</em></p>",ke.order=700,ke.help="registers16",ke.prototype.compute=function(t){if(this.lastA=l.busValueToDecimal(t[2],8),this.lastB=l.busValueToDecimal(t[3],8),this.lastALU=l.busValueToDecimal(t[4],8),this.lastW=t[6],t[0]&&!this.lastClk&&(this.alu=l.busValueToDecimal(t[1]),null!==this.lastALU&&this.lastW&&(this.values[this.lastALU]=this.alu)),t[5]&&(this.values=[0,0,0,0,0,0,0,0]),null!==this.lastA){for(var e=this.values[this.lastA],i=[],n=0;n<16;n++)i.push(1==(1&e)),e>>=1;this.outs[0].set(i)}else this.outs[0].set(void 0);if(null!==this.lastB){for(var o=this.values[this.lastB],r=[],s=0;s<16;s++)r.push(1==(1&o)),o>>=1;this.outs[1].set(r)}else this.outs[1].set(void 0);this.lastClk=t[0]},ke.prototype.clone=function(){var t=new ke;return t.copyFrom(this),t.values=this.values.slice(),t},ke.prototype.draw=function(t,e){this.selectStyle(t,e),this.drawBox(t),t.font='10px "Lucida Console", Monaco, monospace',t.textAlign="left";for(var i=this.y-54,n=this.x-11,o=n+45,s=i,a=0;a<8;a++)t.fillText("r"+a+":"+r.toHex(this.values[a],4),this.x-10,s),s+=16;var l=i-4;null!==this.lastALU&&this.lastW&&this.jaggedLine(t,this.x-this.width/2+34,this.y-48,n,l+16*this.lastALU,.5),null!==this.lastA&&this.jaggedLine(t,o,l+16*this.lastA,this.x+this.width/2-14,this.y-48,.66),null!==this.lastB&&this.jaggedLine(t,o,l+16*this.lastB,this.x+this.width/2-14,this.y+48,.33),t.font="12px Times",t.textAlign="center",this.drawIO(t,e)},ke.prototype.testAsString=function(t,e){if(null!==t)if("reset"===t)this.values=[0,0,0,0,0,0,0,0],this.pending();else if("r"===t.substr(0,1)){var i=parseInt(t.substr(1,1));if(i<0||i>7)throw"Invalid register indicated in test "+t;var n=parseInt(t.substr(3));if(n!==+this.values[i])throw"Incorrect register values. Register r"+i+" expected=0x"+r.toHex(n,4)+" actual=0x"+r.toHex(this.values[i],4)}},ke.prototype.setAsString=function(t){this.testAsString(t)};var Ae=function(){B.call(this),this.height=96,this.width=32,this.valueR=void 0,this.valueY=void 0,this.valueG=void 0,this.red=new le(0,-32,12),this.yellow=new le(0,0,12),this.green=new le(0,32,12),this.addIn(-16,-32,16),this.addIn(-16,0,16),this.addIn(-16,32,16)};(Ae.prototype=Object.create(B.prototype)).constructor=Ae,Ae.prototype.prefix="L",Ae.prototype.nameRequired=!0,Ae.type="TrafficLight",Ae.label="Traffic Light",Ae.desc="Traffic Light",Ae.img="trafficlight.png",Ae.description="<h2>Traffic Light</h2><p>The Traffic Light component has indicators \nfor Red, Yellow, and Green as in a conventional traffic light.</p>",Ae.order=504,Ae.help="trafficlight",Ae.prototype.compute=function(t){this.valueR=t[0],this.valueY=t[1],this.valueG=t[2]},Ae.prototype.clone=function(){var t=new Ae;return t.copyFrom(this),t},Ae.prototype.testAsString=function(t,e){if(null!==t){var i=t.split("=");if("?"!==i[1]){if(i.length<2)throw"Invalid traffic light test validation string "+t;var n;switch(i[0]){case"red":n=this.valueR;break;case"grn":case"green":n=this.valueG;break;case"yel":case"yellow":n=this.valueY;break;default:throw"Invalid traffic light test validation string "+t}if(void 0===n||"1"===i[1]&&!n||"0"===i[1]&&n){var o=void 0===n?"?":n?"1":"0";throw"Incorrect traffic light value. Expected "+t+" but got "+i[0]+"="+o}}}},Ae.prototype.draw=function(t,e){this.selectStyle(t,e);var i="#feb51a";this.drawBox(t,i),this.red.color=void 0===this.valueR?"undefined":this.valueR?"red":"off",this.red.draw(t,this.x-.5,this.y,i),this.yellow.color=void 0===this.valueY?"undefined":this.valueY?"yellow":"off",this.yellow.draw(t,this.x-.5,this.y,i),this.green.color=void 0===this.valueG?"undefined":this.valueG?"green":"off",this.green.draw(t,this.x-.5,this.y,i),this.drawIO(t,e)};var Oe=function(){B.call(this),this.height=134,this.width=64;this.width,this.height;var t=-56,e=16;this.addIn(-this.width/2,t,e,"I3"),t+=16,this.addIn(-this.width/2,t,e,"I2"),t+=16,this.addIn(-this.width/2,t,e,"I1"),t+=16,this.addIn(-this.width/2,t,e,"I0"),t+=32,this.addIn(-this.width/2,t,e,"I").bus=!0,t=-56,e=16,this.addOut(this.width/2,t,e,"a"),t+=16,this.addOut(this.width/2,t,e,"b"),t+=16,this.addOut(this.width/2,t,e,"c"),t+=16,this.addOut(this.width/2,t,e,"d"),t+=16,this.addOut(this.width/2,t,e,"e"),t+=16,this.addOut(this.width/2,t,e,"f"),t+=16,this.addOut(this.width/2,t,e,"g"),t+=16};(Oe.prototype=Object.create(B.prototype)).constructor=Oe,Oe.prototype.prefix="D",Oe.type="HexToSevenSegment",Oe.label="Hex to Seven Segment",Oe.desc="Hexadecimal to Seven Segment Decoder",Oe.img=null,Oe.description="<h2>Hex to Seven Segement</h2><p>Decodes hexadecimal into the correct outputs for a seven-segment display. Accepts either single bit lines or bus input.</p>",Oe.order=506,Oe.prototype.compute=function(t){var e=t[0],i=t[1],n=t[2],o=t[3];if((void 0===e||void 0===i||void 0===n||void 0===o)&&void 0!==t[4]){var r=t[4];e=r[3],i=r[2],n=r[1],o=r[0]}if(void 0!==e&&void 0!==i&&void 0!==n&&void 0!==o){var s=[[!0,!0,!0,!0,!0,!0,!1],[!1,!0,!0,!1,!1,!1,!1],[!0,!0,!1,!0,!0,!1,!0],[!0,!0,!0,!0,!1,!1,!0],[!1,!0,!0,!1,!1,!0,!0],[!0,!1,!0,!0,!1,!0,!0],[!0,!1,!0,!0,!0,!0,!0],[!0,!0,!0,!1,!1,!1,!1],[!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!1,!0,!0],[!0,!0,!0,!1,!0,!0,!0],[!1,!1,!0,!0,!0,!0,!0],[!0,!1,!1,!0,!0,!0,!1],[!1,!0,!0,!0,!0,!1,!0],[!0,!1,!1,!0,!0,!0,!0],[!0,!1,!1,!1,!0,!0,!0]][(e?8:0)+(i?4:0)+(n?2:0)+(o?1:0)];for(e=0;e<7;e++)this.outs[e].set(s[e])}else for(e=0;e<7;e++)this.outs[e].set(void 0)},Oe.prototype.clone=function(){var t=new Oe;return t.copyFrom(this),t},Oe.prototype.draw=function(t,e){this.selectStyle(t,e),this.drawBox(t),this.drawName(t,0,3),this.drawText(t,"Hex-to-7",0,this.height/2-5),this.drawIO(t,e)},Oe.paletteImage=function(){var t=new J(60,44);t.box(20,40),t.io(-10,-15.5,"w",4,5),t.io(10,-15.5,"e",7,5);var e=t.context.lineWidth;return t.context.lineWidth=2,t.io(-10,15.5,"w"),t.context.lineWidth=e,t.drawText("Hex-to-7",0,18,"4px Times"),t};var Ce=function(){B.call(this),this.height=150,this.width=90,this.value=[void 0,void 0,void 0,void 0,void 0,void 0,void 0],this.color="green";var t=-64,e=11;this.addIn(-this.width/2,t,e,"a"),t+=16,this.addIn(-this.width/2,t,e,"b"),t+=16,this.addIn(-this.width/2,t,e,"c"),t+=16,this.addIn(-this.width/2,t,e,"d"),t+=16,this.addIn(-this.width/2,t,e,"e"),t+=16,this.addIn(-this.width/2,t,e,"f"),t+=16,this.addIn(-this.width/2,t,e,"g"),t+=16,t+=16,this.addIn(-this.width/2,t,e,"en")};(Ce.prototype=Object.create(B.prototype)).constructor=Ce,Ce.prototype.prefix="L",Ce.prototype.nameRequired=!0,Ce.type="7seg",Ce.label="7 SEG",Ce.desc="7 Segment Display",Ce.img="7seg.png",Ce.order=508,Ce.description="<h2>7 Seg</h2><p>A 7 segment display has seven different display positions that can be set independently to make numbers and other characters. The en (enable) pin enables the display if true or if not connected.</p>",Ce.prototype.compute=function(t){if(!1===t[7])for(var e=0;e<7;e++)this.value[e]=!1;else for(e=0;e<7;e++)this.value[e]=t[e]},Ce.prototype.get=function(t){return this.ins[0].value[t]},Ce.prototype.clone=function(){var t=new Ce;return t.color=this.color,t.value=this.value.slice(),t.copyFrom(this),t},Ce.prototype.draw=function(t,e){var i=this.x-this.width/2-.5,n=this.x+this.width/2+.5,o=this.y-this.height/2-.5,r=this.y+this.height/2+.5;this.selectStyle(t,e);var s=t.fillStyle,a=t.strokeStyle;t.fillStyle="#cccccc",t.fillRect(i,o,this.width,this.height),t.fillStyle=s,t.beginPath(),t.rect(i,o,this.width,this.height),t.stroke();var l=.2*this.width,c=.02*this.width;i+=l+5,n-=l,o+=l,r-=l,t.font="11px Times",t.textAlign="center",this.drawSegment(t,this.value[0],{x:i+c,y:o},{x:n-c,y:o},"a"),this.drawSegment(t,this.value[1],{x:n,y:o+c},{x:n,y:this.y-c},"b"),this.drawSegment(t,this.value[2],{x:n,y:this.y+c},{x:n,y:r-c},"c"),this.drawSegment(t,this.value[3],{x:n-c,y:r},{x:i+c,y:r},"d"),this.drawSegment(t,this.value[4],{x:i,y:r-c},{x:i,y:this.y+c},"e"),this.drawSegment(t,this.value[5],{x:i,y:this.y-c},{x:i,y:o+c},"f"),this.drawSegment(t,this.value[6],{x:i+c,y:this.y},{x:n-c,y:this.y},"g"),t.lineWidth=1,t.fillStyle=s,t.strokeStyle=a,this.drawIO(t,e)},Ce.prototype.drawSegment=function(t,e,i,n,o){var r=new s(n.x-i.x,n.y-i.y),a=s.normalize(r);a=s.rotate(a,Math.PI/4);var l=s.rotate(a,Math.PI/2),c=10*.707;if(e)switch(this.color){case"red":t.fillStyle="#fe0501";break;case"blue":t.fillStyle="#15ddff";break;default:t.fillStyle="#00fb4a"}else t.fillStyle="#444444";t.strokeStyle="#222222",t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(i.x+c*a.x,i.y+c*a.y),t.lineTo(n.x+c*l.x,n.y+c*l.y),t.lineTo(n.x,n.y),t.lineTo(n.x-c*a.x,n.y-c*a.y),t.lineTo(i.x-c*l.x,i.y-c*l.y),t.lineTo(i.x,i.y),t.fill(),t.stroke();var h=new s((n.x+i.x)/2,(n.y+i.y)/2),u=s.rotate(s.normalize(r),Math.PI/2);t.fillStyle="#000000",t.fillText(o,h.x+10*u.x,h.y+10*u.y+2),void 0===e&&(t.fillStyle="#00ffff",t.fontWeight="bolder",t.fillText("?",h.x,h.y+3),t.fontWeight="normal")},Ce.prototype.load=function(t){this.color=t.color,B.prototype.load.call(this,t)},Ce.prototype.save=function(){var t=B.prototype.save.call(this);return t.color=this.color,t},Ce.prototype.properties=function(t){var e=this,i=new C(this,t,!1),n=i.uniqueId(),o='<div class="control1 center"><label for="'+n+'">Color: </label><select id="'+n+'">';["red","green","blue"].forEach((function(t){t===e.color?o+="<option selected>"+t+"</option>":o+="<option>"+t+"</option>"})),o+="</select></div>",i.extra(o,(function(){return null}),(function(){e.color=document.getElementById(n).value})),i.open()};var Ee=function(){B.call(this),this.height=80,this.width=32,this.size=4,this.circuitOuts=[],this.addIn(-this.width/2,0,this.pinlength,"I").bus=!0,this.ensureIO()};(Ee.prototype=Object.create(B.prototype)).constructor=Ee,Ee.prototype.prefix=null,Ee.prototype.indent=10,Ee.prototype.pinlength=8,Ee.type="FmBus",Ee.label="Fm Bus",Ee.desc="Bus to Single bits",Ee.img="fmbus.png",Ee.order=305,Ee.description="<h2>From Bus</h2><p>Converts a bus input into single bit outputs. This allows for simpler circuits.</p>",Ee.prototype.compute=function(t){if(Array.isArray(t[0])){for(var e=0;e<this.size&&e<t[0].length;e++)this.outs[e].set(t[0][e]);for(;e<this.size;e++)this.outs[e].set(void 0)}else for(e=0;e<this.size;e++)this.outs[e].set(void 0)},Ee.prototype.clone=function(){var t=new Ee;return t.size=this.size,t.ensureIO(),t.copyFrom(this),t},Ee.prototype.load=function(t){this.size=t.size,this.ensureIO(),B.prototype.load.call(this,t)},Ee.prototype.save=function(){var t=B.prototype.save.call(this);return t.size=this.size,t},Ee.prototype.ensureIO=function(){this.height=16*this.size+16,this.height<48&&(this.height=48);for(var t=this.width/2,e=this.size/2*16-8,i=0;i<this.size&&!(i>=this.outs.length);i++)this.outs[i].name="O"+i,this.outs[i].x=t,this.outs[i].y=e-16*i,this.outs[i].len=this.pinlength;for(;i<this.size;i++)this.addOut(t,e-16*i,this.pinlength,"O"+i);if(i<this.outs.length){for(;i<this.outs.length;i++)this.outs[i].clear();this.outs.splice(this.size)}},Ee.prototype.draw=function(t,e){this.selectStyle(t,e),this.drawTrap(t,this.indent,0),this.drawIO(t,e)},Ee.prototype.properties=function(t){var e=this,i=new C(this,t),n=i.uniqueId(),o='<div class="control1 center gap"><label for="'+n+'">Size: </label><input class="number" type="text" id="'+n+'" value="'+this.size+'"></div>';i.extra(o,(function(){var t=parseInt(document.getElementById(n).value);return isNaN(t)||t<2||t>16?"Size must be an integer from 2 to 16":null}),(function(){e.size=parseInt(document.getElementById(n).value),e.ensureIO(),e.pending()})),i.open(),document.getElementById(n).select()};var ze=function(){B.call(this),this.height=80,this.width=32,this.size=4,this.circuitIns=[],this.addOut(this.width/2,0,this.pinlength,"O").bus=!0,this.ensureIO()};(ze.prototype=Object.create(B.prototype)).constructor=ze,ze.prototype.prefix=null,ze.prototype.indent=10,ze.prototype.pinlength=8,ze.type="ToBus",ze.label="To Bus",ze.desc="Single bits to a Bus",ze.img="tobus.png",ze.order=306,ze.description="<h2>To Bus</h2><p>Converts single bit inputs into a bus output to simplify circuits</p>",ze.prototype.compute=function(t){this.outs[0].set(t)},ze.prototype.clone=function(){var t=new ze;return t.size=this.size,t.ensureIO(),t.copyFrom(this),t},ze.prototype.load=function(t){this.size=t.size,this.ensureIO(),B.prototype.load.call(this,t)},ze.prototype.save=function(){var t=B.prototype.save.call(this);return t.size=this.size,t},ze.prototype.ensureIO=function(){this.height=16*this.size+12,this.height<48&&(this.height=48);for(var t=this.width/2,e=this.size/2*16-8,i=0;i<this.size&&!(i>=this.ins.length);i++)this.ins[i].name="I"+i,this.ins[i].x=-t,this.ins[i].y=e-16*i,this.ins[i].len=this.pinlength;for(;i<this.size;i++)this.addIn(-t,e-16*i,this.pinlength,"I"+i);if(i<this.ins.length){for(;i<this.ins.length;i++)this.ins[i].clear();this.ins.splice(this.size)}},ze.prototype.draw=function(t,e){this.selectStyle(t,e),this.drawTrap(t,0,this.indent),this.drawIO(t,e)},ze.prototype.properties=function(t){var e=this,i=new C(this,t),n=i.uniqueId(),o='<div class="control1 center gap"><label for="'+n+'">Size: </label><input class="number" type="text" id="'+n+'" value="'+this.size+'"></div>';i.extra(o,(function(){var t=parseInt(document.getElementById(n).value);return isNaN(t)||t<2||t>16?"Size must be an integer from 2 to 16":null}),(function(){e.size=parseInt(document.getElementById(n).value),e.ensureIO(),e.pending()})),i.open(),document.getElementById(n).select()};var Be=function(){B.call(this),this.height=90,this.width=64;var t=this.width/2,e=this.height/2;this.lastClk=!1,this.addIn(-t,0,16,"D");var i=this.addIn(0,-e,11);i.orientation="n",i.clock=!0,this.addOut(t,-32,16,"Q"),this.addOutInv(t,32,16,"Q",!0),this.outs[0].set(!1),this.outs[1].set(!1)};(Be.prototype=Object.create(B.prototype)).constructor=Be,Be.type="DFF",Be.label="D Flip-Flop",Be.desc="D Flip-Flop",Be.order=204,Be.description="<h2>D Flip-Flop</h2><p>D Flip-Flop.</p>",Be.prototype.compute=function(t){if(t[1]&&!this.lastClk){var e=t[0];this.outs[0].set(e),this.outs[1].set(e)}this.lastClk=t[1]},Be.prototype.clone=function(){var t=new Be;return t.copyFrom(this),t},Be.paletteImage=function(){var t=new J(120,120),e=t.context;e.lineWidth=1.5,t.box(40,80);var i=t.width,n=t.height;t.io(20,-18,"e"),t.io(20,18,"e"),t.io(-20,0,"w"),t.io(0,-40,"n"),t.circle(23,18,3);var o="20px Times";t.drawText("Q",10,-13,o),t.drawTextBar("Q",10,23,o),t.drawText("D",-12,5,o);return e.beginPath(),e.moveTo(i/2-7,n/2-40),e.lineTo(i/2,n/2-33),e.lineTo(7+i/2,n/2-40),e.stroke(),t};var Ne=function(){B.call(this),this.height=90,this.width=64;var t=this.width/2,e=this.height/2;this.lastClk=!1,this.addIn(-t,-32,16,"D"),this.addIn(-t,32,16).clock=!0,this.addIn(0,-e,11,"S").orientation="n",this.addIn(0,e,11,"R").orientation="s",this.addOut(t,-32,16,"Q"),this.addOutInv(t,32,16,"Q",!0),this.outs[0].set(void 0),this.outs[1].set(void 0)};(Ne.prototype=Object.create(B.prototype)).constructor=Ne,Ne.type="DFFsr",Ne.label="D Flip-Flop SR",Ne.desc="D Flip-Flop with Set/Reset",Ne.img="dffsr.png",Ne.order=206,Ne.description="<h2>D Flip-Flop with Set/Reset</h2><p>D Flip-Flop with Set and Reset. Set and Reset can be safely left unconnected.</p>",Ne.prototype.compute=function(t){var e=t[0],i=t[1],n=t[2],o=t[3],r=this.outs[0],s=this.outs[1];!0===n&&!0===o?(r.set(void 0),s.set(void 0)):!0===n?(r.set(!0),s.set(!0)):!0===o?(r.set(!1),s.set(!1)):i&&!this.lastClk&&(r.set(e),s.set(e)),this.lastClk=i},Ne.prototype.clone=function(){var t=new Ne;return t.copyFrom(this),t};var Pe=function(){B.call(this),this.height=90,this.width=64;var t=this.width/2,e=this.height/2;this.lastClk=!1,this.addIn(-t,-32,16,"J"),this.addIn(-t,32,16,"K"),this.addIn(-t,0,16).clock=!0,this.addIn(0,-e,11,"S").orientation="n",this.addIn(0,e,11,"R").orientation="s",this.addOut(t,-32,16,"Q"),this.addOutInv(t,32,16,"Q",!0),this.outs[0].set(void 0),this.outs[1].set(void 0)};(Pe.prototype=Object.create(B.prototype)).constructor=Pe,Pe.type="JKFF",Pe.label="JK Flip-Flop",Pe.desc="JK Flip-Flop",Pe.img="jk.png",Pe.order=208,Pe.description="<h2>JK Flip-Flop</h2><p>JK Flip-Flop.</p>",Pe.prototype.compute=function(t){var e=t[3],i=t[4],n=this.outs[0],o=this.outs[1];if(!0===e&&!0===i)n.set(void 0),o.set(void 0);else if(!0===e)n.set(!0),o.set(!0);else if(!0===i)n.set(!1),o.set(!1);else if(t[2]&&!this.lastClk){var r=t[0],s=t[1];if(r&&s){var a=!this.outs[0].get();n.set(a),o.set(a)}else r?(a=!0,n.set(a),o.set(a)):s&&(a=!1,n.set(a),o.set(a))}this.lastClk=t[2]},Pe.prototype.clone=function(){var t=new Pe;return t.copyFrom(this),t};var je=function(){B.call(this),this.height=90,this.width=64;var t=this.width/2,e=this.height/2;this.addIn(-t,0,16,"D"),this.addIn(0,-e,11,"CLK").orientation="n",this.addOut(t,-32,16,"Q"),this.addOutInv(t,32,16,"Q",!0),this.outs[0].set(!1),this.outs[1].set(!1)};(je.prototype=Object.create(B.prototype)).constructor=je,je.type="DLatch",je.label="D  Latch",je.desc="D Latch",je.order=202,je.description="<h2>D Latch</h2>\n<p>A D latch passes the input D to the outputs Q and Q' when the clock input CLK is true, but\nlatches the value when CLK is false.</p>",je.prototype.compute=function(t){if(t[1]){var e=t[0];this.outs[0].set(e),this.outs[1].set(e)}},je.prototype.clone=function(){var t=new je;return t.copyFrom(this),t},je.paletteImage=function(){var t=new J(120,120);t.context.lineWidth=1.5,t.box(40,80);t.io(20,-18,"e"),t.io(20,18,"e"),t.io(-20,0,"w"),t.io(0,-40,"n"),t.circle(23,18,3);var e="20px Times";return t.drawText("Q",10,-13,e),t.drawTextBar("Q",10,23,e),t.drawText("D",-12,5,e),t.drawText("CLK",0,-29,"12px Times"),t};var Le=function(){B.call(this),this.height=90,this.width=64;var t=this.width/2;this.addIn(-t,-32,16,"R"),this.addIn(-t,32,16,"S"),this.addOut(t,-32,16,"Q"),this.addOutInv(t,32,16,"Q",!0),this.outs[0].set(!1),this.outs[1].set(!1)};(Le.prototype=Object.create(B.prototype)).constructor=Le,Le.type="SRLatch",Le.label="SR Latch",Le.desc="SR Latch",Le.order=200,Le.description="<h2>SR Latch</h2><p>Set/Reset latch. The S input sets the output. The R input resets the output.</p>",Le.prototype.compute=function(t){this.outs[0].get(),this.outs[1].get();var e=t[0],i=t[1];e&&i?(this.outs[0].set(!0),this.outs[1].set(!1)):e?(this.outs[0].set(!1),this.outs[1].set(!1)):i&&(this.outs[0].set(!0),this.outs[1].set(!0))},Le.prototype.clone=function(){var t=new Le;return t.copyFrom(this),t},Le.paletteImage=function(){var t=new J(120,100);t.context.lineWidth=1.5,t.box(40,70);var e=20;t.io(20,-20,"e"),t.io(20,e,"e"),t.io(-20,-20,"w"),t.io(-20,e,"w"),t.circle(23,e,3);var i="20px Times";return t.drawText("Q",10,-15,i),t.drawTextBar("Q",10,25,i),t.drawText("R",-12,-15,i),t.drawText("S",-12,25,i),t};var Re=function(){B.call(this),this.height=150,this.width=90,this.value=void 0;this.addIn(-this.width/2,0,11,"in").bus=!0};(Re.prototype=Object.create(B.prototype)).constructor=Re,Re.prototype.prefix="L",Re.prototype.nameRequired=!0,Re.type="letters16",Re.label="16 Letter Display",Re.desc="16 Letter Display",Re.img="letters16.png",Re.description='<h2>16 Letter Display</h2>\n<p>A special display used for Word Sequencing tasks. A 4-bit bus input value 0-15 (0 to f in hex) maps\nto the letters indicated in this table:</p>\n<table class="center">\n<tr><th>Value</th><th>Letter</th></tr>\n<tr><td>0</td><td>A</td></tr>\n<tr><td>1</td><td>C</td></tr>\n<tr><td>2</td><td>D</td></tr>\n<tr><td>3</td><td>E</td></tr>\n<tr><td>4</td><td>F</td></tr>\n<tr><td>5</td><td>H</td></tr>\n<tr><td>6</td><td>I</td></tr>\n<tr><td>7</td><td>L</td></tr>\n<tr><td>8</td><td>M</td></tr>\n<tr><td>9</td><td>N</td></tr>\n<tr><td>a</td><td>O</td></tr>\n<tr><td>b</td><td>R</td></tr>\n<tr><td>c</td><td>S</td></tr>\n<tr><td>d</td><td>T</td></tr>\n<tr><td>e</td><td>U</td></tr>\n<tr><td>f</td><td>W</td></tr>\n</table>\n',Re.order=510,Re.prototype.compute=function(t){if(Array.isArray(t[0])){var e=t[0];void 0===e[0]||void 0===e[1]||void 0===e[2]||void 0===e[3]?this.value=void 0:this.value=(e[0]?1:0)+(e[1]?2:0)+(e[2]?4:0)+(e[3]?8:0)}else this.value=void 0},Re.prototype.get=function(t){return this.ins[0].value[t]},Re.prototype.clone=function(){var t=new Re;return t.value=this.value,t.copyFrom(this),t},Re.prototype.draw=function(t,e){var i=this.x-this.width/2-.5,n=(this.x,this.width,this.y-this.height/2-.5);this.y,this.height;this.selectStyle(t,e);var o=t.fillStyle,r=t.strokeStyle;t.fillStyle="#cccccc",t.fillRect(i,n,this.width,this.height),t.fillStyle=o,t.beginPath(),t.rect(i,n,this.width,this.height),t.stroke();var s=void 0===this.value?"?":["A","C","D","E","F","H","I","L","M","N","O","R","S","T","U","W"][this.value];t.beginPath(),t.font="60px Arial",t.textAlign="center",t.strokeStyle="#008800",t.fillStyle=t.strokeStyle,t.fillText(s,this.x,this.y+20),t.stroke(),t.lineWidth=1,t.fillStyle=o,t.strokeStyle=r,this.drawName(t,0,this.height/2-8),this.drawIO(t,e)};var De=function(){B.call(this),this.height=90,this.width=32;var t=this.width/2,e=this.height/2;this.lastClk=!1,this.addIn(-t,0,8,"D").bus=!0;var i=this.addIn(0,-e,11);i.orientation="n",i.clock=!0,this.addOut(t,0,8,"Q").bus=!0,this.outs[0].set(void 0)};(De.prototype=Object.create(B.prototype)).constructor=De,De.type="Register",De.label="Register",De.desc="Register",De.description="<h2>Register</h2>\n<p>A bus register. Works like a D Flip-Flop for all bits on a bus input and output. \nWhen the clock input goes high, the output is set to the value of the input. Works for\nany bus size.</p>",De.order=404,De.prototype.compute=function(t){if(t[1]&&!this.lastClk){var e=t[0];this.outs[0].set(e)}this.lastClk=t[1]},De.prototype.clone=function(){var t=new De;return t.copyFrom(this),t},De.prototype.draw=function(t,e){this.selectStyle(t,e),this.drawBox(t),this.drawName(t,0,-16),this.drawIO(t,e)},De.paletteImage=function(){var t=new J(60,44);return t.box(12,32),t.io(-6,0,"w"),t.io(6,0,"e"),t.drawText("D",-3,2,"7px Times"),t.drawText("Q",3,2,"7px Times"),t.clock(0,-16,"n"),t};var Ue=function(){B.call(this),this.height=128,this.width=64,this.shrink=15;var t=-this.width/2,e=this.width/2;this.addIn(t,-32,16,"A").bus=!0,this.addIn(t,32,16,"B").bus=!0;var i=.5*this.shrink,n=this.addIn(0,this.height/2-i,6+i,"C");n.orientation="s",n.bus=!0,this.addOut(e,0,16,"O").bus=!0,this.addOut(e,24,16,"CPSR").bus=!0};(Ue.prototype=Object.create(B.prototype)).constructor=Ue,Ue.prototype.prefix="ALU",Ue.prototype.nameRequired=!0,Ue.type="alu4",Ue.label="ALU 4",Ue.desc="Simple 4-bit ALU",Ue.img="alu.png",Ue.description="<h2>4-bit ALU</h2><p>Simple example 4-bit ALU</p>\n<p>The operation is determined by the value of the C bus input. Operations \nsupported are:<p>\n<table>\n<tr><th>C</th><th>operation</th></tr>\n<tr><td>0</td><td>O&larr;B</td></tr>\n<tr><td>1</td><td>O&larr;A+B</td></tr>\n<tr><td>2</td><td>O&larr;A-B</td></tr>\n<tr><td>3</td><td>O&larr;A&amp;B</td></tr>\n<tr><td>4</td><td>O&larr;A|B</td></tr>\n<tr><td>5</td><td>O&larr;A&lt;&lt;B (logical)</td></tr>\n<tr><td>6</td><td>O&larr;A&lt;&lt;B (arithmetic)</td></tr>\n</table>\n<p>For the shift operations, negative values for B result in a right shift.<p>\n<p>The CPSR bits are VCZN (N is the lsb).</p>",Ue.order=602,Ue.prototype.compute=function(t){var e=t[0],i=t[1],n=t[2];function o(t){if(void 0!==t){var e=1,i=0;return t.forEach((function(t){void 0!==t&&(t&&(8==e?i-=e:i+=e),e*=2)})),i}}var r=o(e),s=o(i),a=s,l=!1,c=!1;switch(o(n)){default:a=s;break;case 1:l=0!=(16&(15&r)+(15&s)),c=(a=r+s)<-8||a>7;break;case 2:l=0!=(16&(15&r)+(15&~s)+1),c=(a=r-s)<-8||a>7;break;case 3:a=r&s;break;case 4:a=r|s;break;case 5:a=s<0?(15&r)>>-s:(15&r)<<s;break;case 6:a=s<0?r>>-s:r<<s}if(void 0===a)this.outs[0].set([void 0,void 0,void 0,void 0]),this.outs[1].set([void 0,void 0,void 0,void 0]);else{var h=[1==(1&a),2==(2&a),4==(4&a),8==(8&a)];this.outs[0].set(h),this.outs[1].set([h[3],0==a,l,c])}},Ue.prototype.clone=function(){var t=new Ue;return t.copyFrom(this),t},Ue.prototype.draw=function(t,e){this.selectStyle(t,e);var i=this.x-this.width/2-.5,n=this.x+this.width/2+.5,o=this.y-this.height/2-.5,r=this.y+this.height/2+.5;t.beginPath(),t.moveTo(i,o),t.lineTo(i,this.y-this.shrink/2),t.lineTo(i+20,this.y),t.lineTo(i,this.y+this.shrink/2),t.lineTo(i,r),t.lineTo(n,r-this.shrink),t.lineTo(n,o+this.shrink),t.lineTo(i,o),null!==this.naming&&(t.font="14px Times",t.textAlign="center",t.fillText(this.naming,this.x,this.y-15)),t.stroke(),this.drawIO(t,e)},Ue.prototype.properties=function(t){new C(this,t).open()};var Me=function(t,e,i,n,o){this.label=t,this.value=e,this.x=i,this.y=n,this.size=void 0===o?30:o,this.state="off"};function qe(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return Fe(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Fe(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw r}}}}function Fe(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}Me.prototype.touch=function(t,e){var i=this.size;return t>this.x-i/2&&t<this.x+i/2&&e>this.y-i/2&&e<this.y+i/2&&(this.state="pressed",!0)},Me.prototype.setState=function(t){this.state=t},Me.prototype.untouch=function(){return"pressed"===this.state&&(this.state="on",!0)},Me.prototype.draw=function(t,e,i){var n=t.fillStyle,o=t.strokeStyle;e+=this.x,i+=this.y;var r=this.size,s=.85*r;switch(this.state){case"off":default:t.fillStyle="#3ab5de";break;case"pressed":t.fillStyle="#ff5255";break;case"on":t.fillStyle="#0000ff"}Q.roundedRect(t,e-r/2,i-r/2,r,r,3),t.fill(),t.lineWidth=2,t.strokeStyle="#f2f2f2",Q.roundedRect(t,e-r/2,i-r/2,r,r,3),t.stroke(),t.font=s+"px Arial",t.textAlign="center",t.fillStyle="#f2f2f2",t.fillText(this.label,e,i+.38*s),t.lineWidth=1,t.fillStyle=n,t.strokeStyle=o};var He=function(){B.call(this),this.height=150,this.width=150,this.value=new Bt,this.bus=!0,this.bits=4,this.clockDelay=0,this.pad=null,this.setType(16),this.setAsInteger(0),this.setPressedOut(!1)};(He.prototype=Object.create(B.prototype)).constructor=He,He.prototype.prefix="P",He.prototype.nameRequired=!0,He.type="Pad",He.label="Pad",He.desc="Configurable Keypad",He.img="pad.png",He.description="<h2>Configurable Keypad</h2>\n<p>Presents a keypad with from 4 to 16 buttons. If configured as a bus output, there are two outputs. \nThe top output is the bus output and is the \nmost recently pressed button value. If configured for single bit output, there will be 2-4 output bits\nthe represent the most recently pressed button. \nThe bottom output is the clock and is true when the button is pressed.</p>",He.order=500,He.help="pad",He.prototype.setType=function(t){var e=this;if(this.pad!==t){var i=30;switch(t){case 16:case"16":default:!function(){e.pad=16;var t=-52.5,n=-17.5,o=17.5,r=52.5,s=-8;e.buttons=[new Me("0",0,t,t+s,i),new Me("1",1,n,t+s,i),new Me("2",2,o,t+s,i),new Me("3",3,r,t+s,i),new Me("4",4,t,n+s,i),new Me("5",5,n,n+s,i),new Me("6",6,o,n+s,i),new Me("7",7,r,n+s,i),new Me("8",8,t,9.5,i),new Me("9",9,n,9.5,i),new Me("A",10,o,9.5,i),new Me("B",11,r,9.5,i),new Me("C",12,t,44.5,i),new Me("D",13,n,44.5,i),new Me("E",14,o,44.5,i),new Me("F",15,r,44.5,i)],e.width=154,e.height=e.width+13+4,e.bits=4}();break;case 10:case"10":!function(){e.pad=10;var t=-52.5,n=-17.5,o=-8;e.buttons=[new Me("1",1,-35,t+o,i),new Me("2",2,0,t+o,i),new Me("3",3,35,t+o,i),new Me("4",4,-35,n+o,i),new Me("5",5,0,n+o,i),new Me("6",6,35,n+o,i),new Me("7",7,-35,9.5,i),new Me("8",8,0,9.5,i),new Me("9",9,35,9.5,i),new Me("0",0,0,44.5,i)],e.width=119,e.height=171,e.bits=4}();break;case 12:case"12":!function(){e.pad=12;var t=-35,n=-52.5,o=-17.5,r=-8;e.buttons=[new Me("1",1,t,n+r,i),new Me("2",2,0,n+r,i),new Me("3",3,35,n+r,i),new Me("4",4,t,o+r,i),new Me("5",5,0,o+r,i),new Me("6",6,35,o+r,i),new Me("7",7,t,9.5,i),new Me("8",8,0,9.5,i),new Me("9",9,35,9.5,i),new Me("*",10,t,44.5,i),new Me("0",0,0,44.5,i),new Me("#",11,35,44.5,i)],e.width=119,e.height=171,e.bits=4}();break;case 8:case"8":!function(){e.pad=8;var t=-17.5,n=17.5,o=-8;e.buttons=[new Me("0",0,-52.5,t+o,i),new Me("1",1,t,t+o,i),new Me("2",2,n,t+o,i),new Me("3",3,52.5,t+o,i),new Me("4",4,-52.5,9.5,i),new Me("5",5,t,9.5,i),new Me("6",6,n,9.5,i),new Me("7",7,52.5,9.5,i)],e.width=154,e.height=101,e.bits=3}();break;case 4:case"4":!function(){e.pad=4;var t=-17.5,n=17.5;e.buttons=[new Me("0",0,t,t+-8,i),new Me("1",1,n,t+-8,i),new Me("2",2,t,9.5,i),new Me("3",3,n,9.5,i)],e.width=84,e.height=101,e.bits=2}()}this.ensureIO()}else this.ensureIO()},He.prototype.ensureIO=function(){var t=0;if(this.outs.length>0){var e=!1;if(this.outs[0].bus!==this.bus&&(e=!0),this.bus||this.outs.length===this.bits+1||(e=!0),!e){var i,n=qe(this.outs);try{for(n.s();!(i=n.n()).done;){i.value.x=this.width/2}}catch(t){n.e(t)}finally{n.f()}return}}for(t=0;t<this.outs.length;t++)this.outs[t].clear();this.outs=[];if(this.bus)this.addOut(this.width/2,-16,11).bus=!0;else for(t=0;t<this.bits;t++){var o=0-16*t;this.addOut(this.width/2,o,11)}this.addOut(this.width/2,32,11),this.setOuts(),this.setPressedOut(!1)},He.prototype.clone=function(){var t=new He;return t.value=this.value.clone(),t.bus=this.bus,t.setType(this.pad),t.copyFrom(this),t},He.prototype.draw=function(t,e){var i=this,n=this.x-this.width/2-.5,o=this.y-this.height/2-.5,r=this.unselectedStyle;this.unselectedStyle="#f2f2f2",this.selectStyle(t,e);var s=t.fillStyle,a=t.strokeStyle;t.fillStyle="#111111",Q.roundedRect(t,n,o,this.width,this.height,6),t.fill();t.fillStyle=s,t.lineWidth=2,Q.roundedRect(t,n+3,o+3,this.width-6,this.height-6,6),t.stroke(),t.lineWidth=1,this.buttons.forEach((function(e){e.draw(t,i.x,i.y)})),this.drawName(t,0,this.height/2-8),t.lineWidth=1,t.fillStyle=s,t.strokeStyle=a,this.unselectedStyle=r,this.drawIO(t,e)},He.prototype.touch=function(t,e){var i=this.size;if(!(t<this.x-i/2||t>this.x+i/2||e<this.y-i/2||e>this.y-i/2)){for(var n in this.buttons){var o=this.buttons[n];if(o.touch(t-this.x,e-this.y)){this.setAsInteger(o.value,4),this.setPressedOut(!0);break}}return B.prototype.touch.call(this,t,e)}},He.prototype.set=function(t){this.value.set(t),this.setOuts(),this.updateUI()},He.prototype.setAsInteger=function(t){this.value.setAsInteger(t,this.bits),this.setOuts(),this.updateUI()},He.prototype.updateUI=function(){var t=this.value.getAsInteger(),e=this.getPressedOut();void 0===e&&(e=!1),this.buttons.forEach((function(i){i.value!==t?i.setState("off"):e?i.setState("pressed"):i.setState("on")}))},He.prototype.setAsString=function(t,e){"release"===t?this.mouseUp():"press:"===t.substr(0,6)?(this.value.setAsHex(t.substr(6)),this.setPressedOut(!0),this.updateUI()):(this.value.setAsString(t,e),this.updateUI()),e||this.setOuts()},He.prototype.setOuts=function(){if(this.bus)this.outs[0].set(this.value.get());else for(var t=0;t<this.bits;t++)this.outs[t].set(this.value.getBit(t))},He.prototype.advance=function(t){return!1},He.prototype.compute=function(t){var e=!0===t[0];this.bus?this.outs[1].set(e):this.outs[this.bits].set(e),this.updateUI()},He.prototype.setPressedOut=function(t){var e=this.getSimulation();null!==e&&e.queue(this,50,[t])},He.prototype.getPressedOut=function(){return this.bus?this.outs[1].get():this.outs[this.bits].get()},He.prototype.mouseUp=function(){this.buttons.forEach((function(t){t.untouch()})),this.setPressedOut(!1)},He.prototype.save=function(){var t=B.prototype.save.call(this);return this.value.save(t),t.pad=this.pad,t.bus=this.bus,t},He.prototype.load=function(t){this.value.load(t),this.bus=!1!==t.bus,this.setType(t.pad),B.prototype.load.call(this,t)},He.prototype.properties=function(t){var e=this,i=new C(this,t),n=i.uniqueId(),o='<div class="control center"><div class="choosers">';o+='\n<label><input type="radio" name="'.concat(n,'" value="16" ').concat(16===this.pad?"checked":"",'> 16 Buttons (Hex)</label>\n<label><input type="radio" name="').concat(n,'" value="10" ').concat(10===this.pad?"checked":"",'> 10 Buttons </label>\n<label><input type="radio" name="').concat(n,'" value="8" ').concat(8===this.pad?"checked":"",'> 8 Buttons </label>\n<label><input type="radio" name="').concat(n,'" value="4" ').concat(4===this.pad?"checked":"",'> 4 Buttons </label>\n<label><input type="radio" name="').concat(n,'" value="12" ').concat(12===this.pad?"checked":"","> Phone (12 buttons)</label>\n"),o+="<br>";var r=i.uniqueId();o+='\n<label><input type="radio" name="'.concat(r,'"  ').concat(this.bus?"checked":"",' value="1"> Bus Output</label>\n<label><input type="radio" name="').concat(r,'" ').concat(this.bus?"":"checked",' value="0"> Single Bit Outputs</label>'),o+="</div></div>",i.extra(o,(function(){return null}),(function(){e.bus="1"===document.querySelector("input[name=".concat(r,"]:checked")).value,e.setType(document.querySelector("input[name=".concat(n,"]:checked")).value)})),i.open()};var Xe=function(){B.call(this),this.height=50,this.width=20,this.leds=[],this.horz=!1,this.bus=!1,this.color="blue",this.lastState=[],this.setSize(4)};(Xe.prototype=Object.create(B.prototype)).constructor=Xe,Xe.prototype.prefix="L",Xe.type="LEDBar",Xe.label="LED Bar",Xe.desc="LED Indicator Bar",Xe.img="ledbar.png",Xe.description="<h2>LED Bar</h2><p>The LED Bar component displays from two to \nsixteen LEDs in a vertical or horizontal bar that are lighted by values on discrete inputs\nor a single bus input. </p>",Xe.order=502,Xe.help="ledbar",Xe.prototype.setSize=function(t){this.size=+t,this.ensureIO()},Xe.prototype.compute=function(t){this.bus?(this.lastState=t[0],void 0===this.lastState&&(this.lastState=[])):this.lastState=t},Xe.prototype.clone=function(){var t=new Xe;return t.size=this.size,t.horz=this.horz,t.bus=this.bus,t.ensureIO(),t.copyFrom(this),t},Xe.prototype.load=function(t){this.color=ot.sanitize(t.color),void 0!==t.horz&&(this.horz=!0===t.horz),void 0!==t.bus&&(this.bus=!0===t.bus),this.setSize(t.size),B.prototype.load.call(this,t)},Xe.prototype.save=function(){var t=B.prototype.save.call(this);return t.size=this.size,t.color=this.color,t.horz=this.horz,t.bus=this.bus,t},Xe.prototype.ensureIO=function(){var t=16,e=0;if(this.leds=[],this.ins.length>0&&this.ins[0].bus!==this.bus){for(e=0;e<this.ins.length;e++)this.ins[e].clear();this.ins=[]}if(this.horz){this.width=this.size*t,this.width<50&&(this.width=50),this.height=20;var i=this.size/2*t-8;for(e=0;e<this.size;e++){var n=i-e*t;this.leds.push(new le(n,0,t,this.height))}if(this.bus){var o=null;e<this.ins.length?((o=this.ins[e]).x=-this.width/2,o.y=0,o.len=16):o=this.addIn(-this.width/2,0,16),o.orientation="w",o.bus=!0,o.autoLen()}else for(e=0;e<this.size;e++){var r=i-e*t,s=24-this.height/2,a=null;null!==(a=e<this.ins.length?this.ins[e]:this.addIn(r,this.height/2,s))&&(a.x=r,a.y=this.height/2,a.len=s,a.orientation="s",a.bus=!1)}}else{this.height=this.size*t,this.height<50&&(this.height=50),this.width=20;var l=this.size/2*t-8;for(e=0;e<this.size;e++){var c=l-e*t;this.leds.push(new le(0,c,this.width,t))}if(this.bus){var h=null;e<this.ins.length?((h=this.ins[e]).x=0,h.y=this.height/2,h.len=16):h=this.addIn(0,this.height/2,16),h.orientation="s",h.bus=!0,h.autoLen()}else for(e=0;e<this.size;e++){var u=l-e*t,d=24-this.width/2,p=null;e<this.ins.length?((p=this.ins[e]).x=-this.width/2,p.y=u,p.len=d):p=this.addIn(-this.width/2,u,d),null!==p&&(p.orientation="w",p.bus=!1)}}if(!this.bus&&e<this.ins.length){for(;e<this.ins.length;e++)this.ins[e].clear();this.ins.splice(this.size)}},Xe.prototype.draw=function(t,e){for(var i=0;i<this.lastState.length&&i<this.leds.length;i++){var n=this.lastState[i];this.leds[i].color=void 0===n?"undefined":n?this.color:"black"}for(;i<this.leds.length;i++)this.leds[i].color="undefined";var o="#444444";this.selectStyle(t,e),this.drawBox(t,o);for(var r=0;r<this.size;r++)this.leds[r].draw(t,this.x,this.y,o);this.drawBox(t,"none"),this.drawIO(t,e)},Xe.prototype.properties=function(t){var e=this,i=new C(this,t),n=i.uniqueId(),o='<div class="control1 center"><label for="'.concat(n,'">Size: </label>\n<input class="number" type="text" name="').concat(n,'" id="').concat(n,'" value="').concat(this.size,'"></div>'),r=i.uniqueId();o+=le.colorSelector(r,this.color),o+='<div class="control center"><div class="choosers">';var s=i.uniqueId();o+='\n<label><input type="radio" name="'.concat(s,'" ').concat(this.horz?"":"checked",' value="0"> Vertical</label>\n<label><input type="radio" name="').concat(s,'"  ').concat(this.horz?"checked":"",' value="1"> Horizontal</label>'),o+="<br>";var a=i.uniqueId();o+='\n<label><input type="radio" name="'.concat(a,'"  ').concat(this.bus?"checked":"",' value="1"> Bus Input</label>\n<label><input type="radio" name="').concat(a,'" ').concat(this.bus?"":"checked",' value="0"> Single Bit Inputs</label>'),o+="</div></div>",i.extra(o,(function(){var t=parseInt(document.getElementById(n).value);return isNaN(t)||t<2||t>16?"Size must be an integer from 2 to 16":null}),(function(){e.color=ot.sanitize(document.getElementById(r).value),e.horz="1"===document.querySelector("input[name=".concat(s,"]:checked")).value,e.bus="1"===document.querySelector("input[name=".concat(a,"]:checked")).value,e.setSize(parseInt(document.getElementById(n).value))})),i.open()};var We=function(){B.call(this),this.height=128,this.width=64;var t=this.width/2,e=this.height/2;this.value=0,this.lastClk=!1,this.ba=0;var i=this.addIn(0,-e,8);i.orientation="n",i.clock=!0,this.addIn(-t,-32,16,"BA").bus=!0,this.addIn(-t,32,16,"B"),this.addIn(0,e,8,"R").orientation="s",this.addOut(t,-32,16,"PC").bus=!0,this.outs[0].set(void 0)};(We.prototype=Object.create(B.prototype)).constructor=We,We.prototype.prefix="PC",We.type="Pc16",We.label="Program Counter",We.desc="Program Counter",We.img="pc16.png",We.description="<h2>Program Counter</h2><p>Simple 16-bit program counter (PC). If B is true when \nthe clock edge rises, the signed value in BA (branch address) plus 2 is added to the PC.</p>",We.order=702,We.help="pc16",We.prototype.compute=function(t){t[3]?this.value=0:t[0]&&!this.lastClk&&(this.ba=l.busValueToDecimal(t[1]),this.value+=2,t[2]&&null!==this.ba&&(this.value+=this.ba+2)),this.value&=65535;for(var e=this.value,i=[],n=0;n<16;n++)i.push(1==(1&e)),e>>=1;this.outs[0].set(i),this.lastClk=t[0]},We.prototype.clone=function(){var t=new We;return t.copyFrom(this),t},We.prototype.draw=function(t,e){this.selectStyle(t,e),this.drawBox(t);var i=this.y-10;t.font='14px "Lucida Console", Monaco, monospace',t.textAlign="center",t.fillText(r.toHex(this.value,4),this.x,i),i+=20,t.font="12px Times",t.fillText("program",this.x,i),t.fillText("counter",this.x,i+15),this.drawIO(t,e)};var Ye=function(){B.call(this),this.height=132,this.width=64;var t=this.width/2,e=this.height/2;this.lastClk=!1,this.data=[],this.lastAddress=0,this.lastData=0,this.write=0,this.addIn(-t,-32,16,"A").bus=!0,this.addIn(-t,32,16,"W").bus=!0;var i=this.addIn(0,-e,14);i.orientation="n",i.clock=!0,this.addOut(t,-32,16,"R").bus=!0};(Ye.prototype=Object.create(B.prototype)).constructor=Ye,Ye.prototype.prefix="M",Ye.type="Memory16",Ye.label="Memory",Ye.desc="16-bit Memory",Ye.img=null,Ye.description="<h2>16-bit Memory Bank</h2><p>The Memory component implements a simple 16-bit Memory Bank.\nMemory is an array of bytes. The A (address) input selects a memory location that is output on the R\noutput. The component implements 16-bit memory,\nso all accesses are considered to be multiples of two and retrieve two bytes. Memory is retrieved in little-endian\nmode (first byte is the least significant byte).</p>\n<p>A clock cycle on the clock input writes the memory component with the value on the W (write) input.</p>",Ye.order=704,Ye.help="memory16",Ye.prototype.compute=function(t){var e=l.busValueToDecimal(t[0]);if(null===e)this.outs[0].set(void 0);else{if(t[2]&&!this.lastClk&&(this.write=l.busValueToDecimal(t[1]),null!==this.write)){for(;this.data.length<e+2;)this.data.push(0);var i=this.write>>8,n=255&this.write;this.data[e]=n,this.data[e+1]=i}if(e<this.data.length-1)var o=this.data[e]+(this.data[e+1]<<8);else o=0;this.lastAddress=e,this.lastData=o;for(var r=[],s=0;s<16;s++)r.push(1==(1&o)),o>>=1;this.outs[0].set(r)}this.lastClk=t[2]},Ye.prototype.setAsString=function(t,e){t=ot.sanitize(t),void 0===e&&(e=!0),e&&(this.data=[]);var i=t.split(/\s+/),n=0;for(var o in i){if((r=i[o]).indexOf(":")>=0){if(n=parseInt(r,16),isNaN(n))return"invalid input address"}else if(""!==r){var r=parseInt(r,16);if(isNaN(r))return"invalid input data";if(e){for(;this.data.length<n;)this.data.push(0);this.data[n]=r,n++}}}return e&&this.pending(),null},Ye.prototype.clone=function(){var t=new Ye;return t.data=this.data.slice(),t.copyFrom(this),t},Ye.prototype.load=function(t){this.data=t.data,B.prototype.load.call(this,t)},Ye.prototype.save=function(){var t=B.prototype.save.call(this);return t.data=this.data,t},Ye.prototype.draw=function(t,e){this.selectStyle(t,e),this.drawBox(t),t.font="12px Times",t.textAlign="center",t.fillText(r.toHex(this.lastAddress,4)+":"+r.toHex(this.lastData,4),this.x,this.y+this.height/2-18),t.fillText("memory",this.x,this.y+this.height/2-5),this.drawName(t,0,3),this.drawIO(t,e)},Ye.prototype.properties=function(t){for(var e=this,i="",n=0;n<this.data.length;n++)n%8==0&&(i.length>0&&(i+="\n"),i+=r.toHex(n,4)+":"),i+=" "+r.toHex(this.data[n],2);var o=new C(this,t),s=o.uniqueId(),a='<div class="control"><label for="'.concat(s,'">Contents:</label>\n<textarea class="code1" type="text" rows="9" name="').concat(s,'" id="').concat(s,'" spellcheck="false">').concat(i,"</textarea>\n</div>");o.extra(a,(function(){var t=document.getElementById(s).value;return e.setAsString(t,!1)}),(function(){var t=document.getElementById(s).value;return e.setAsString(t)}),85),o.open()},Ye.paletteImage=function(){var t=new J(120,120),e=t.context;e.lineWidth=1.5,t.box(40,80);var i=t.width,n=t.height,o=18;t.io(0,-40,"n");var r=t.lineWidth(2);t.io(20,-18,"e"),t.io(-20,-18,"w"),t.io(-20,o,"w"),t.lineWidth(r);var s="20px Times";t.drawText("R",10,-13,s),t.drawText("A",-12,-13,s),t.drawText("W",-12,23,s);return e.beginPath(),e.moveTo(i/2-7,n/2-40),e.lineTo(i/2,n/2-33),e.lineTo(7+i/2,n/2-40),e.stroke(),t.drawText("memory",0,38,"8px Times"),t.drawText("0000:0000",0,32,"8px Times"),t};var Ve=function(){B.call(this);var t=16;Object.defineProperties(this,{size:{get:function(){return t},set:function(e){switch(+e){case 8:t=8;break;default:t=16;break;case 32:t=32}}},badAddr:{writable:!0},height:{value:132},width:{value:64}});var e=this.width/2,i=this.height/2;this.lastClk=!1,this.data=[],this.lastAddress=null,this.lastData=null,this.write=0,this.addIn(-e,-32,16,"A").bus=!0,this.addIn(-e,32,16,"W").bus=!0;var n=this.addIn(0,-i,14);n.orientation="n",n.clock=!0,this.addOut(e,-32,16,"R").bus=!0};(Ve.prototype=Object.create(B.prototype)).constructor=Ve,Ve.prototype.prefix="M",Ve.type="Memory",Ve.label="Memory",Ve.desc="Memory",Ve.img=null,Ve.description="<h2>Memory Bank</h2><p>The Memory component implements a simple Memory Bank.\nMemory is an array of bytes. The A (address) input selects a memory location that is output on the R\noutput. The component can be configured for 8-, 16-, or 32-bit memory. \n</p>\n<p>In the 16-bit configuration,\nall accesses are considered to be multiples of two and retrieve two bytes. Addresses with the lower bit set\nare considered erroneous. </p>\n<p>In the 32-bit configuration,\nall accesses are considered to be multiples of four and retrieve four bytes. Addresses with any of the lower \ntwo bits set are considered erroneous.</p>\n<p>Memory is retrieved in little-endian mode (first byte is the least significant byte). \nErroneous addresses are indicated by an X next to the A input on\n the component.</p>\n<p>A clock cycle on the clock input writes the memory component with the value on the W (write) input.</p>",Ve.order=705,Ve.help="memory",Ve.prototype.compute=function(t){var e=this.size/8,i=l.busValueToDecimal(t[0]),n=i;if(this.badAddr=!1,null===n)this.outs[0].set(void 0);else{switch(e){case 2:this.badAddr=0!=(1&n),n&=65534;break;case 4:this.badAddr=0!=(3&n),n&=65532}if(t[2]&&!this.lastClk&&(this.write=l.busValueToDecimal(t[1]),null!==this.write)){for(;this.data.length<n+e;)this.data.push(0);for(var o=this.write,r=0;r<e;r++)this.data[n+r]=o,o>>=8}var s=0;if(n<=this.data.length-e)for(var a=0;a<e;a++)s+=this.data[n+a]<<8*a;this.lastAddress=i,this.lastData=s;for(var c=[],h=0;h<this.size;h++)c.push(1==(1&s)),s>>=1;this.outs[0].set(c)}this.lastClk=t[2]},Ve.prototype.setAsString=function(t,e){t=ot.sanitize(t),void 0===e&&(e=!0),e&&(this.data=[]);var i=t.split(/\s+/),n=0;for(var o in i){if((r=i[o]).indexOf(":")>=0){if(n=parseInt(r,16),isNaN(n))return"invalid input address"}else if(""!==r){var r=parseInt(r,16);if(isNaN(r))return"invalid input data";if(e){for(;this.data.length<n;)this.data.push(0);this.data[n]=r,n++}}}return e&&this.pending(),null},Ve.prototype.clone=function(){var t=new Ve;return t.data=this.data.slice(),t.size=this.size,t.copyFrom(this),t},Ve.prototype.load=function(t){this.data=t.data,this.size=t.size,B.prototype.load.call(this,t)},Ve.prototype.save=function(){var t=B.prototype.save.call(this);return t.data=this.data,t.size=this.size,t},Ve.prototype.draw=function(t,e){var i=this.size/8;this.selectStyle(t,e),this.drawBox(t);var n=null!==this.lastAddress?r.toHex(this.lastAddress,4):"????",o=null!==this.lastData?r.toHex(this.lastData,2*i):"????????".substr(0,2*i);if(t.font="12px Times",t.textAlign="center",i<4?t.fillText(n+":"+o,this.x,this.y+this.height/2-18):(t.fillText(n+":",this.x,this.y+this.height/2-18-13),t.fillText(o,this.x,this.y+this.height/2-18)),t.fillText("memory",this.x,this.y+this.height/2-5),this.drawName(t,0,3),this.drawIO(t,e),this.badAddr){var s=t.strokeStyle;t.strokeStyle="#ff0000";var a=this.x-12,l=this.y-33;t.beginPath(),t.moveTo(a-6,l-6),t.lineTo(a+6,l+6),t.moveTo(a+6,l-6),t.lineTo(a-6,l+6),t.stroke(),t.strokeStyle=s}},Ve.prototype.properties=function(t){for(var e=this,i="",n=0;n<this.data.length;n++)n%8==0&&(i.length>0&&(i+="\n"),i+=r.toHex(n,4)+":"),i+=" "+r.toHex(this.data[n],2);for(var o=new C(this,t),s=o.uniqueId(),a=o.uniqueId(),l='<div class="control">\n<label for="'.concat(s,'">Contents:\n<textarea class="code1" type="text" rows="9" name="').concat(s,'" id="').concat(s,'" spellcheck="false">').concat(i,'</textarea>\n</label>\n</div>\n<div class="control center">\n<label>Size: \n<select name="').concat(a,'" id="').concat(a,'">\n'),c=0,h=[8,16,32];c<h.length;c++){var u=h[c],d=this.size===u?" selected":"";l+='<option value="'.concat(u,'"').concat(d,">").concat(u,"</option>")}l+="</select>\n</label>\n</div>",o.extra(l,(function(){var t=document.getElementById(s).value;return e.setAsString(t,!1)}),(function(){e.size=document.getElementById(a).value;var t=document.getElementById(s).value;return e.setAsString(t)}),85),o.open()},Ve.paletteImage=function(){var t=new J(120,120),e=t.context;e.lineWidth=1.5,t.box(40,80);var i=t.width,n=t.height,o=18;t.io(0,-40,"n");var r=t.lineWidth(2);t.io(20,-18,"e"),t.io(-20,-18,"w"),t.io(-20,o,"w"),t.lineWidth(r);var s="20px Times";t.drawText("R",10,-13,s),t.drawText("A",-12,-13,s),t.drawText("W",-12,23,s);return e.beginPath(),e.moveTo(i/2-7,n/2-40),e.lineTo(i/2,n/2-33),e.lineTo(7+i/2,n/2-40),e.stroke(),t.drawText("memory",0,38,"8px Times"),t.drawText("0000:0000",0,32,"8px Times"),t};var _e=function(){B.call(this),this.height=100,this.width=48,this.size=8,this.circuitOuts=[],this.addIn(-this.width/2,0,16,"In").bus=!0,this.ensureIO()};(_e.prototype=Object.create(B.prototype)).constructor=_e,_e.prototype.prefix=null,_e.type="Decoder3",_e.label="3-to-8",_e.desc="3-to-8 Decoder",_e.img="decoder3.png",_e.description="<h2>3-to-8 decoder</h2>\n<p>Converts a 3-bit binary value on <strong>In</strong> to a true on one of eight output lines.</p>",_e.order=1e3,_e.prototype.compute=function(t){if(Array.isArray(t[0]))for(var e=(t[0][0]?1:0)+(t[0][1]?2:0)+(t[0][2]?4:0),i=0;i<this.size;i++)this.outs[i].set(i==e);else for(i=0;i<this.size;i++)this.outs[i].set(void 0)},_e.prototype.clone=function(){var t=new _e;return t.copyFrom(this),t},_e.prototype.ensureIO=function(){this.height=16*this.size+24,this.height<80&&(this.height=80);for(var t=this.width/2,e=this.size/2*16-8,i=0;i<this.size&&!(i>=this.outs.length);i++)this.outs[i].name="O"+i,this.outs[i].x=t,this.outs[i].y=e-16*i,this.outs[i].len=16;for(;i<this.size;i++)this.addOut(t,e-16*i,16,"O"+i);if(i<this.outs.length){for(;i<this.outs.length;i++)this.outs[i].clear();this.outs.splice(this.size)}},_e.prototype.draw=function(t,e){this.selectStyle(t,e);this.x,this.width,this.x,this.width,this.y,this.height,this.y,this.height;this.drawBox(t),t.font="12px Times",t.textAlign="center",t.fillText("decoder",this.x,this.y+this.height/2-2),this.drawIO(t,e)};var Ge=function(t){B.call(this,t),this.height=120,this.width=80,this.instruction="";var e=-32;this.addOut(this.width/2,e,16,"Ae").bus=!0,e+=16,this.addOut(this.width/2,e,16,"Be").bus=!0,e+=16,this.addOut(this.width/2,e,16,"ALUe").bus=!0,e+=16,this.addOut(this.width/2,e,16,"Im").bus=!0,e+=16,this.addOut(this.width/2,e,16,"C").bus=!0,e+=16,this.setAsString("nop")};(Ge.prototype=Object.create(B.prototype)).constructor=Ge,Ge.prototype.prefix="ID",Ge.prototype.nameRequired=!0,Ge.type="InstructionDecoder4",Ge.label="Instruction Decoder 4",Ge.desc="Instruction Decoder",Ge.img="insdecoder4.png",Ge.description="<h2>Instruction Decoder</h2><p>Simple example instruction decoder. Decodes assembly statements into register and ALU operations.</p>",Ge.help="instructiondecoder4",Ge.order=600,Ge.prototype.compute=function(t){},Ge.prototype.setAsString=function(t,e){this.instruction=t,void 0===e&&(e=!0);var i=this.instruction.toLowerCase().match(/\s*([a-zA-Z]*)(?:[\s,$]+([^\s,]+))?(?:[\s,$]+([^\s,]+))?(?:[\s,$]+([^\s,]+))?/);if(null===i||i.length<2)return"syntax error in input";var n=this.outs[0],o=this.outs[1],r=this.outs[2],s=this.outs[3],a=this.outs[4];function l(t){switch(t){case"r0":return"00";case"r1":return"01";case"r2":return"10";case"r3":return"11";default:return null}}function c(t){if(null==t)return null;if("#"!==t.substr(0,1))return null;var e=parseInt(t.substr(1));return e>7||e<-8?null:(0!=(8&e)?"1":"0")+(0!=(4&e)?"1":"0")+(0!=(2&e)?"1":"0")+(0!=(1&e)?"1":"0")}var h=i[1],u=i[2],d=i.length>3?i[3]:null,p=i.length>4?i[4]:null,f=l(u),v=l(d),m=l(p),y=c(d),g=c(p);function b(t){if(null===f||null===v||null===p)return null;if("#"===p.substr(0,1)){if(null===g)return"invalid immediate value";e&&(n.setAsString(v),o.setAsString("100"),r.setAsString("0"+f),a.setAsString(t),s.setAsString(g))}else null!==v&&e&&(n.setAsString(v),o.setAsString("0"+m),r.setAsString("0"+f),a.setAsString(t));return null}switch(h){case"nop":e&&(n.setAsString("00"),o.setAsString("000"),r.setAsString("100"),s.setAsString("0000"),a.setAsString("111"));break;case"mov":if(null===f)return null;if("#"===d.substr(0,1)){if(null===y)return"invalid immediate value";e&&(n.setAsString(f),o.setAsString("100"),r.setAsString("0"+f),a.setAsString("000"),s.setAsString(y))}else null!==v&&e&&(n.setAsString(f),o.setAsString("0"+v),r.setAsString("0"+f),a.setAsString("000"));break;case"add":return b("001");case"sub":return b("010");case"and":return b("011");case"or":return b("100");case"sll":return b("101");case"sla":return b("110");default:return"invalid opcode"}return null},Ge.prototype.clone=function(){var t=new Ge;return t.copyFrom(this),t},Ge.prototype.draw=function(t,e){this.selectStyle(t,e);var i=this.x-this.width/2-.5,n=this.x+this.width/2+.5,o=this.y-this.height/2-.5,r=this.y+this.height/2+.5;t.beginPath(),t.moveTo(i,o),t.lineTo(i,r),t.lineTo(n,r),t.lineTo(n,o),t.lineTo(i,o),t.font="12px Times",t.textAlign="center",t.fillText("instruction",this.x,this.y+this.height/2-14),t.fillText("decoder",this.x,this.y+this.height/2-2),t.fillText(this.instruction,this.x,this.y-this.height/2+11),null!==this.naming&&(t.font="14px Times",t.textAlign="center",t.fillText(this.naming,this.x-15,this.y+3)),t.stroke(),this.drawIO(t,e)},Ge.prototype.properties=function(t){var e=this,i=this.instruction,n=new C(this,t),o=n.uniqueId(),r="<p>Value<br>"+'<input type="text" id="'.concat(o,'" spellcheck="false" value="').concat(i,'"></p>');n.extra(r,(function(){var t=document.getElementById(o).value;return e.setAsString(t,!1)}),(function(){var t=document.getElementById(o).value;e.setAsString(t)}),40),n.open();var s=document.getElementById(o);s.select(),s.focus()};var Je=function(t){B.call(this,t),this.height=128,this.width=64,this.shrink=15,this.cin=!1;var e=-this.width/2,i=this.width/2;this.operator="";this.addIn(e,-32,16,"A").bus=!0,this.addIn(e,32,16,"B").bus=!0;var n=.5*this.shrink,o=this.addIn(0,this.height/2-n,8+n,"C");o.orientation="s",o.bus=!0,this.addIn(e,48,16,"Cin"),this.addOut(i,0,16,"O").bus=!0,this.addOut(i,24,16,"CPSR").bus=!0};(Je.prototype=Object.create(B.prototype)).constructor=Je,Je.prototype.prefix="ALU",Je.prototype.nameRequired=!0,Je.type="Alu16",Je.label="ALU 16",Je.desc="Simple 16-bit ALU",Je.img="alu.png",Je.description="<h2>16-bit ALU</h2><p>Simple example 16-bit ALU. A and B are bus inputs to the ALU. C is the control input. Cin is the carry input for adc and sbc operations. O is a bus output result and CPSR is the status output bits for the current program status register.</p><p>If Cin is not connected, it is assumed to be false.</p><p>The status bits in CPSR are: 0:N, 1:Z, 2:C, 3:V</p>",Je.help="alu16",Je.order=706,Je.prototype.compute=function(t){var e=t[0],i=t[1],n=t[2];function o(t){if(void 0!==t&&Array.isArray(t)){var e=1,i=0;return t.forEach((function(t){void 0!==t&&(t&&(32768==e?i-=e:i+=e),e*=2)})),i}}this.cin=void 0!==t[3]&&t[3];var r=o(e),s=o(i),a=s,l=!1,c=!1;switch(o(n)){case 8:case 0:a=r&s,this.operator="&";break;case 1:a=r^s,this.operator="xor";break;case 2:a=r<<s,this.operator="<<";break;case 3:a=(65535&r)>>s,this.operator=">>";break;case 4:var h=32768&r;a=r;for(var u=0;u<s;u++)a=r>>1,a|=h;this.operator="asr";break;case 5:a=r+s,this.cin&&a++,l=0!=(65536&(f=(65535&r)+(65535&s))),c=a<-32768||a>32768,this.operator="+";break;case 11:case 34:case 16:l=0!=(65536&(f=(65535&r)+(65535&s))),c=(a=r+s)<-32768||a>32768,this.operator="+";break;case 6:a=r-s,this.cin||a--,l=0!=(65536&(f=(65535&r)+(65535&~s)+1)),c=a<-32768||a>32768,this.operator="-";break;case 10:case 33:case 35:case 17:l=0!=(65536&(f=(65535&r)+(65535&~s)+1)),c=(a=r-s)<-32768||a>32768,this.operator="-";break;case 7:h=32768&r;a=65535&r;for(u=0;u<s;u++){var d=(1&a)<<15;a=(65535&r)>>1,a|=d}this.operator="ror";break;case 9:a=-s,this.operator="neg";break;case 12:a=r|s,this.operator="or";break;case 13:c=(a=r*s)<-32768||a>32768,this.operator="*";break;case 14:a=r&(65535^s),this.operator="bic";break;case 15:a=65535^r,this.operator="not";break;case 18:a=(r&=65535)*(s&=65535)>>16,this.operator="*^";break;default:a=s,this.operator="mov"}if(void 0===(a&=65535))this.outs[0].set([void 0,void 0,void 0,void 0]),this.outs[1].set([void 0,void 0,void 0,void 0]);else{var p=[],f=a;for(u=0;u<16;u++)p.push(1==(1&f)),f>>=1;this.outs[0].set(p),this.outs[1].set([p[15],0==a,l,c])}},Je.prototype.clone=function(){var t=new Je;return t.copyFrom(this),t},Je.prototype.draw=function(t,e){this.selectStyle(t,e);var i=this.x-this.width/2-.5,n=this.x+this.width/2+.5,o=this.y-this.height/2-.5,r=this.y+this.height/2+.5;if(t.beginPath(),t.moveTo(i,o),t.lineTo(i,this.y-this.shrink/2),t.lineTo(i+20,this.y),t.lineTo(i,this.y+this.shrink/2),t.lineTo(i,r),t.lineTo(n,r-this.shrink),t.lineTo(n,o+this.shrink),t.lineTo(i,o),null!==this.naming&&(t.font="14px Times",t.textAlign="center",t.fillText(this.naming,this.x,this.y-16)),this.operator.length>1)t.font="bold 14px Times",t.textAlign="center",t.fillText(this.operator,this.x+1,this.y+4);else{t.font="bold 22px Times",t.textAlign="center";var s=6;switch(this.operator){case"+":s=6;break;case"-":s=5}t.fillText(this.operator,this.x+1,this.y+s)}t.stroke(),this.drawIO(t,e)};var Ze=function(){B.call(this),this.height=98,this.width=48;var t=this.width/2,e=this.height/2;this.value=0,this.size=16,this.lastClk=!1;var i=this.addIn(0,-e,8);i.orientation="n",i.clock=!0,this.addIn(-t,-24,8,"UP"),this.addIn(0,e,8,"R").orientation="s",this.addOut(t,-24,8,"C").bus=!0,this.set(0)};(Ze.prototype=Object.create(B.prototype)).constructor=Ze,Ze.prototype.prefix="C",Ze.type="Counter",Ze.label="Counter",Ze.desc="Simple Counter",Ze.description="<h2>Simple Counter</h2><p>Supports up and down counting for \narbitrary bit sizes. C is the count output. The optional UP input controls the counting\ndirection. True means up counting. If not connected, the counter counts up. R is an \nasynchronous reset. The counter increments or decrements on the clock leading edge.</p>",Ze.order=406,Ze.help="Counter",Ze.prototype.compute=function(t){t[2]?this.set(0):t[0]&&!this.lastClk&&(!1!==t[1]?this.set(this.value+1):this.set(this.value-1)),this.lastClk=t[0]},Ze.prototype.set=function(t){this.value=t;for(var e=0,i=0;i<this.size;i++)e=e<<1|1;this.value&=e;for(var n=this.value,o=[],r=0;r<this.size;r++)o.push(1==(1&n)),n>>=1;this.outs[0].set(o)},Ze.prototype.clone=function(){var t=new Ze;return t.size=this.size,t.copyFrom(this),t},Ze.prototype.load=function(t){this.size=t.size,B.prototype.load.call(this,t),this.set(0)},Ze.prototype.save=function(){var t=B.prototype.save.call(this);return t.size=this.size,t},Ze.prototype.draw=function(t,e){this.selectStyle(t,e),this.drawBox(t);var i=this.y;t.font='14px "Lucida Console", Monaco, monospace',t.textAlign="center",this.size>12?t.fillText(r.toHex(this.value,4),this.x,i):this.size>8?t.fillText(r.toHex(this.value,3),this.x,i):this.size>4?t.fillText(r.toHex(this.value,2),this.x,i):t.fillText(r.toBinary(this.value,this.size),this.x,i),i+=25,t.font="14px Times",t.fillText("counter",this.x,i),this.drawIO(t,e)},Ze.prototype.properties=function(t){var e=this,i=new C(this,t),n=i.uniqueId(),o='<div class="control1 center gap"><label for="'.concat(n,'">Size in bits: </label>\n<input class="number" type="text" name="').concat(n,'" id="').concat(n,'" value="').concat(this.size,'"></div>');i.extra(o,(function(){var t=parseInt(document.getElementById(n).value);return isNaN(t)||t<2||t>16?(document.getElementById(n).select(),"Must be an integer from 2 to 16"):null}),(function(){e.size=parseInt(document.getElementById(n).value),e.set(e.value)})),i.open()},Ze.paletteImage=function(){var t=new J(60,44);return t.box(16,32),t.io(8,-8,"e"),t.io(-8,-8,"w"),t.io(0,16,"s"),t.clock(0,-16,"n"),t.drawText("0000",0,2,"6px Times"),t.drawText("Counter",0,10,"4px Times"),t};var Qe=function(){B.call(this),Object.defineProperties(this,{height:{value:32},width:{value:96},outputSize:{value:16,writable:!0},arithmetic:{value:!1,writable:!0},shift:{value:0,writable:!0}}),this.addIn(-48,8,16).bus=!0,this.addOut(48,0,16).bus=!0};(Qe.prototype=Object.create(B.prototype)).constructor=Qe,Qe.prototype.prefix=null,Qe.type="Extend",Qe.label="Extend",Qe.desc="Bus Extend",Qe.description="<h2>Extend</h2><p>The Extend component extends a \nbus to a larger size. A common use is to extend an immediate value \nfrom an instruction to 16 or 32 bits.</p>\n<p>The output can be optionally shifted left by a fixed number of bits.</p>",Qe.order=311,Qe.help="extend",Qe.prototype.clone=function(){var t=new Qe;return t.copyFrom(this),t.outputSize=this.outputSize,t.arithmetic=this.arithmetic,t.shift=this.shift,t},Qe.prototype.compute=function(t){if(void 0!==t[0]){for(var e=[],i=0;i<this.shift;i++)e.push(0);for(var n=0,o=0;n<t[0].length&&i<this.outputSize;n++,i++)e.push(t[0][n]),o=t[0][n];for(;i<this.outputSize;i++)e.push(this.arithmetic?o:0);this.outs[0].set(e)}else this.outs[0].set(void 0)},Qe.prototype.draw=function(t,e){this.outlinePath(t),t.fillStyle="#ffffff",t.fill(),this.selectStyle(t,e),t.stroke(),t.font="14px Times",t.textAlign="center",t.fillText("Extend",this.x,this.y+10),this.drawIO(t,e)},Qe.prototype.outlinePath=function(t){var e=this.x-this.width/2-.5,i=this.x+this.width/2+.5,n=this.y-this.height/2-.5,o=this.y-.5,r=this.y+this.height/2+.5;t.beginPath(),t.moveTo(e,o),t.lineTo(e,r),t.lineTo(i,r),t.lineTo(i,n),t.lineTo(e,o)},Qe.prototype.save=function(){var t=B.prototype.save.call(this);return t.outputSize=this.outputSize,t.arithmetic=this.arithmetic,t.shift=this.shift,t},Qe.prototype.load=function(t){this.outputSize=t.outputSize,this.arithmetic=t.arithmetic,this.shift=t.shift,B.prototype.load.call(this,t)},Qe.prototype.properties=function(t){var e=this,i=new C(this,t),n=i.uniqueId(),o=i.uniqueId(),r=i.uniqueId(),s='<div class="control1 center gap">\n<label>Output size (bits): \n<input class="number" type="text" name="'.concat(n,'" id="').concat(n,'" value="').concat(this.outputSize,'" spellcheck="false" onfocus="this.select()">\n</label>\n</div>\n<div class="control1 center gap">\n<label>Output shift (bits): \n<input class="number" type="text" name="').concat(r,'" id="').concat(r,'" value="').concat(this.shift,'" spellcheck="false" onfocus="this.select()">\n</label>\n</div>\n<div class="control1 center gap">\n<label for="').concat(o,'"><input type="checkbox" id="').concat(o,'" name="').concat(o,'"').concat(this.arithmetic?" checked":"","> Arithmetic extend</label>\n</div>");i.extra(s,(function(){var t=document.getElementById(n).value,e=parseInt(t);if(isNaN(e)||e<1||e>32)return document.getElementById(n).select(),"Invalid output size, must be 1 to 32";document.getElementById(r).value;var i=parseInt(t);return isNaN(i)||i<0||i>e?(document.getElementById(r).select(),"Invalid shift size, must be 0 to the bit size."):null}),(function(){e.arithmetic=document.getElementById(o).checked;var t=document.getElementById(n).value;e.outputSize=parseInt(t);var i=document.getElementById(r).value;e.shift=parseInt(i),e.pending()})),i.open(),document.getElementById(n).select()},Qe.paletteImage=function(){var t=new J(60,44),e=t.width/2,i=t.height/2,n=e-20-.5,o=e+20+.5,r=i-8-.5,s=i,a=i+8+.5;return t.context.beginPath(),t.context.moveTo(n,s),t.context.lineTo(o,r),t.context.lineTo(o,a),t.context.lineTo(n,a),t.context.lineTo(n,s),t.fillStroke(),t.io(20,0,"e"),t.io(-20,4,"w"),t.drawText("Extend",0,7,"8px Times"),t};var Ke=function t(e){this.message=e,"captureStackTrace"in Error?Error.captureStackTrace(this,t):this.stack=(new Error).stack};function $e(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return ti(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return ti(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw r}}}}function ti(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}(Ke.prototype=Object.create(Error.prototype)).name="InvalidArgumentException",Ke.prototype.constructor=Ke;var ei=function t(e){var i=this;B.call(this,e);var n=16,o=void 0;this.draw=function(t,e){this.selectStyle(t,e);var i=this.x-this.width/2-.5,n=this.x+this.width/2+.5,o=this.y-this.height/2-.5,r=this.y+this.height/2+.5;if(t.beginPath(),t.moveTo(i,o),t.lineTo(i,this.y-7.5),t.lineTo(i+20,this.y),t.lineTo(i,this.y+7.5),t.lineTo(i,r),t.lineTo(n,r-15),t.lineTo(n,o+15),t.lineTo(i,o),null!==this.naming&&(t.font="14px Times",t.textAlign="center",t.fillText(this.naming,this.x,this.y-16)),this.operator.length>1)t.font="bold 14px Times",t.textAlign="center",t.fillText(this.operator,this.x+1,this.y+4);else{t.font="bold 22px Times",t.textAlign="center";var s=6;switch(this.operator){case"+":s=6;break;case"-":s=5}t.fillText(this.operator,this.x+1,this.y+s)}t.stroke(),this.drawIO(t,e)},this.clone=function(){var e=new t;return e.copyFrom(this),e.size=this.size,e.output=this.output,e.control=this.control,e},this.load=function(t){this.size=t.size,this.output=t.output,this.control=t.control,B.prototype.load.call(this,t)},this.save=function(){var t=B.prototype.save.call(this);return t.size=this.size,t.output=this.output,t.control=this.control,t},this.controlMapping=function(e){switch(this.control){case t.CONTROL.ASAO:switch(e&=3){case 0:e=11;break;case 1:e=17;break;case 2:e=0;break;case 3:e=12}}return e},function(){Object.defineProperties(i,{size:{get:function(){return n},set:function(t){if(![4,8,16,32].includes(+t))throw new Ke("Illegal size value "+t);n=+t}},height:{value:128},width:{value:64},output:{get:function(){return o},set:function(e){if(!t.OUTPUT.POSSIBLE.includes(+e))throw new Ke("Illegal output value "+e);if(o!==+e){o=+e;var i=this.outs[1];i.clear(),i.bus=o===t.OUTPUT.CPSR,i.name=t.OUTPUT.LABELS[o]}}},control:{value:t.CONTROL.THUMB,writable:!0}}),i.cin=!1;var e=-i.width/2,r=i.width/2;i.operator="";i.addIn(e,-32,16,"A").bus=!0,i.addIn(e,32,16,"B").bus=!0;var s=i.addIn(0,i.height/2-7.5,15.5,"C");s.orientation="s",s.bus=!0,i.addIn(e,48,16,"Cin"),i.addOut(r,0,16,"O").bus=!0,i.addOut(r,24,16,"CPSR").bus=!0,i.output=t.OUTPUT.CPSR}()};(ei.prototype=Object.create(B.prototype)).constructor=ei,ei.prototype.prefix="ALU",ei.prototype.nameRequired=!0,ei.type="Alu",ei.label="ALU",ei.desc="Arithmetic Logic Unit",ei.img="alu.png",ei.description="<h2>Arithmetic Logic Unit</h2><p>A and B are bus inputs \nto the ALU. C is the control input. Cin is the carry input for adc and sbc \noperations. O is a bus output result.</p>\n<p>If Cin is not connected, it is assumed to be false.</p>\n<p>The status bits in CPSR are: 0:N, 1:Z, 2:C, 3:V</p>",ei.help="alu",ei.order=707,ei.OUTPUT={CPSR:0,N:1,Z:2,C:3,V:4,POSSIBLE:[0,1,2,3,4],NAMES:["CPSR","N - Negative","Z - Zero","C - Carry","V - Overflow"],LABELS:["CPSR","N","Z","Cout","V"]},ei.CONTROL={THUMB:0,ASAO:1,POSSIBLE:[0,1],NAMES:["Thumb (4 or 6 bits)","Add/subtract/and/or"]},ei.prototype.compute=function(t){for(var e=t[0],i=t[1],n=t[2],o=this.size,r=o/8,s=0,a=0;a<r;a++)s<<=8,s|=255;var l=1<<o-1,c=l-1,h=-c-1;function u(t){if(void 0!==t&&Array.isArray(t)){var e,i=1,n=0,o=$e(t);try{for(o.s();!(e=o.n()).done;){var r=e.value;if(void 0===r)return;r&&(i===l?n-=i:n+=i),i*=2}}catch(t){o.e(t)}finally{o.f()}return n}}this.cin=void 0!==t[3]&&t[3];var d,p=u(e),f=u(i),v=f,m=!1,y=!1;switch(this.controlMapping(u(n))){case 8:case 0:v=p&f,this.operator="&";break;case 1:v=p^f,this.operator="xor";break;case 2:v=p<<f,this.operator="<<";break;case 3:v=(p&s)>>f,this.operator=">>";break;case 4:d=p&1<<o-1,v=p;for(var g=0;g<f;g++)v=p>>1,v|=d;this.operator="asr";break;case 5:v=p+f,this.cin&&v++,m=0!=((p&s)+(f&s)&1<<o),y=v<h||v>c,this.operator="+";break;case 11:case 34:case 16:m=0!=((p&s)+(f&s)&1<<o),y=(v=p+f)<h||v>c,this.operator="+";break;case 6:v=p-f,this.cin||v--,m=0!=((p&s)+(~f&s)+1&1<<o),y=v<h||v>c,this.operator="-";break;case 10:case 33:case 35:case 17:m=0!=((p&s)+(~f&s)+1&1<<o),y=(v=p-f)<h||v>c,this.operator="-";break;case 7:d=p&l,v=p&s;for(var b=0;b<f;b++){var w=(1&v)<<o-1;v=(p&s)>>1,v|=w}this.operator="ror";break;case 9:v=-f,this.operator="neg";break;case 12:v=p|f,this.operator="or";break;case 13:y=(v=p*f)<h||v>c,this.operator="*";break;case 14:v=p&(f^s),this.operator="bic";break;case 15:v=p^s,this.operator="not";break;case 18:v=(p&s)*(f&s)>>o,this.operator="*^";break;default:v=f,this.operator="mov"}var x=[];if(void 0===(v&=s)){for(var T=0;T<o;T++)x.push(void 0);this.output===ei.OUTPUT.CPSR?this.outs[1].set([void 0,void 0,void 0,void 0]):this.outs[1].set(void 0)}else{for(var I=v,S=0;S<o;S++)x.push(1==(1&I)),I>>=1;switch(this.output){case ei.OUTPUT.CPSR:this.outs[1].set([x[o-1],0===v,m,y]);break;case ei.OUTPUT.N:this.outs[1].set(x[o-1]);break;case ei.OUTPUT.Z:this.outs[1].set(0===v);break;case ei.OUTPUT.C:this.outs[1].set(m);break;case ei.OUTPUT.V:this.outs[1].set(y)}}this.outs[0].set(x)},ei.prototype.properties=function(t){for(var e=this,i=new C(this,t),n=i.uniqueId(),o=i.uniqueId(),r=i.uniqueId(),s='<div class="control-table"><div class="control">\n<label for="'.concat(n,'">Size:</label>\n<select name="').concat(n,'" id="').concat(n,'">'),a=0,l=[4,8,16,32];a<l.length;a++){var c=l[a],h=this.size===c?" selected":"";s+='<option value="'.concat(c,'"').concat(h,">").concat(c,"</option>")}s+='</select>\n</div>\n<div class="control">\n        <label>Secondary Output:</label>\n        <select class="auto" name="'.concat(o,'" id="').concat(o,'">');var u,d=$e(ei.OUTPUT.POSSIBLE);try{for(d.s();!(u=d.n()).done;){var p=u.value,f=this.output===p?" selected":"",v=ei.OUTPUT.NAMES[p];s+='<option value="'.concat(p,'"').concat(f,">").concat(v,"</option>")}}catch(t){d.e(t)}finally{d.f()}s+='</select>\n</div>\n<div class="control">\n<label>Control:</label>\n<select class="auto" name="'.concat(r,'" id="').concat(r,'">');var m,y=$e(ei.CONTROL.POSSIBLE);try{for(y.s();!(m=y.n()).done;){var g=m.value,b=this.control===g?" selected":"",w=ei.CONTROL.NAMES[g];s+='<option value="'.concat(g,'"').concat(b,">").concat(w,"</option>")}}catch(t){y.e(t)}finally{y.f()}s+="</select>\n</div></div>",i.extra(s,(function(){return null}),(function(){return e.size=document.getElementById(n).value,e.output=document.getElementById(o).value,null}),85),i.open()};var ii=function(){};ii.go=function(t){(document.attachEvent?"complete"===document.readyState:"loading"!==document.readyState)?t():document.addEventListener("DOMContentLoaded",t)};var ni=function(t,e){var n,o=this,r=i(23983);this.version=r.version,this.root=i.p,this.sel=t,this.options=new Zt(e),this.components=new Qt,(n=this.components).add(Kt),n.add($t),n.add(ce),n.add(he),n.add(te),n.add(re),n.add(se),n.add(ae),n.add(ee),n.add(ie),n.add(ne),n.add(oe),n.add(fe),n.add(de),n.add(Ie),n.add(pe),n.add(ue),n.add(Se),n.add(Le),n.add(je),n.add(Be),n.add(Ne),n.add(Pe),n.add(ve),n.add(ye),n.add(me),n.add(Ee),n.add(ze),n.add(ge),n.add(we),n.add(Qe),n.add(be),n.add(xe),n.add(De),n.add(Ze),n.add(He),n.add(Xe),n.add(Ae),n.add(Oe),n.add(Ce),n.add(Re),n.add(Ge),n.add(Ue),n.add(ke),n.add(We),n.add(Ye),n.add(Ve),n.add(Je),n.add(ei),n.add(_e),n.addPalette("combinatorial",[ee,te,de,fe,ae,oe]),n.addPalette("sequential",[Be,Ne,Pe,je,Le]),n.addPalette("bus",[ve,me,ge,we,be,xe]),n.addPalette("all",[Kt,$t,ce,he,ue,Ie,pe,Se,ee,ie,ne,oe,te,re,se,ae,Xe,de,fe,Be,Ne,Pe,je,Le,ve,me,ye,ge,be,we,Qe,xe,Ae,Oe,Ce,Ee,ze,De,Re,Ue,ke,We,Ve,Ge,He,ei,Ze]);var s=[],a=[];this.start=function(){if(null===t)return o.startNow();ii.go((function(){o.startNow()}))},this.startNow=function(){if(null===t){o.options.display="none";var e=new Jt(o,null,a);return s.push(e),e}if(t instanceof Element){var n=new Jt(o,t,a);s.push(n)}else for(var r=document.querySelectorAll(t),l=0;l<r.length;l++){var c=r[l],h=new Jt(o,c,a);s.push(h)}return 1===s.length?(null!==o.options.global&&(i.g[o.options.global]=s[0]),s[0]):null},this.getInstances=function(){return s},this.addTest=function(t){a.push(t)},this.runTest=function(t){s.forEach((function(e){e.runTest(t)}))}};i(21218);ni.Cirsim=ni,ii.go((function(){for(var t=document.querySelectorAll("div.cirsim-install"),e=0;e<t.length;e++){var i=t[e];i.classList.remove("cirsim-install");var n=JSON.parse(i.textContent);i.innerHTML="",new ni(i,n).startNow(),i.style.display="block"}})),i.g.Cirsim=ni;var oi=function(){};oi.create=function(t){function e(){for(var t=document.querySelectorAll("div.cirsim-install"),e=0;e<t.length;e++){var i=t[e],n=JSON.parse(i.textContent);i.innerHTML="",new ni(i,n).startNow(),i.style.display="block",i.classList.remove("cirsim-install")}}t.start((function(){e()})),t.messageListener((function(t,i){switch(t){case"cl-quiz-after-installed":case"cl-grades-grader-installed":e()}}))};oi.create(Site.Site)},42603:function(t,e){var i,n,o;n=[],void 0===(o="function"==typeof(i=function(){"use strict";var t={defaultCompare:function(t,e){return t<e?-1:t===e?0:1},defaultEquals:function(t,e){return t===e},defaultToString:function(e){return null===e?"BUCKETS_NULL":t.isUndefined(e)?"BUCKETS_UNDEFINED":t.isString(e)?e:e.toString()},isFunction:function(t){return"function"==typeof t},isUndefined:function(t){return void 0===t},isString:function(t){return"[object String]"===Object.prototype.toString.call(t)},reverseCompareFunction:function(e){return t.isFunction(e)?function(t,i){return-1*e(t,i)}:function(t,e){return t<e?1:t===e?0:-1}},compareToEquals:function(t){return function(e,i){return 0===t(e,i)}},arrays:{}};return t.arrays.indexOf=function(e,i,n){var o,r=n||t.defaultEquals,s=e.length;for(o=0;o<s;o+=1)if(r(e[o],i))return o;return-1},t.arrays.lastIndexOf=function(e,i,n){var o,r=n||t.defaultEquals;for(o=e.length-1;o>=0;o-=1)if(r(e[o],i))return o;return-1},t.arrays.contains=function(e,i,n){return t.arrays.indexOf(e,i,n)>=0},t.arrays.remove=function(e,i,n){var o=t.arrays.indexOf(e,i,n);return!(o<0||(e.splice(o,1),0))},t.arrays.frequency=function(e,i,n){var o,r=n||t.defaultEquals,s=e.length,a=0;for(o=0;o<s;o+=1)r(e[o],i)&&(a+=1);return a},t.arrays.equals=function(e,i,n){var o,r=n||t.defaultEquals,s=e.length;if(e.length!==i.length)return!1;for(o=0;o<s;o+=1)if(!r(e[o],i[o]))return!1;return!0},t.arrays.copy=function(t){return t.concat()},t.arrays.swap=function(t,e,i){var n;return!(e<0||e>=t.length||i<0||i>=t.length||(n=t[e],t[e]=t[i],t[i]=n,0))},t.arrays.forEach=function(t,e){var i,n=t.length;for(i=0;i<n;i+=1)if(!1===e(t[i]))return},t.Bag=function(e){var i={},n=e||t.defaultToString,o=new t.Dictionary(n),r=0;return i.add=function(e,n){var s;return(isNaN(n)||t.isUndefined(n))&&(n=1),!(t.isUndefined(e)||n<=0||(i.contains(e)?o.get(e).copies+=n:(s={value:e,copies:n},o.set(e,s)),r+=n,0))},i.count=function(t){return i.contains(t)?o.get(t).copies:0},i.contains=function(t){return o.containsKey(t)},i.remove=function(e,n){var s;return(isNaN(n)||t.isUndefined(n))&&(n=1),!(t.isUndefined(e)||n<=0||!i.contains(e)||(s=o.get(e),r-=n>s.copies?s.copies:n,s.copies-=n,s.copies<=0&&o.remove(e),0))},i.toArray=function(){var t,e,i,n,r,s=[],a=o.values(),l=a.length;for(n=0;n<l;n+=1)for(e=(t=a[n]).value,i=t.copies,r=0;r<i;r+=1)s.push(e);return s},i.toSet=function(){var e,i=new t.Set(n),r=o.values(),s=r.length;for(e=0;e<s;e+=1)i.add(r[e].value);return i},i.forEach=function(t){o.forEach((function(e,i){var n,o=i.value,r=i.copies;for(n=0;n<r;n+=1)if(!1===t(o))return!1;return!0}))},i.size=function(){return r},i.isEmpty=function(){return 0===r},i.clear=function(){r=0,o.clear()},i.equals=function(e){var n;return!t.isUndefined(e)&&"function"==typeof e.toSet&&i.size()===e.size()&&(n=!0,e.forEach((function(t){return n=i.count(t)===e.count(t)})),n)},i},t.BSTree=function(e){function i(t,e){for(var i,n=t;void 0!==n&&0!==i;)(i=s(e,n.element))<0?n=n.leftCh:i>0&&(n=n.rightCh);return n}function n(t){for(var e=t;void 0!==e.leftCh;)e=e.leftCh;return e}var o,r={},s=e||t.defaultCompare,a=0;return r.add=function(e){function i(t){for(var e,i,n=o;void 0!==n;){if(0===(i=s(t.element,n.element)))return;i<0?(e=n,n=n.leftCh):(e=n,n=n.rightCh)}return t.parent=e,void 0===e?o=t:s(t.element,e.element)<0?e.leftCh=t:e.rightCh=t,t}return!t.isUndefined(e)&&void 0!==i({element:e,leftCh:void 0,rightCh:void 0,parent:void 0})&&(a+=1,!0)},r.clear=function(){o=void 0,a=0},r.isEmpty=function(){return 0===a},r.size=function(){return a},r.contains=function(e){return!t.isUndefined(e)&&void 0!==i(o,e)},r.remove=function(t){function e(t,e){void 0===t.parent?o=e:t===t.parent.leftCh?t.parent.leftCh=e:t.parent.rightCh=e,void 0!==e&&(e.parent=t.parent)}function r(t){if(void 0===t.leftCh)e(t,t.rightCh);else if(void 0===t.rightCh)e(t,t.leftCh);else{var i=n(t.rightCh);i.parent!==t&&(e(i,i.rightCh),i.rightCh=t.rightCh,i.rightCh.parent=i),e(t,i),i.leftCh=t.leftCh,i.leftCh.parent=i}}var s;return void 0!==(s=i(o,t))&&(r(s),a-=1,!0)},r.inorderTraversal=function(t){function e(t,i,n){void 0===t||n.stop||(e(t.leftCh,i,n),n.stop||(n.stop=!1===i(t.element),n.stop||e(t.rightCh,i,n)))}e(o,t,{stop:!1})},r.preorderTraversal=function(t){function e(t,i,n){void 0===t||n.stop||(n.stop=!1===i(t.element),n.stop||(e(t.leftCh,i,n),n.stop||e(t.rightCh,i,n)))}e(o,t,{stop:!1})},r.postorderTraversal=function(t){function e(t,i,n){void 0===t||n.stop||(e(t.leftCh,i,n),n.stop||(e(t.rightCh,i,n),n.stop||(n.stop=!1===i(t.element))))}e(o,t,{stop:!1})},r.levelTraversal=function(e){function i(e,i){var n=t.Queue();for(void 0!==e&&n.enqueue(e);!n.isEmpty();){if(!1===i((e=n.dequeue()).element))return;void 0!==e.leftCh&&n.enqueue(e.leftCh),void 0!==e.rightCh&&n.enqueue(e.rightCh)}}i(o,e)},r.minimum=function(){if(!r.isEmpty())return n(o).element},r.maximum=function(){function t(t){for(;void 0!==t.rightCh;)t=t.rightCh;return t}if(!r.isEmpty())return t(o).element},r.forEach=function(t){r.inorderTraversal(t)},r.toArray=function(){var t=[];return r.inorderTraversal((function(e){t.push(e)})),t},r.height=function(){function t(e){return void 0===e?-1:Math.max(t(e.leftCh),t(e.rightCh))+1}function e(e){return void 0===e?-1:Math.max(t(e.leftCh),t(e.rightCh))+1}return e(o)},r.equals=function(e){var i;return!t.isUndefined(e)&&"function"==typeof e.levelTraversal&&r.size()===e.size()&&(i=!0,e.forEach((function(t){return i=r.contains(t)})),i)},r},t.Dictionary=function(e){var i={},n={},o=0,r=e||t.defaultToString,s="/$ ";return i.get=function(e){var i=n[s+r(e)];if(!t.isUndefined(i))return i.value},i.set=function(e,i){var a,l,c;if(!t.isUndefined(e)&&!t.isUndefined(i))return l=s+r(e),c=n[l],t.isUndefined(c)?(o+=1,a=void 0):a=c.value,n[l]={key:e,value:i},a},i.remove=function(e){var i=s+r(e),a=n[i];if(!t.isUndefined(a))return delete n[i],o-=1,a.value},i.keys=function(){var t,e=[];for(t in n)Object.prototype.hasOwnProperty.call(n,t)&&e.push(n[t].key);return e},i.values=function(){var t,e=[];for(t in n)Object.prototype.hasOwnProperty.call(n,t)&&e.push(n[t].value);return e},i.forEach=function(t){var e,i;for(e in n)if(Object.prototype.hasOwnProperty.call(n,e)&&!1===t((i=n[e]).key,i.value))return},i.containsKey=function(e){return!t.isUndefined(i.get(e))},i.clear=function(){n={},o=0},i.size=function(){return o},i.isEmpty=function(){return o<=0},i.equals=function(e,n){var o,r;return!t.isUndefined(e)&&"function"==typeof e.keys&&i.size()===e.size()&&(o=n||t.defaultEquals,r=!0,e.forEach((function(t,e){return r=o(i.get(t),e)})),r)},i},t.Heap=function(e){function i(e){function i(t){return Math.floor((t-1)/2)}var n;for(n=i(e);e>0&&s(r[n],r[e])>0;)t.arrays.swap(r,n,e),n=i(e=n)}function n(e){function i(t){return 2*t+1}function n(t){return 2*t+2}function o(t,e){return e>=r.length?t>=r.length?-1:t:s(r[t],r[e])<=0?t:e}var a;for(a=o(i(e),n(e));a>=0&&s(r[e],r[a])>0;)t.arrays.swap(r,a,e),a=o(i(e=a),n(e))}var o={},r=[],s=e||t.defaultCompare;return o.peek=function(){if(r.length>0)return r[0]},o.add=function(e){if(!t.isUndefined(e))return r.push(e),i(r.length-1),!0},o.removeRoot=function(){var t;if(r.length>0)return t=r[0],r[0]=r[r.length-1],r.splice(r.length-1,1),r.length>0&&n(0),t},o.contains=function(e){var i=t.compareToEquals(s);return t.arrays.contains(r,e,i)},o.size=function(){return r.length},o.isEmpty=function(){return r.length<=0},o.clear=function(){r.length=0},o.forEach=function(e){t.arrays.forEach(r,e)},o.toArray=function(){return t.arrays.copy(r)},o.equals=function(e){var i,n,r;return!t.isUndefined(e)&&"function"==typeof e.removeRoot&&o.size()===e.size()&&(i=o.toArray(),n=e.toArray(),r=t.compareToEquals(s),i.sort(s),n.sort(s),t.arrays.equals(i,n,r))},o},t.LinkedList=function(){function e(t){var e,o;if(!(t<0||t>=r)){if(t===r-1)return n;for(e=i,o=0;o<t;o+=1)e=e.next;return e}}var i,n,o={},r=0;return o.add=function(o,s){var a,l;return t.isUndefined(s)&&(s=r),!(s<0||s>r||t.isUndefined(o)||(a={element:o,next:void 0},0===r?(i=a,n=a):s===r?(n.next=a,n=a):0===s?(a.next=i,i=a):(l=e(s-1),a.next=l.next,l.next=a),r+=1,0))},o.first=function(){if(void 0!==i)return i.element},o.last=function(){if(void 0!==n)return n.element},o.elementAtIndex=function(t){var i=e(t);if(void 0!==i)return i.element},o.indexOf=function(e,n){var o=n||t.defaultEquals,r=i,s=0;if(t.isUndefined(e))return-1;for(;void 0!==r;){if(o(r.element,e))return s;s+=1,r=r.next}return-1},o.contains=function(t,e){return o.indexOf(t,e)>=0},o.remove=function(e,o){var s,a=o||t.defaultEquals,l=i;if(r<1||t.isUndefined(e))return!1;for(;void 0!==l;){if(a(l.element,e))return l===i?(i=i.next,l===n&&(n=void 0)):l===n?(n=s,s.next=l.next,l.next=void 0):(s.next=l.next,l.next=void 0),r-=1,!0;s=l,l=l.next}return!1},o.clear=function(){i=void 0,n=void 0,r=0},o.equals=function(e,n){var r=n||t.defaultEquals,s=!0,a=i;return!t.isUndefined(e)&&"function"==typeof e.elementAtIndex&&o.size()===e.size()&&(e.forEach((function(t){return s=r(t,a.element),a=a.next,s})),s)},o.removeElementAtIndex=function(t){var o,s;if(!(t<0||t>=r))return 1===r?(o=i.element,i=void 0,n=void 0):(void 0===(s=e(t-1))?(o=i.element,i=i.next):s.next===n&&(o=n.element,n=s),void 0!==s&&(o=s.next.element,s.next=s.next.next)),r-=1,o},o.forEach=function(t){for(var e=i;void 0!==e&&!1!==t(e.element);)e=e.next},o.reverse=function(){for(var t,e,o=i;void 0!==o;)e=o.next,o.next=t,t=o,o=e;e=i,i=n,n=e},o.toArray=function(){var t=[];return o.forEach((function(e){t.push(e)})),t},o.size=function(){return r},o.isEmpty=function(){return r<=0},o},t.MultiDictionary=function(e,i){var n={},o=new t.Dictionary(e),r=i||t.defaultEquals;return n.get=function(e){var i=o.get(e);return t.isUndefined(i)?[]:t.arrays.copy(i)},n.set=function(e,i){var s;return!(t.isUndefined(e)||t.isUndefined(i)||(n.containsKey(e)?(s=o.get(e),t.arrays.contains(s,i,r)||(s.push(i),0)):(o.set(e,[i]),0)))},n.remove=function(e,i){var n,s;return t.isUndefined(i)?(n=o.remove(e),!t.isUndefined(n)):(s=o.get(e),!!t.arrays.remove(s,i,r)&&(0===s.length&&o.remove(e),!0))},n.keys=function(){return o.keys()},n.values=function(){var t,e,i,n=o.values(),r=[];for(t=0;t<n.length;t+=1)for(i=n[t],e=0;e<i.length;e+=1)r.push(i[e]);return r},n.containsKey=function(t){return o.containsKey(t)},n.clear=function(){return o.clear()},n.size=function(){return o.size()},n.isEmpty=function(){return o.isEmpty()},n.forEach=function(t){return o.forEach(t)},n.equals=function(e){var i,o=!0;return!t.isUndefined(e)&&"function"==typeof e.values&&n.size()===e.size()&&(e.forEach((function(e,s){return(i=n.get(e)||[]).length!==s.length?o=!1:t.arrays.forEach(i,(function(e){return o=t.arrays.contains(s,e,r)})),o})),o)},n},t.PriorityQueue=function(e){var i={},n=t.reverseCompareFunction(e),o=new t.Heap(n);return i.enqueue=function(t){return o.add(t)},i.add=function(t){return o.add(t)},i.dequeue=function(){var t;if(0!==o.size())return t=o.peek(),o.removeRoot(),t},i.peek=function(){return o.peek()},i.contains=function(t){return o.contains(t)},i.isEmpty=function(){return o.isEmpty()},i.size=function(){return o.size()},i.clear=function(){o.clear()},i.forEach=function(t){o.forEach(t)},i.toArray=function(){return o.toArray()},i.equals=function(e){var o,r,s;return!t.isUndefined(e)&&"function"==typeof e.dequeue&&i.size()===e.size()&&(o=i.toArray(),r=e.toArray(),s=t.compareToEquals(n),o.sort(n),r.sort(n),t.arrays.equals(o,r,s))},i},t.Queue=function(){var e={},i=new t.LinkedList;return e.enqueue=function(t){return i.add(t)},e.add=function(t){return i.add(t)},e.dequeue=function(){var t;if(0!==i.size())return t=i.first(),i.removeElementAtIndex(0),t},e.peek=function(){if(0!==i.size())return i.first()},e.size=function(){return i.size()},e.contains=function(t,e){return i.contains(t,e)},e.isEmpty=function(){return i.size()<=0},e.clear=function(){i.clear()},e.forEach=function(t){i.forEach(t)},e.toArray=function(){return i.toArray()},e.equals=function(i,n){var o,r,s;return!t.isUndefined(i)&&"function"==typeof i.dequeue&&e.size()===i.size()&&(o=n||t.defaultEquals,r=!0,i.forEach((function(t){return s=e.dequeue(),e.enqueue(s),r=o(s,t)})),r)},e},t.Set=function(e){var i={},n=new t.Dictionary(e);return i.contains=function(t){return n.containsKey(t)},i.add=function(e){return!i.contains(e)&&!t.isUndefined(e)&&(n.set(e,e),!0)},i.intersection=function(t){i.forEach((function(e){t.contains(e)||i.remove(e)}))},i.union=function(t){t.forEach((function(t){i.add(t)}))},i.difference=function(t){t.forEach((function(t){i.remove(t)}))},i.isSubsetOf=function(t){var e=!0;return!(i.size()>t.size())&&(i.forEach((function(i){if(!t.contains(i))return e=!1,!1})),e)},i.remove=function(t){return!!i.contains(t)&&(n.remove(t),!0)},i.forEach=function(t){n.forEach((function(e,i){return t(i)}))},i.toArray=function(){return n.values()},i.isEmpty=function(){return n.isEmpty()},i.size=function(){return n.size()},i.clear=function(){n.clear()},i.equals=function(e){var n;return!t.isUndefined(e)&&"function"==typeof e.isSubsetOf&&i.size()===e.size()&&(n=!0,e.forEach((function(t){return n=i.contains(t)})),n)},i},t.Stack=function(){var e={},i=new t.LinkedList;return e.push=function(t){return i.add(t,0)},e.add=function(t){return i.add(t,0)},e.pop=function(){return i.removeElementAtIndex(0)},e.peek=function(){return i.first()},e.size=function(){return i.size()},e.contains=function(t,e){return i.contains(t,e)},e.isEmpty=function(){return i.isEmpty()},e.clear=function(){i.clear()},e.forEach=function(t){i.forEach(t)},e.toArray=function(){return i.toArray()},e.equals=function(n,o){var r,s,a;return!t.isUndefined(n)&&"function"==typeof n.peek&&e.size()===n.size()&&(r=o||t.defaultEquals,s=!0,n.forEach((function(t){return a=e.pop(),i.add(a),s=r(a,t)})),s)},e},t})?i.apply(e,n):i)||(t.exports=o)},34358:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>h});var n=i(23645),o=i.n(n),r=i(61667),s=i.n(r),a=i(44345),l=o()((function(t){return t[1]})),c=s()(a.Z);l.push([t.id,'div.cirsim div.toast{position:absolute;bottom:0;visibility:hidden;transform:translateY(2.3em);z-index:400;transition:all .4s ease-in-out 0s,visibility 0s linear .4s,z-index 0s linear 0.01s;font-family:"Helvetica Neue", Helvetica, Arial, sans-serif;font-size:1.1em;left:calc(50% - 30em/2);width:30em;background-color:#151515;color:#fff;text-align:center;border-top-left-radius:10px;border-top-right-radius:10px;padding:0.5em}div.cirsim div.toast.toast-active{visibility:visible;transform:translateY(0%);transition-delay:0s,0s,.4s;z-index:400}div.cirsim nav.menubar{position:relative;z-index:100;margin:0;border:0;padding:0;background-color:#f0f3f0;border-bottom:thin solid #808080;font-size:.9rem}div.cirsim nav.menubar li:hover{background:#00796B}div.cirsim nav.menubar li{user-select:none;cursor:pointer}div.cirsim nav.menubar li a,div.cirsim nav.menubar li a:link,div.cirsim nav.menubar li a:visited{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:.9rem;color:#000;text-decoration:none}div.cirsim nav.menubar>ul{list-style-type:none;margin:0;border:0;padding:0}div.cirsim nav.menubar>ul img.check{vertical-align:baseline;width:19px;height:16px;content:url('+c+')}div.cirsim nav.menubar>ul>li{display:inline-block;margin:0;border:0;padding:0.25em 2em 0.25em 0.5em;position:relative}div.cirsim nav.menubar>ul>li a,div.cirsim nav.menubar>ul>li a:link,div.cirsim nav.menubar>ul>li a:visited{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:.9rem;color:#000;text-decoration:none}div.cirsim nav.menubar>ul ul{visibility:hidden;opacity:0;transform:translateY(-2em);z-index:-1;transition:all 0.2s ease-in-out 0s, visibility 0s linear 0.2s, z-index 0s linear 0.01s;list-style-type:none;position:absolute;overflow:hidden;left:0;top:100%;margin:1px 0 0 0;background-color:#f0f3f0;padding:0;border:1px solid gray;border-top-width:0}div.cirsim nav.menubar>ul ul>li{padding:0 5px;margin:0;overflow:hidden}div.cirsim nav.menubar>ul ul>li a{display:inline-block;width:8em;padding-top:5px;padding-bottom:5px}div.cirsim nav.menubar>ul ul>li.menu-disabled a{opacity:0.3}div.cirsim nav.menubar>ul ul.menu-open{visibility:visible;opacity:1;z-index:100;transform:translateY(0%);transition-delay:0s, 0s, 0.2s}div.cirsim nav.menubar>ul ul.edit-menu a{width:6em}div.cirsim nav.menubar>ul ul.option-menu a{width:11em}div.cirsim nav.menubar>ul ul.help-menu a{width:7.5em}div.cirsim nav.menubar>ul .ul-state-active{color:red}div.cirsim nav.menubar>ul li.menu-divider{height:1px;border:0 solid #000;border-top-width:1px}div.cirsim div.cs-palette{position:absolute;left:0;top:0;bottom:0;box-sizing:border-box;width:83px;background:white;border-right:1px solid black;padding:1em 5px;z-index:5;overflow-y:scroll;overflow-x:hidden;cursor:pointer;-moz-user-select:-moz-none;-webkit-user-select:none;-ms-user-select:none;user-select:none}div.cirsim div.cs-palette div.cs-item{position:relative;min-height:60px;border-bottom:thin solid #dddddd;align-items:center;display:flex}div.cirsim div.cs-palette div.cs-item div.cs-box{vertical-align:middle;margin:0;padding:0;-moz-box-shadow:none;-webkit-box-shadow:none;box-shadow:none}div.cirsim div.cs-palette div.cs-item div.cs-box div.cs-img{margin:0;padding:0;border:0;line-height:0}div.cirsim div.cs-palette div.cs-item div.cs-box img{-moz-box-shadow:none;-webkit-box-shadow:none;box-shadow:none;border:0;margin:0}div.cirsim div.cs-palette div.cs-item div.cs-box div.cs-desc{display:block;font-style:normal;font-weight:bold;padding:0;margin:0;text-align:center;font-size:0.80em}div.cirsim div.cs-palette div.cs-item div.cs-box div.long{font-size:0.65em}div.cirsim div.cs-palette figure{position:relative;top:50%;transform:translateY(-50%);margin:0;padding:0;-moz-box-shadow:none;-webkit-box-shadow:none;box-shadow:none;border-bottom:thin solid #dddddd}div.cirsim div.cs-palette figure img{-moz-box-shadow:none;-webkit-box-shadow:none;box-shadow:none;border:0;margin:0}div.cirsim div.cs-palette figure figcaption{font-style:normal;font-weight:bold;padding:0;margin:0;text-align:center}div.cirsim div.cs-palette figure figcaption.long{font-size:0.65em}.cirsim-dialog-titlebar{position:absolute;top:50%;width:20px;margin:-10px 0 0 0;padding:1px;height:20px}.cirsim-home{right:calc(0.6em + 20px)}.cirsim-back{right:calc(0.9em + 40px)}.cirsim-help{position:relative;width:100%;max-width:100%;padding:0.5em}.cirsim-help p:first-child{margin-top:0}.cirsim-help figure{text-align:center;overflow-x:auto;margin:1em 0}.cirsim-help figure img{box-shadow:none;border:0;padding:0;margin:0}.cirsim .help-div{padding:0;border-left:1px solid #aaa;border-right:1px solid #aaa;background-color:white}.cirsim .help-div div.header{box-sizing:border-box;font-family:"Helvetica Neue", Helvetica, Arial, sans-serif;font-weight:bold;background-color:#009688;color:black;width:100%;padding:0;margin:0;border:0;z-index:20;height:25px;display:flex;flex-direction:row;flex-wrap:nowrap}.cirsim .help-div div.header h1{flex-grow:1;margin:0;padding:4px 4px 0 10px;font-family:"Trebuchet MS", Helvetica, sans-serif;font-size:16px;line-height:16px;user-select:none}.cirsim .help-div div.header button{box-size:border-box;flex:0 0 25px;width:25px;height:25px;padding:0;margin:0;border:0;background:none;outline:none}.cirsim .help-div div.header button:hover{background-color:#e81123;cursor:pointer}div.cirsim div.work{position:absolute;width:100%;left:0;top:1.53em;right:0;bottom:0;background:black}div.cirsim-install{display:none}div.cirsim .cirsim-overlay{position:absolute;left:0;right:0;top:0;bottom:0;background:#a00;opacity:0.05;z-index:2000;display:none}div.cirsim div.main{line-height:normal;font-size:1rem;position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden}div.cirsim div.help-div{line-height:normal;font-size:1rem;display:none}div.cirsim.docked-help .main{position:absolute;top:0;left:0;right:325px;bottom:0}div.cirsim.docked-help .help-div{display:block;box-sizing:border-box;position:absolute;top:0;bottom:0;right:0;width:325px;overflow:auto}div.cirsim-full{position:absolute;left:0;right:0;top:0;bottom:0;background:white}div.cirsim-inline{position:relative;margin:0;border:0;padding:0;background:white;overflow:hidden}div.cirsim-inline div{text-align:center}div.cirsim-inline canvas{margin:0 auto}div.cirsim-window{position:relative;width:100%;height:600px;margin:0;border-left:0;border-right:0;padding:0;border-top:thin solid #aaa;background:white;min-height:100px;min-width:800px}div.cirsim.height300{height:300px}div.cirsim div.cirsim-dlg-content{position:relative;padding:0.5em;font-size:0.95em}div.cirsim div.cirsim-dlg-content input{padding:3px;box-sizing:border-box;font-size:1.1em}div.cirsim div.cirsim-dlg-content h2{margin:0.75em 0}div.cirsim div.cirsim-dlg-content form{position:relative;height:100%}div.cirsim div.cirsim-dlg-content .large{font-size:1.2em}div.cirsim div.cirsim-dlg-content fieldset{position:relative;border:0;margin:0;padding:0;height:100%;min-width:0;max-width:100%}div.cirsim div.cirsim-dlg-content p.error{margin:1em 0 0 0;text-align:center;color:red;font-size:0.9em;font-style:italic}div.cirsim div.cirsim-dlg-content div.control{position:relative;margin:0 0 1em 0}div.cirsim div.cirsim-dlg-content div.control div.left{text-align:left}div.cirsim div.cirsim-dlg-content div.control label{display:block;font-style:italic;margin:0.2em 0 0.1em 0}div.cirsim div.cirsim-dlg-content div.control input{display:block}div.cirsim div.cirsim-dlg-content div.control input[type=text],div.cirsim div.cirsim-dlg-content div.control input[type=file]{width:100%}div.cirsim div.cirsim-dlg-content div.control input[type=radio]{display:inline-block}div.cirsim div.cirsim-dlg-content div.control input[type=range]{width:100%}div.cirsim div.cirsim-dlg-content div.control p.selector{text-align:center}div.cirsim div.cirsim-dlg-content div.control select{width:6em}div.cirsim div.cirsim-dlg-content div.control select.auto{width:auto}div.cirsim div.cirsim-dlg-content div.control select.files{width:100%}div.cirsim div.cirsim-dlg-content div.control div.notice{position:absolute;width:100%;left:0;top:45%;text-align:center;font-style:italic;color:saddlebrown}div.cirsim div.cirsim-dlg-content div.control textarea{width:100%}div.cirsim div.cirsim-dlg-content div.control div.choosers{display:inline-block;text-align:left}div.cirsim div.cirsim-dlg-content div.control1{margin:0 0 1em 0}div.cirsim div.cirsim-dlg-content div.control1 label{display:inline-block;font-style:italic;padding-right:0.5em}div.cirsim div.cirsim-dlg-content div.control1 select{width:6em}div.cirsim div.cirsim-dlg-content div.control1 input.number{width:2em;text-align:center}div.cirsim div.cirsim-dlg-content div.control1 input.compname{width:4em}div.cirsim div.cirsim-dlg-content div.control1 input.tabname{width:6em}div.cirsim div.cirsim-dlg-content div.control1 select.auto{width:auto}div.cirsim div.cirsim-dlg-content div.control-table{margin:0 auto;display:table}div.cirsim div.cirsim-dlg-content div.control-table div.control{display:table-row;height:2em}div.cirsim div.cirsim-dlg-content div.control-table div.control label{display:table-cell;text-align:right;padding-right:0.5em}div.cirsim div.cirsim-dlg-content div.control-table div.control select{display:table-cell}div.cirsim div.cirsim-dlg-content div.center{text-align:center}div.cirsim div.cirsim-dlg-content div.indent{margin-left:20px;margin-right:20px}div.cirsim div.cirsim-dlg-content h1{margin:0 0 0.5em 0}div.cirsim div.cirsim-dlg-content p,div.cirsim div.cirsim-dlg-content li{color:#606060}div.cirsim div.cirsim-dlg-content .gap{margin-top:1em}div.cirsim.about{width:400px;text-align:center}div.cirsim.about img{width:171px;height:75px}div.cirsim.about div.cirsim-dlg-content{padding:1em}div.cirsim.about figure img{box-shadow:none}div.cirsim.help{width:500px;height:600px}div.cirsim.component a.helper{display:block;position:absolute;right:0.5em;top:0.5em;float:right;color:#606060;font-style:italic;text-decoration:underline;cursor:pointer;font-size:0.85em;padding:0}div.cirsim .cirsim-error{color:red}div.cirsim-dialog{padding:1em;font-size:0.95em}div.cirsim table{margin-left:auto;margin-right:auto;border-collapse:separate;border-spacing:0;font-size:0.9em}div.cirsim table th{color:white;background:#18453B;background:linear-gradient(#18453B, #73d189);text-shadow:rgba(0,0,0,0.4) 0 1px 0;border-right:1px solid #C1DAD7;border-bottom:1px solid #C1DAD7;border-top:1px solid #C1DAD7;letter-spacing:1px;text-align:left;padding:2px 6px;font-family:Helvetica, Arial, sans-serif;text-decoration:none;vertical-align:bottom}div.cirsim table th a:link{color:#F5F3EB}div.cirsim table th a:visited{color:#E3DCC5}div.cirsim table th a:hover{color:#ffffff}div.cirsim table th.width40{width:20%}div.cirsim table th.width40em{width:40em}div.cirsim table th.width20em{width:20em}div.cirsim table td{border-right:1px solid #C1DAD7;border-bottom:1px solid #C1DAD7;background:#ffffff;padding:0.25em 0.75em;color:#4f6b72}div.cirsim table td a,div.cirsim table td a:link,div.cirsim table td a:visited,div.cirsim table td a:hover{text-decoration:underline}div.cirsim table td a:link{color:#8A8A8A}div.cirsim table td a:visited{color:#B09D5B}div.cirsim table td a:hover{color:#3366cc}div.cirsim table.center td,div.cirsim table.center th{text-align:center}div.cirsim table.truth-table th{color:black;background:white;text-shadow:none;border:none;border-bottom:1px solid black;text-align:center}div.cirsim table.truth-table td{border:0}div.cirsim table.truth-table th:last-child,div.cirsim table.truth-table td:last-child{border-left:thin solid black}div.cirsim div.tabs{position:absolute;left:83px;top:0;bottom:0;right:0;font-size:.8rem;padding:0;background:#ddd;border:0}div.cirsim div.tabs>ul{margin:0;padding:3px 0 0 2px;background:transparent;border:0;list-style:none}div.cirsim div.tabs>ul>li{position:relative;display:inline-block;font-size:.8rem;padding:0.25em 1em 0.45em 1em;min-width:6em;text-align:center;cursor:pointer;background:#ccc;border:1px solid black;border-bottom:none;border-radius:5px 5px 0 0;margin:1px 3px -1px 0;white-space:nowrap;z-index:18}div.cirsim div.tabs>ul>li a{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;text-decoration:none;color:#000;outline:0;user-select:none}div.cirsim div.tabs>ul>li.selected{background:#fff;z-index:22}div.cirsim div.tabs>ul>li.selected a{color:#000}div.cirsim div.tabs div.tab{position:absolute;display:none;left:0;top:29px;right:0;bottom:0;z-index:20;overflow:auto}div.cirsim div.tabs div.tab canvas{position:absolute;top:0;left:0;width:500px;height:500px;cursor:pointer}div.cirsim div.tabs div.tab.selected{display:block;background:white;border-top:1px solid black}div.cirsim-test-result p.cs-result{text-align:center;color:black}div.cirsim-test-result p.cs-info{text-align:center;font-size:0.9em;font-style:italic}\n',""]);const h=l},36234:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>r});var n=i(23645),o=i.n(n)()((function(t){return t[1]}));o.push([t.id,"div.cl-cirsim{display:none}div.cl-cirsim-gap-before,div.cl-cirsim-gap-after{margin-top:0;margin-bottom:0;height:1px}div.cl-cirsim-gap-after{height:1em}\n",""]);const r=o},21218:(t,e,i)=>{"use strict";var n=i(93379),o=i.n(n),r=i(34358),s={insert:"head",singleton:!1},a=o()(r.default,s);if(!r.default.locals||t.hot.invalidate){var l=r.default.locals;t.hot.accept(34358,(e=>{r=i(34358),function(t,e,i){if(!t&&e||t&&!e)return!1;var n;for(n in t)if((!i||"default"!==n)&&t[n]!==e[n])return!1;for(n in e)if(!(i&&"default"===n||t[n]))return!1;return!0}(l,r.default.locals,void 0)?(l=r.default.locals,a(r.default)):t.hot.invalidate()}))}t.hot.dispose((function(){a()}));r.default.locals},72590:(t,e,i)=>{"use strict";var n=i(93379),o=i.n(n),r=i(36234),s={insert:"head",singleton:!1},a=o()(r.default,s);if(!r.default.locals||t.hot.invalidate){var l=r.default.locals;t.hot.accept(36234,(e=>{r=i(36234),function(t,e,i){if(!t&&e||t&&!e)return!1;var n;for(n in t)if((!i||"default"!==n)&&t[n]!==e[n])return!1;for(n in e)if(!(i&&"default"===n||t[n]))return!1;return!0}(l,r.default.locals,void 0)?(l=r.default.locals,a(r.default)):t.hot.invalidate()}))}t.hot.dispose((function(){a()}));r.default.locals},44345:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});const n="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAAOCAYAAADNGCeJAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+nhxg7wAAAVdJREFUOI2V0bFrU1EUB+DvRWNsIJNQu6t1E8ykuDgKBQlIFwdHkQ7+AwU7url0FMQ5cXFwsoMguIhSqoPtJA51EHGohedQfg55SV9jaeKFw71wDt89hyOJesx60u83srR0LlwKvdArJoGiKKZDq6vzBoOunZ1ruIgfGPwXlm73lIODW7a3l5XlIn7hNfrYNcuY2duTXm8uPAgfQj/cD4uhGQRTsezvy8pKJzwMX8KzcCGcHiGHGHPhSlgIRZrNVjY3h1BZytpap+roU3ga5v9Bxj8PkRdhN7wLd8LltNvtrK93wt3wMQzC+WORGiYU4XrYCl8r9F64HTbC+3CzqjseqmGjOBOehO/hW3hZ4Y9D60RovICjYCM8Cj8r9HO4OhUaY6M4BFvhTfgd3oaz49zE9uvRmJBHrz/YQInn1V3Pz9DZ0Q674VW17aldJTmhYDjajVmhJP4Cy1ZU6+dCg3AAAAAASUVORK5CYII="},23983:t=>{"use strict";t.exports=JSON.parse('{"name":"cirsim","version":"2.1.15","description":"Cirsim Circuit Simulator","main":"dist/cirsim.min.js","module":"index.js","private":false,"scripts":{"build:dev":"npx webpack --config webpack.dev.js","build:prod":"npx webpack --config webpack.prod.js","build:all":"npm run build:dev && npm run build:prod","test":"karma start karma.conf.js","serve":"webpack serve --config webpack.dev.js --open","build:docs":"documentation build src/Cirsim/**/*.js --sort-order source -f html -o doc/js"},"keywords":["Education","Circuits","Computer Architecture"],"author":"Charles B. Owen","license":"MIT","devDependencies":{"@babel/core":"^7.12.10","@babel/plugin-transform-runtime":"^7.12.10","@babel/preset-env":"^7.12.11","@babel/runtime":"7.14.0","babel-loader":"^8.2.2","clean-webpack-plugin":"^4.0.0-alpha.0","copy-webpack-plugin":"^8.1.1","css-loader":"^5.2.4","file-loader":"^6.2.0","html-webpack-plugin":"^5.3.1","html-webpack-tags-plugin":"^3.0.1","jasmine-core":"^3.6.0","karma":"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-jasmine":"^4.0.1","karma-jasmine-html-reporter":"^1.5.4","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^5.0.0","node-sass":"^6.0.0","optimize-css-assets-webpack-plugin":"^5.0.4","resolve-url-loader":"^4.0.0","sass-loader":"^11.1.0","style-loader":"^2.0.0","terser-webpack-plugin":"^5.1.1","webpack":"^5.37.0","webpack-cli":"^4.7.0","webpack-dev-server":"^3.11.2","webpack-merge":"^5.7.3"},"dependencies":{"buckets-js":"^1.98.2","dialog-cl":"^1.0.4","dompurify":">=2.0.17","icons-cl":"~1.1.2","promise-polyfill":"^8.2.0","resizer-cl":"^2.4.0"}}')}},o={};function r(t){var e=o[t];if(void 0!==e){if(void 0!==e.error)throw e.error;return e.exports}var i=o[t]={id:t,loaded:!1,exports:{}};try{var s={id:t,module:i,factory:n[t],require:r};r.i.forEach((function(t){t(s)})),i=s.module,s.factory.call(i.exports,i,i.exports,s.require)}catch(t){throw i.error=t,t}return i.loaded=!0,i.exports}r.m=n,r.c=o,r.i=[],r.amdO={},t=[],r.O=(e,i,n,o)=>{if(!i){var s=1/0;for(c=0;c<t.length;c++){for(var[i,n,o]=t[c],a=!0,l=0;l<i.length;l++)(!1&o||s>=o)&&Object.keys(r.O).every((t=>r.O[t](i[l])))?i.splice(l--,1):(a=!1,o<s&&(s=o));a&&(t.splice(c--,1),e=n())}return e}o=o||0;for(var c=t.length;c>0&&t[c-1][2]>o;c--)t[c]=t[c-1];t[c]=[i,n,o]},r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.hu=t=>t+"."+r.h()+".hot-update.js",r.hmrF=()=>"Cirsim."+r.h()+".hot-update.json",r.h=()=>"9c1c6b952279e37800de",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),e={},i="courselib:",r.l=(t,n,o,s)=>{if(e[t])e[t].push(n);else{var a,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var u=c[h];if(u.getAttribute("src")==t||u.getAttribute("data-webpack")==i+o){a=u;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.setAttribute("data-webpack",i+o),a.src=t),e[t]=[n];var d=(i,n)=>{a.onerror=a.onload=null,clearTimeout(p);var o=e[t];if(delete e[t],a.parentNode&&a.parentNode.removeChild(a),o&&o.forEach((t=>t(n))),i)return i(n)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),l&&document.head.appendChild(a)}},r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),r.j=635,(()=>{var t,e,i,n,o={},s=r.c,a=[],l=[],c="idle";function h(t){c=t;for(var e=0;e<l.length;e++)l[e].call(null,t)}function u(t){if(0===e.length)return t();var i=e;return e=[],Promise.all(i).then((function(){return u(t)}))}function d(t){if("idle"!==c)throw new Error("check() is only allowed in idle status");return h("check"),r.hmrM().then((function(n){if(!n)return h(v()?"ready":"idle"),null;h("prepare");var o=[];return e=[],i=[],Promise.all(Object.keys(r.hmrC).reduce((function(t,e){return r.hmrC[e](n.c,n.r,n.m,t,i,o),t}),[])).then((function(){return u((function(){return t?f(t):(h("ready"),o)}))}))}))}function p(t){return"ready"!==c?Promise.resolve().then((function(){throw new Error("apply() is only allowed in ready status")})):f(t)}function f(t){t=t||{},v();var e=i.map((function(e){return e(t)}));i=void 0;var o,r=e.map((function(t){return t.error})).filter(Boolean);if(r.length>0)return h("abort"),Promise.resolve().then((function(){throw r[0]}));h("dispose"),e.forEach((function(t){t.dispose&&t.dispose()})),h("apply");var s=function(t){o||(o=t)},a=[];return e.forEach((function(t){if(t.apply){var e=t.apply(s);if(e)for(var i=0;i<e.length;i++)a.push(e[i])}})),o?(h("fail"),Promise.resolve().then((function(){throw o}))):n?f(t).then((function(t){return a.forEach((function(e){t.indexOf(e)<0&&t.push(e)})),t})):(h("idle"),Promise.resolve(a))}function v(){if(n)return i||(i=[]),Object.keys(r.hmrI).forEach((function(t){n.forEach((function(e){r.hmrI[t](e,i)}))})),n=void 0,!0}r.hmrD=o,r.i.push((function(f){var v,m,y,g,b=f.module,w=function(i,n){var o=s[n];if(!o)return i;var r=function(e){if(o.hot.active){if(s[e]){var r=s[e].parents;-1===r.indexOf(n)&&r.push(n)}else a=[n],t=e;-1===o.children.indexOf(e)&&o.children.push(e)}else console.warn("[HMR] unexpected require("+e+") from disposed module "+n),a=[];return i(e)},l=function(t){return{configurable:!0,enumerable:!0,get:function(){return i[t]},set:function(e){i[t]=e}}};for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&"e"!==d&&Object.defineProperty(r,d,l(d));return r.e=function(t){return function(t){switch(c){case"ready":return h("prepare"),e.push(t),u((function(){h("ready")})),t;case"prepare":return e.push(t),t;default:return t}}(i.e(t))},r}(f.require,f.id);b.hot=(v=f.id,m=b,g={_acceptedDependencies:{},_acceptedErrorHandlers:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_selfInvalidated:!1,_disposeHandlers:[],_main:y=t!==v,_requireSelf:function(){a=m.parents.slice(),t=y?void 0:v,r(v)},active:!0,accept:function(t,e,i){if(void 0===t)g._selfAccepted=!0;else if("function"==typeof t)g._selfAccepted=t;else if("object"==typeof t&&null!==t)for(var n=0;n<t.length;n++)g._acceptedDependencies[t[n]]=e||function(){},g._acceptedErrorHandlers[t[n]]=i;else g._acceptedDependencies[t]=e||function(){},g._acceptedErrorHandlers[t]=i},decline:function(t){if(void 0===t)g._selfDeclined=!0;else if("object"==typeof t&&null!==t)for(var e=0;e<t.length;e++)g._declinedDependencies[t[e]]=!0;else g._declinedDependencies[t]=!0},dispose:function(t){g._disposeHandlers.push(t)},addDisposeHandler:function(t){g._disposeHandlers.push(t)},removeDisposeHandler:function(t){var e=g._disposeHandlers.indexOf(t);e>=0&&g._disposeHandlers.splice(e,1)},invalidate:function(){switch(this._selfInvalidated=!0,c){case"idle":i=[],Object.keys(r.hmrI).forEach((function(t){r.hmrI[t](v,i)})),h("ready");break;case"ready":Object.keys(r.hmrI).forEach((function(t){r.hmrI[t](v,i)}));break;case"prepare":case"check":case"dispose":case"apply":(n=n||[]).push(v)}},check:d,apply:p,status:function(t){if(!t)return c;l.push(t)},addStatusHandler:function(t){l.push(t)},removeStatusHandler:function(t){var e=l.indexOf(t);e>=0&&l.splice(e,1)},data:o[v]},t=void 0,g),b.parents=a,b.children=[],a=[],f.require=w})),r.hmrC={},r.hmrI={}})(),r.p="/cl/dist/",(()=>{var t,e,i,n,o={635:0},s={};function a(t){return new Promise(((e,i)=>{s[t]=e;var n=r.p+r.hu(t),o=new Error;r.l(n,(e=>{if(s[t]){s[t]=void 0;var n=e&&("load"===e.type?"missing":e.type),r=e&&e.target&&e.target.src;o.message="Loading hot update chunk "+t+" failed.\n("+n+": "+r+")",o.name="ChunkLoadError",o.type=n,o.request=r,i(o)}}))}))}function l(s){function a(t){for(var e=[t],i={},n=e.map((function(t){return{chain:[t],id:t}}));n.length>0;){var o=n.pop(),s=o.id,a=o.chain,c=r.c[s];if(c&&(!c.hot._selfAccepted||c.hot._selfInvalidated)){if(c.hot._selfDeclined)return{type:"self-declined",chain:a,moduleId:s};if(c.hot._main)return{type:"unaccepted",chain:a,moduleId:s};for(var h=0;h<c.parents.length;h++){var u=c.parents[h],d=r.c[u];if(d){if(d.hot._declinedDependencies[s])return{type:"declined",chain:a.concat([u]),moduleId:s,parentId:u};-1===e.indexOf(u)&&(d.hot._acceptedDependencies[s]?(i[u]||(i[u]=[]),l(i[u],[s])):(delete i[u],e.push(u),n.push({chain:a.concat([u]),id:u})))}}}}return{type:"accepted",moduleId:t,outdatedModules:e,outdatedDependencies:i}}function l(t,e){for(var i=0;i<e.length;i++){var n=e[i];-1===t.indexOf(n)&&t.push(n)}}r.f&&delete r.f.jsonpHmr,t=void 0;var c={},h=[],u={},d=function(t){console.warn("[HMR] unexpected require("+t.id+") to disposed module")};for(var p in e)if(r.o(e,p)){var f,v=e[p],m=!1,y=!1,g=!1,b="";switch((f=v?a(p):{type:"disposed",moduleId:p}).chain&&(b="\nUpdate propagation: "+f.chain.join(" -> ")),f.type){case"self-declined":s.onDeclined&&s.onDeclined(f),s.ignoreDeclined||(m=new Error("Aborted because of self decline: "+f.moduleId+b));break;case"declined":s.onDeclined&&s.onDeclined(f),s.ignoreDeclined||(m=new Error("Aborted because of declined dependency: "+f.moduleId+" in "+f.parentId+b));break;case"unaccepted":s.onUnaccepted&&s.onUnaccepted(f),s.ignoreUnaccepted||(m=new Error("Aborted because "+p+" is not accepted"+b));break;case"accepted":s.onAccepted&&s.onAccepted(f),y=!0;break;case"disposed":s.onDisposed&&s.onDisposed(f),g=!0;break;default:throw new Error("Unexception type "+f.type)}if(m)return{error:m};if(y)for(p in u[p]=v,l(h,f.outdatedModules),f.outdatedDependencies)r.o(f.outdatedDependencies,p)&&(c[p]||(c[p]=[]),l(c[p],f.outdatedDependencies[p]));g&&(l(h,[f.moduleId]),u[p]=d)}e=void 0;for(var w,x=[],T=0;T<h.length;T++){var I=h[T],S=r.c[I];S&&(S.hot._selfAccepted||S.hot._main)&&u[I]!==d&&!S.hot._selfInvalidated&&x.push({module:I,require:S.hot._requireSelf,errorHandler:S.hot._selfAccepted})}return{dispose:function(){var t;i.forEach((function(t){delete o[t]})),i=void 0;for(var e,n=h.slice();n.length>0;){var s=n.pop(),a=r.c[s];if(a){var l={},u=a.hot._disposeHandlers;for(T=0;T<u.length;T++)u[T].call(null,l);for(r.hmrD[s]=l,a.hot.active=!1,delete r.c[s],delete c[s],T=0;T<a.children.length;T++){var d=r.c[a.children[T]];d&&((t=d.parents.indexOf(s))>=0&&d.parents.splice(t,1))}}}for(var p in c)if(r.o(c,p)&&(a=r.c[p]))for(w=c[p],T=0;T<w.length;T++)e=w[T],(t=a.children.indexOf(e))>=0&&a.children.splice(t,1)},apply:function(t){for(var e in u)r.o(u,e)&&(r.m[e]=u[e]);for(var i=0;i<n.length;i++)n[i](r);for(var o in c)if(r.o(c,o)){var a=r.c[o];if(a){w=c[o];for(var l=[],d=[],p=[],f=0;f<w.length;f++){var v=w[f],m=a.hot._acceptedDependencies[v],y=a.hot._acceptedErrorHandlers[v];if(m){if(-1!==l.indexOf(m))continue;l.push(m),d.push(y),p.push(v)}}for(var g=0;g<l.length;g++)try{l[g].call(null,w)}catch(e){if("function"==typeof d[g])try{d[g](e,{moduleId:o,dependencyId:p[g]})}catch(i){s.onErrored&&s.onErrored({type:"accept-error-handler-errored",moduleId:o,dependencyId:p[g],error:i,originalError:e}),s.ignoreErrored||(t(i),t(e))}else s.onErrored&&s.onErrored({type:"accept-errored",moduleId:o,dependencyId:p[g],error:e}),s.ignoreErrored||t(e)}}}for(var b=0;b<x.length;b++){var T=x[b],I=T.module;try{T.require(I)}catch(e){if("function"==typeof T.errorHandler)try{T.errorHandler(e,{moduleId:I,module:r.c[I]})}catch(i){s.onErrored&&s.onErrored({type:"self-accept-error-handler-errored",moduleId:I,error:i,originalError:e}),s.ignoreErrored||(t(i),t(e))}else s.onErrored&&s.onErrored({type:"self-accept-errored",moduleId:I,error:e}),s.ignoreErrored||t(e)}}return h}}}self.webpackHotUpdatecourselib=(t,i,o)=>{for(var a in i)r.o(i,a)&&(e[a]=i[a]);o&&n.push(o),s[t]&&(s[t](),s[t]=void 0)},r.hmrI.jsonp=function(t,o){e||(e={},n=[],i=[],o.push(l)),r.o(e,t)||(e[t]=r.m[t])},r.hmrC.jsonp=function(s,c,h,u,d,p){d.push(l),t={},i=c,e=h.reduce((function(t,e){return t[e]=!1,t}),{}),n=[],s.forEach((function(e){r.o(o,e)&&void 0!==o[e]&&(u.push(a(e)),t[e]=!0)})),r.f&&(r.f.jsonpHmr=function(e,i){t&&!r.o(t,e)&&r.o(o,e)&&void 0!==o[e]&&(i.push(a(e)),t[e]=!0)})},r.hmrM=()=>{if("undefined"==typeof fetch)throw new Error("No browser support: need fetch API");return fetch(r.p+r.hmrF()).then((t=>{if(404!==t.status){if(!t.ok)throw new Error("Failed to fetch update manifest "+t.statusText);return t.json()}}))},r.O.j=t=>0===o[t];var c=(t,e)=>{var i,n,[s,a,l]=e,c=0;for(i in a)r.o(a,i)&&(r.m[i]=a[i]);if(l)var h=l(r);for(t&&t(e);c<s.length;c++)n=s[c],r.o(o,n)&&o[n]&&o[n][0](),o[s[c]]=0;return r.O(h)},h=self.webpackChunkcourselib=self.webpackChunkcourselib||[];h.forEach(c.bind(null,0)),h.push=c.bind(null,h.push.bind(h))})();var s=r.O(void 0,[592,736],(()=>r(6686)));s=r.O(s)})();